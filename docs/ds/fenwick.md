author: HeRaNO, Zhoier, Ir1d, Xeonacid, wangdehu, ouuan, ranwen, ananbaobeichicun, Ycrpro, dbxxx-oi

## å¼•å…¥

æ ‘çŠ¶æ•°ç»„ã€çº¿æ®µæ ‘è¿™ä¸¤ç§æ•°æ®ç»“æ„ç”¨æ¥è§£å†³ä¸€ä¸ªå¸¸è§çš„åº”ç”¨é—®é¢˜ï¼šé«˜æ•ˆç‡åœ°æŸ¥è¯¢å’Œç»´æŠ¤å‰ç¼€å’Œ(æˆ–è€…åŒºé—´å’Œ)ã€‚

æ‰€è°“æŸ¥è¯¢å‰ç¼€å’Œï¼Œå³ç»™å‡ºé•¿åº¦ä¸ºnçš„æ•°åˆ—ğ´=ğ‘1,ğ‘2,...,ğ‘ğ‘›å’Œä¸€ä¸ªæŸ¥è¯¢ğ‘¥â‰¤ğ‘›ï¼Œæ±‚ğ‘ ğ‘¢ğ‘š(ğ‘¥)=ğ‘1+...+ğ‘ğ‘¥ã€‚åŒºé—´\[i, j\]çš„å’Œå¯ä»¥é€šè¿‡å‰ç¼€å’Œæ±‚å¾—ï¼šğ‘ğ‘–+...+ğ‘ğ‘—=ğ‘ ğ‘¢ğ‘š(ğ‘—)âˆ’ğ‘ ğ‘¢ğ‘š(ğ‘–âˆ’1)ã€‚

å¦‚æœæ•°åˆ—ğ´æ˜¯é™æ€ä¸å˜çš„ï¼Œä»£ç å¾ˆå¥½å†™ï¼Œé¢„å¤„ç†å‰ç¼€å’Œå°±å¥½äº†ï¼Œä¸€æ¬¡é¢„å¤„ç†çš„å¤æ‚åº¦æ˜¯O(n)çš„ï¼Œç„¶åæ¯æ¬¡æŸ¥è¯¢éƒ½æ˜¯O(1)çš„ã€‚ä½†æ˜¯ï¼Œå¦‚æœåºåˆ—æ˜¯åŠ¨æ€å˜åŒ–çš„ï¼Œä¾‹å¦‚æ”¹å˜å…¶ä¸­ä¸€ä¸ªå…ƒç´ ğ‘ğ‘˜çš„å€¼ï¼Œé‚£ä¹ˆå®ƒåé¢çš„å‰ç¼€å’Œéƒ½ä¼šæ”¹å˜ï¼Œéœ€è¦é‡æ–°è®¡ç®—ï¼Œå¦‚æœæ¯æ¬¡æŸ¥è¯¢å‰å…ƒç´ éƒ½æœ‰å˜åŒ–ï¼Œé‚£ä¹ˆä¸€æ¬¡æŸ¥è¯¢çš„çš„å¤æ‚åº¦å°±å˜æˆäº†O(n)ã€‚

æœ‰ä¸¤ç§æ•°æ®ç»“æ„å¯ä»¥é«˜æ•ˆåœ°å¤„ç†è¿™ä¸ªé—®é¢˜ï¼šæ ‘çŠ¶æ•°ç»„ã€çº¿æ®µæ ‘ã€‚å®ƒä»¬å®ç°çš„ä¸¤ä¸ªåŠŸèƒ½ï¼šæŸ¥è¯¢å‰ç¼€å’Œã€ä¿®æ”¹å…ƒç´ å€¼ï¼Œå¤æ‚åº¦éƒ½æ˜¯ğ‘‚(ğ‘™ğ‘œğ‘”ğ‘›)çš„ã€‚

åœ¨å­¦ä¹ çº¿æ®µæ ‘å’Œæ ‘çŠ¶æ•°ç»„ä¹‹å‰ï¼Œè¯»è€…å¯ä»¥è‡ªå·±æ€è€ƒå¦‚ä½•å®ç°ç”¨ğ‘‚(ğ‘™ğ‘œğ‘”ğ‘›)çš„å¤æ‚åº¦å®ç°æŸ¥è¯¢å’Œç»´æŠ¤å‰ç¼€å’Œã€‚æ€è·¯å¹¶ä¸éš¾å¾—åˆ°ï¼Œæ ¹æ®äºŒåˆ†æ³•æˆ–è€…åˆ†æ²»æ³•ï¼ŒæŠŠæ•´ä¸ªæ•°åˆ—åˆ†ä¸ºä¸¤åŠï¼Œç„¶åæ¯éƒ¨åˆ†å†ç»§ç»­åˆ†ä¸ºä¸¤åŠ......è¿™æ ·ä¸€æ¥ï¼ŒæŸ¥è¯¢å’Œä¿®æ”¹éƒ½èƒ½ä»¥ğ‘‚(ğ‘™ğ‘œğ‘”ğ‘›)çš„å¤æ‚åº¦å¾—åˆ°è§£å†³ã€‚è¿™å°±æ˜¯çº¿æ®µæ ‘å’Œæ ‘çŠ¶æ•°ç»„çš„åŸºæœ¬æ€è·¯ï¼Œçº¿æ®µæ ‘å·®ä¸å¤šé‡ç°äº†è¿™ä¸ªæ€è·¯ï¼Œè€Œæ ‘çŠ¶æ•°ç»„å€ŸåŠ©ä¸€ä¸ªç¥å¥‡çš„ğ‘™ğ‘œğ‘¤ğ‘ğ‘–ğ‘¡()æ“ä½œæ¥ç®€æ´åœ°å®ç°ã€‚çº¿æ®µæ ‘çš„ç¼–ç è¦æ›´å¤æ‚ä¸€äº›ï¼Œä½†æ˜¯ä¹Ÿæ›´é€šç”¨ã€‚

æ ‘çŠ¶æ•°ç»„å’Œçº¿æ®µæ ‘å…·æœ‰ç›¸ä¼¼çš„åŠŸèƒ½ï¼Œä½†ä»–ä¿©æ¯•ç«Ÿè¿˜æœ‰ä¸€äº›åŒºåˆ«ï¼šæ ‘çŠ¶æ•°ç»„èƒ½æœ‰çš„æ“ä½œï¼Œçº¿æ®µæ ‘ä¸€å®šæœ‰ï¼›çº¿æ®µæ ‘æœ‰çš„æ“ä½œï¼Œæ ‘çŠ¶æ•°ç»„ä¸ä¸€å®šæœ‰ã€‚æ ‘çŠ¶æ•°ç»„åªèƒ½å¤„ç†å…·æœ‰é€†è¿ç®—çš„è¿ç®—ï¼Œä¾‹å¦‚åŠ ã€å‡ã€å¼‚æˆ–è¿ç®—ï¼Œä¸èƒ½å¤„ç†ç±»ä¼¼äºæ±‚æœ€å¤§å€¼ã€æœ€å°å€¼çš„è¿ç®—ï¼ˆå®é™…ä¸Šä½¿ç”¨ä¸¤ä¸ªæ ‘çŠ¶æ•°ç»„å¯ä»¥ç”¨äºå¤„ç†æœ€å¤§ã€å°å€¼çš„é—®é¢˜ï¼Œè§ [Efficient Range Minimum Queries using Binary Indexed Trees](http://history.ioinformatics.org/oi/files/volume9.pdf#page=41)ï¼‰ã€‚ä½†æ˜¯æ ‘çŠ¶æ•°ç»„çš„ä»£ç è¦æ¯”çº¿æ®µæ ‘çŸ­ï¼Œæ€ç»´æ›´æ¸…æ™°ï¼Œé€Ÿåº¦ä¹Ÿæ›´å¿«ï¼Œåœ¨è§£å†³ä¸€äº›å•ç‚¹ä¿®æ”¹çš„é—®é¢˜æ—¶ï¼Œæ ‘çŠ¶æ•°ç»„æ˜¯ä¸äºŒä¹‹é€‰ã€‚

æ ‘çŠ¶æ•°ç»„æ˜¯ä¸€ç§æ”¯æŒ **å•ç‚¹ä¿®æ”¹** å’Œ **åŒºé—´æŸ¥è¯¢** çš„ï¼Œä»£ç é‡å°çš„æ•°æ®ç»“æ„ã€‚

??? note "ä»€ä¹ˆæ˜¯ã€Œå•ç‚¹ä¿®æ”¹ã€å’Œã€ŒåŒºé—´æŸ¥è¯¢ã€ï¼Ÿ"
    å‡è®¾æœ‰è¿™æ ·ä¸€é“é¢˜ï¼š
    
    å·²çŸ¥ä¸€ä¸ªæ•°åˆ— $a$ï¼Œä½ éœ€è¦è¿›è¡Œä¸‹é¢ä¸¤ç§æ“ä½œï¼š
    
    -   ç»™å®š $x, y$ï¼Œå°† $a[x]$ è‡ªå¢ $y$ã€‚
    -   ç»™å®š $l, r$ï¼Œæ±‚è§£ $a[l \ldots r]$ çš„å’Œã€‚
    
    å…¶ä¸­ç¬¬ä¸€ç§æ“ä½œå°±æ˜¯ã€Œå•ç‚¹ä¿®æ”¹ã€ï¼Œç¬¬äºŒç§æ“ä½œå°±æ˜¯ã€ŒåŒºé—´æŸ¥è¯¢ã€ã€‚
    
    ç±»ä¼¼åœ°ï¼Œè¿˜æœ‰ï¼šã€ŒåŒºé—´ä¿®æ”¹ã€ã€ã€Œå•ç‚¹æŸ¥è¯¢ã€ã€‚å®ƒä»¬åˆ†åˆ«çš„ä¸€ä¸ªä¾‹å­å¦‚ä¸‹ï¼š
    
    -   åŒºé—´ä¿®æ”¹ï¼šç»™å®š $l, r, x$ï¼Œå°† $a[l \ldots r]$ ä¸­çš„æ¯ä¸ªæ•°éƒ½åˆ†åˆ«è‡ªå¢ $x$ï¼›
    -   å•ç‚¹æŸ¥è¯¢ï¼šç»™å®š $x$ï¼Œæ±‚è§£ $a[x]$ çš„å€¼ã€‚
    
    æ³¨æ„åˆ°ï¼ŒåŒºé—´é—®é¢˜ä¸€èˆ¬ä¸¥æ ¼å¼ºäºå•ç‚¹é—®é¢˜ï¼Œå› ä¸ºå¯¹å•ç‚¹çš„æ“ä½œç›¸å½“äºå¯¹ä¸€ä¸ªé•¿åº¦ä¸º $1$ çš„åŒºé—´æ“ä½œã€‚

æ™®é€šæ ‘çŠ¶æ•°ç»„ç»´æŠ¤çš„ä¿¡æ¯åŠè¿ç®—è¦æ»¡è¶³ **ç»“åˆå¾‹** ä¸” **å¯å·®åˆ†**ï¼Œå¦‚åŠ æ³•ï¼ˆå’Œï¼‰ã€ä¹˜æ³•ï¼ˆç§¯ï¼‰ã€å¼‚æˆ–ç­‰ã€‚

-   ç»“åˆå¾‹ï¼š$(x \circ y) \circ z = x \circ (y \circ z)$ï¼Œå…¶ä¸­ $\circ$ æ˜¯ä¸€ä¸ªäºŒå…ƒè¿ç®—ç¬¦ã€‚
-   å¯å·®åˆ†ï¼šå…·æœ‰é€†è¿ç®—çš„è¿ç®—ï¼Œå³å·²çŸ¥ $x \circ y$ å’Œ $x$ å¯ä»¥æ±‚å‡º $y$ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼š

-   æ¨¡æ„ä¹‰ä¸‹çš„ä¹˜æ³•è‹¥è¦å¯å·®åˆ†ï¼Œéœ€ä¿è¯æ¯ä¸ªæ•°éƒ½å­˜åœ¨é€†å…ƒï¼ˆæ¨¡æ•°ä¸ºè´¨æ•°æ—¶ä¸€å®šå­˜åœ¨ï¼‰ï¼›
-   ä¾‹å¦‚ $\gcd$ï¼Œ$\max$ è¿™äº›ä¿¡æ¯ä¸å¯å·®åˆ†ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨æ™®é€šæ ‘çŠ¶æ•°ç»„å¤„ç†ï¼Œä½†æ˜¯ï¼š
    -   ä½¿ç”¨ä¸¤ä¸ªæ ‘çŠ¶æ•°ç»„å¯ä»¥ç”¨äºå¤„ç†åŒºé—´æœ€å€¼ï¼Œè§ [Efficient Range Minimum Queries using Binary Indexed Trees](http://history.ioinformatics.org/oi/files/volume9.pdf#page=41)ã€‚
    -   æœ¬é¡µé¢ä¹Ÿä¼šä»‹ç»ä¸€ç§æ”¯æŒä¸å¯å·®åˆ†ä¿¡æ¯æŸ¥è¯¢çš„ï¼Œ$\Theta(\log^2n)$ æ—¶é—´å¤æ‚åº¦çš„æ‹“å±•æ ‘çŠ¶æ•°ç»„ã€‚

äº‹å®ä¸Šï¼Œæ ‘çŠ¶æ•°ç»„èƒ½è§£å†³çš„é—®é¢˜æ˜¯çº¿æ®µæ ‘èƒ½è§£å†³çš„é—®é¢˜çš„å­é›†ï¼šæ ‘çŠ¶æ•°ç»„èƒ½åšçš„ï¼Œçº¿æ®µæ ‘ä¸€å®šèƒ½åšï¼›çº¿æ®µæ ‘èƒ½åšçš„ï¼Œæ ‘çŠ¶æ•°ç»„ä¸ä¸€å®šå¯ä»¥ã€‚ç„¶è€Œï¼Œæ ‘çŠ¶æ•°ç»„çš„ä»£ç è¦è¿œæ¯”çº¿æ®µæ ‘çŸ­ï¼Œæ—¶é—´æ•ˆç‡å¸¸æ•°ä¹Ÿæ›´å°ï¼Œå› æ­¤ä»æœ‰å­¦ä¹ ä»·å€¼ã€‚

æœ‰æ—¶ï¼Œåœ¨å·®åˆ†æ•°ç»„å’Œè¾…åŠ©æ•°ç»„çš„å¸®åŠ©ä¸‹ï¼Œæ ‘çŠ¶æ•°ç»„è¿˜å¯è§£å†³æ›´å¼ºçš„ **åŒºé—´åŠ å•ç‚¹å€¼** å’Œ **åŒºé—´åŠ åŒºé—´å’Œ** é—®é¢˜ã€‚

æœ¬èŠ‚ä»‹ç»æ ‘çŠ¶æ•°ç»„çš„æ¦‚å¿µå’ŒåŸºæœ¬ä»£ç ï¼Œç„¶åç»™å‡ºå®ƒçš„ç»å…¸åº”ç”¨ï¼šåŒºé—´ä¿®æ”¹+å•ç‚¹æŸ¥è¯¢ã€åŒºé—´ä¿®æ”¹+åŒºé—´æŸ¥è¯¢ã€äºŒç»´åŒºé—´ä¿®æ”¹+åŒºé—´æŸ¥è¯¢ã€åŒºé—´æœ€å€¼ã€‚

## æ ‘çŠ¶æ•°ç»„

### åˆæ­¥æ„Ÿå—

å…ˆæ¥ä¸¾ä¸ªä¾‹å­ï¼šæˆ‘ä»¬æƒ³çŸ¥é“ $a[1 \ldots 7]$ çš„å‰ç¼€å’Œï¼Œæ€ä¹ˆåšï¼Ÿ

ä¸€ç§åšæ³•æ˜¯ï¼š$a_1 + a_2 + a_3 + a_4 + a_5 + a_6 + a_7$ï¼Œéœ€è¦æ±‚ $7$ ä¸ªæ•°çš„å’Œã€‚

é‚£å¦‚æœæˆ‘å‘Šè¯‰ä½ ä¸‰ä¸ªæ•° $A$ï¼Œ$B$ï¼Œ$C$ï¼Œ$A = a[1 \ldots 4]$ çš„å’Œï¼Œ$B = a[5 \ldots 6]$ çš„æ€»å’Œï¼Œ$C = a[7 \ldots 7]$ çš„æ€»å’Œï¼ˆå…¶å®å°±æ˜¯ $a[7]$ è‡ªå·±ï¼‰ã€‚ä½ ä¼šæ€ä¹ˆç®—ï¼Ÿä½ ä¸€å®šä¼šå›ç­”ï¼š$A + B + C$ï¼Œåªéœ€è¦æ±‚ $3$ ä¸ªæ•°çš„å’Œã€‚

è¿™å°±æ˜¯æ ‘çŠ¶æ•°ç»„èƒ½å¿«é€Ÿæ±‚è§£ä¿¡æ¯çš„åŸå› ï¼šæˆ‘ä»¬æ€»èƒ½å°†ä¸€æ®µå‰ç¼€ $[1, n]$ æ‹†æˆ **ä¸å¤šäº $\mathbf{\log n}$ æ®µåŒºé—´**ï¼Œä½¿å¾—è¿™ $\log n$ æ®µåŒºé—´çš„ä¿¡æ¯æ˜¯ **å·²çŸ¥çš„**ã€‚

äºæ˜¯ï¼Œæˆ‘ä»¬åªéœ€åˆå¹¶è¿™ $\log n$ æ®µåŒºé—´çš„ä¿¡æ¯ï¼Œå°±å¯ä»¥å¾—åˆ°ç­”æ¡ˆã€‚ç›¸æ¯”äºåŸæ¥ç›´æ¥åˆå¹¶ $n$ ä¸ªä¿¡æ¯ï¼Œæ•ˆç‡æœ‰äº†å¾ˆå¤§çš„æé«˜ã€‚

ä¸éš¾å‘ç°ä¿¡æ¯å¿…é¡»æ»¡è¶³ç»“åˆå¾‹ï¼Œå¦åˆ™å°±ä¸èƒ½åƒä¸Šé¢è¿™æ ·åˆå¹¶äº†ã€‚

ä¸‹é¢è¿™å¼ å›¾å±•ç¤ºäº†æ ‘çŠ¶æ•°ç»„çš„å·¥ä½œåŸç†ï¼š

![](./images/fenwick.svg)

æœ€ä¸‹é¢çš„å…«ä¸ªæ–¹å—ä»£è¡¨åŸå§‹æ•°æ®æ•°ç»„ $a$ã€‚ä¸Šé¢å‚å·®ä¸é½çš„æ–¹å—ï¼ˆä¸æœ€ä¸Šé¢çš„å…«ä¸ªæ–¹å—æ˜¯åŒä¸€ä¸ªæ•°ç»„ï¼‰ä»£è¡¨æ•°ç»„ $a$ çš„ä¸Šçº§â€”â€”$c$ æ•°ç»„ã€‚

$c$ æ•°ç»„å°±æ˜¯ç”¨æ¥å‚¨å­˜åŸå§‹æ•°ç»„ $a$ æŸæ®µåŒºé—´çš„å’Œçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™äº›åŒºé—´çš„ä¿¡æ¯æ˜¯å·²çŸ¥çš„ï¼Œæˆ‘ä»¬çš„ç›®æ ‡å°±æ˜¯æŠŠæŸ¥è¯¢å‰ç¼€æ‹†æˆè¿™äº›å°åŒºé—´ã€‚

ä¾‹å¦‚ï¼Œä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼š

-   $c_2$ ç®¡è¾–çš„æ˜¯ $a[1 \ldots 2]$ï¼›
-   $c_4$ ç®¡è¾–çš„æ˜¯ $a[1 \ldots 4]$ï¼›
-   $c_6$ ç®¡è¾–çš„æ˜¯ $a[5 \ldots 6]$ï¼›
-   $c_8$ ç®¡è¾–çš„æ˜¯ $a[1 \ldots 8]$ï¼›
-   å‰©ä¸‹çš„ $c[x]$ ç®¡è¾–çš„éƒ½æ˜¯ $a[x]$ è‡ªå·±ï¼ˆå¯ä»¥çœ‹åš $a[x \ldots x]$ çš„é•¿åº¦ä¸º $1$ çš„å°åŒºé—´ï¼‰ã€‚

ä¸éš¾å‘ç°ï¼Œ$c[x]$ ç®¡è¾–çš„ä¸€å®šæ˜¯ä¸€æ®µå³è¾¹ç•Œæ˜¯ $x$ çš„åŒºé—´æ€»ä¿¡æ¯ã€‚æˆ‘ä»¬å…ˆä¸å…³å¿ƒå·¦è¾¹ç•Œï¼Œå…ˆæ¥æ„Ÿå—ä¸€ä¸‹æ ‘çŠ¶æ•°ç»„æ˜¯å¦‚ä½•æŸ¥è¯¢çš„ã€‚

ä¸¾ä¾‹ï¼šè®¡ç®— $a[1 \ldots 7]$ çš„å’Œã€‚

è¿‡ç¨‹ï¼šä» $c_{7}$ å¼€å§‹å¾€å‰è·³ï¼Œå‘ç° $c_{7}$ åªç®¡è¾– $a_{7}$ è¿™ä¸ªå…ƒç´ ï¼›ç„¶åæ‰¾ $c_{6}$ï¼Œå‘ç° $c_{6}$ ç®¡è¾–çš„æ˜¯ $a[5 \ldots 6]$ï¼Œç„¶åè·³åˆ° $c_{4}$ï¼Œå‘ç° $c_{4}$ ç®¡è¾–çš„æ˜¯ $a[1 \ldots 4]$ è¿™äº›å…ƒç´ ï¼Œç„¶åå†è¯•å›¾è·³åˆ° $c_0$ï¼Œä½†äº‹å®ä¸Š $c_0$ ä¸å­˜åœ¨ï¼Œä¸è·³äº†ã€‚

æˆ‘ä»¬åˆšåˆšæ‰¾åˆ°çš„ $c$ æ˜¯ $c_7, c_6, c_4$ï¼Œäº‹å®ä¸Šè¿™å°±æ˜¯ $a[1 \ldots 7]$ æ‹†åˆ†å‡ºçš„ä¸‰ä¸ªå°åŒºé—´ï¼Œåˆå¹¶å¾—åˆ°ç­”æ¡ˆæ˜¯ $c_7 + c_6 + c_4$ã€‚

ä¸¾ä¾‹ï¼šè®¡ç®— $a[4 \ldots 7]$ çš„å’Œã€‚

æˆ‘ä»¬è¿˜æ˜¯ä» $c_7$ å¼€å§‹è·³ï¼Œè·³åˆ° $c_6$ å†è·³åˆ° $c_4$ã€‚æ­¤æ—¶æˆ‘ä»¬å‘ç°å®ƒç®¡ç†äº† $a[1 \ldots 4]$ çš„å’Œï¼Œä½†æ˜¯æˆ‘ä»¬ä¸æƒ³è¦ $a[1 \ldots 3]$ è¿™ä¸€éƒ¨åˆ†ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿå¾ˆç®€å•ï¼Œå‡å» $a[1 \ldots 3]$ çš„å’Œå°±è¡Œäº†ã€‚

é‚£ä¸å¦¨è€ƒè™‘æœ€å¼€å§‹ï¼Œå°±å°†æŸ¥è¯¢ $a[4 \ldots 7]$ çš„å’Œè½¬åŒ–ä¸ºæŸ¥è¯¢ $a[1 \ldots 7]$ çš„å’Œï¼Œä»¥åŠæŸ¥è¯¢ $a[1 \ldots 3]$ çš„å’Œï¼Œæœ€ç»ˆå°†ä¸¤ä¸ªç»“æœä½œå·®ã€‚

![](images/fenwick-query.svg)

### ç®¡è¾–åŒºé—´

é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œ$c[x](x \ge 1)$ ç®¡è¾–çš„åŒºé—´åˆ°åº•å¾€å·¦å»¶ä¼¸å¤šå°‘ï¼Ÿä¹Ÿå°±æ˜¯è¯´ï¼ŒåŒºé—´é•¿åº¦æ˜¯å¤šå°‘ï¼Ÿ

æ ‘çŠ¶æ•°ç»„ä¸­ï¼Œè§„å®š $c[x]$ ç®¡è¾–çš„åŒºé—´é•¿åº¦ä¸º $2^{k}$ï¼Œå…¶ä¸­ï¼š

-   è®¾äºŒè¿›åˆ¶æœ€ä½ä½ä¸ºç¬¬ $0$ ä½ï¼Œåˆ™ $k$ æ°å¥½ä¸º $x$ äºŒè¿›åˆ¶è¡¨ç¤ºä¸­ï¼Œæœ€ä½ä½çš„ `1` æ‰€åœ¨çš„äºŒè¿›åˆ¶ä½æ•°ï¼›
-   $2^k$ï¼ˆ$c[x]$ çš„ç®¡è¾–åŒºé—´é•¿åº¦ï¼‰æ°å¥½ä¸º $x$ äºŒè¿›åˆ¶è¡¨ç¤ºä¸­ï¼Œæœ€ä½ä½çš„ `1` ä»¥åŠåé¢æ‰€æœ‰ `0` ç»„æˆçš„æ•°ã€‚

ä¸¾ä¸ªä¾‹å­ï¼Œ$c_{88}$ ç®¡è¾–çš„æ˜¯å“ªä¸ªåŒºé—´ï¼Ÿ

å› ä¸º $88_{(10)}=01011000_{(2)}$ï¼Œå…¶äºŒè¿›åˆ¶æœ€ä½ä½çš„ `1` ä»¥åŠåé¢çš„ `0` ç»„æˆçš„äºŒè¿›åˆ¶æ˜¯ `1000`ï¼Œå³ $8$ï¼Œæ‰€ä»¥ $c_{88}$ ç®¡è¾– $8$ ä¸ª $a$ æ•°ç»„ä¸­çš„å…ƒç´ ã€‚

å› æ­¤ï¼Œ$c_{88}$ ä»£è¡¨ $a[81 \ldots 88]$ çš„åŒºé—´ä¿¡æ¯ã€‚

æˆ‘ä»¬è®° $x$ äºŒè¿›åˆ¶æœ€ä½ä½ `1` ä»¥åŠåé¢çš„ `0` ç»„æˆçš„æ•°ä¸º $\operatorname{lowbit}(x)$ï¼Œé‚£ä¹ˆ $c[x]$ ç®¡è¾–çš„åŒºé—´å°±æ˜¯ $[x-\operatorname{lowbit}(x)+1, x]$ã€‚

**è¿™é‡Œæ³¨æ„ï¼š$\mathbf{\operatorname{lowbit}}$ æŒ‡çš„ä¸æ˜¯æœ€ä½ä½ `1` æ‰€åœ¨çš„ä½æ•° $\mathbf{k}$ï¼Œè€Œæ˜¯è¿™ä¸ª `1` å’Œåé¢æ‰€æœ‰ `0` ç»„æˆçš„ $\mathbf{2^k}$ã€‚**

æ€ä¹ˆè®¡ç®— `lowbit`ï¼Ÿæ ¹æ®ä½è¿ç®—çŸ¥è¯†ï¼Œå¯ä»¥å¾—åˆ° `lowbit(x) = x & -x`ã€‚

??? note "lowbit çš„åŸç†"
    å°† `x` çš„äºŒè¿›åˆ¶æ‰€æœ‰ä½å…¨éƒ¨å–åï¼Œå†åŠ  1ï¼Œå°±å¯ä»¥å¾—åˆ° `-x` çš„äºŒè¿›åˆ¶ç¼–ç ã€‚ä¾‹å¦‚ï¼Œ$6$ çš„äºŒè¿›åˆ¶ç¼–ç æ˜¯ `110`ï¼Œå…¨éƒ¨å–ååå¾—åˆ° `001`ï¼ŒåŠ  `1` å¾—åˆ° `010`ã€‚
    
    è®¾åŸå…ˆ `x` çš„äºŒè¿›åˆ¶ç¼–ç æ˜¯ `(...)10...00`ï¼Œå…¨éƒ¨å–ååå¾—åˆ° `[...]01...11`ï¼ŒåŠ  `1` åå¾—åˆ° `[...]10...00`ï¼Œä¹Ÿå°±æ˜¯ `-x` çš„äºŒè¿›åˆ¶ç¼–ç äº†ã€‚è¿™é‡Œ `x` äºŒè¿›åˆ¶è¡¨ç¤ºä¸­ç¬¬ä¸€ä¸ª `1` æ˜¯ `x` æœ€ä½ä½çš„ `1`ã€‚
    
    `(...)` å’Œ `[...]` ä¸­çœç•¥å·çš„æ¯ä¸€ä½åˆ†åˆ«ç›¸åï¼Œæ‰€ä»¥ `x & -x = (...)10...00 & [...]10...00 = 10...00`ï¼Œå¾—åˆ°çš„ç»“æœå°±æ˜¯ `lowbit`ã€‚

ğ‘™ğ‘œğ‘¤ğ‘ğ‘–ğ‘¡(ğ‘¥)=ğ‘¥ & âˆ’ğ‘¥ï¼ŒåŠŸèƒ½æ˜¯æ‰¾åˆ°xçš„äºŒè¿›åˆ¶æ•°çš„æœ€åä¸€ä¸ª1ã€‚å…¶åŸç†æ˜¯åˆ©ç”¨äº†è´Ÿæ•°çš„è¡¥ç è¡¨ç¤ºï¼Œè¡¥ç æ˜¯åŸç å–ååŠ ä¸€ã€‚ä¾‹å¦‚ğ‘¥=6=000001102ï¼Œâˆ’ğ‘¥=ğ‘¥è¡¥=111110102ï¼Œé‚£ä¹ˆğ‘™ğ‘œğ‘¤ğ‘ğ‘–ğ‘¡(ğ‘¥)=ğ‘¥ &âˆ’ğ‘¥=102=2ã€‚

???+ note "å®ç°"
    === "C++"
    
        ```cpp
        int lowbit(int x) {
          // x çš„äºŒè¿›åˆ¶ä¸­ï¼Œæœ€ä½ä½çš„ 1 ä»¥åŠåé¢æ‰€æœ‰ 0 ç»„æˆçš„æ•°ã€‚
          // lowbit(0b01011000) == 0b00001000
          //          ~~~~^~~~
          // lowbit(0b01110010) == 0b00000010
          //          ~~~~~~^~
          return x & -x;
        }
        ```
    
    === "Python"
    
        ```python
        def lowbit(x):
            """
            x çš„äºŒè¿›åˆ¶ä¸­ï¼Œæœ€ä½ä½çš„ 1 ä»¥åŠåé¢æ‰€æœ‰ 0 ç»„æˆçš„æ•°ã€‚
            lowbit(0b01011000) == 0b00001000
                    ~~~~~^~~
            lowbit(0b01110010) == 0b00000010
                    ~~~~~~~^~
            """
            return x & -x
        ```

### åŒºé—´æŸ¥è¯¢

æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹æ ‘çŠ¶æ•°ç»„å…·ä½“çš„æ“ä½œå®ç°ï¼Œå…ˆæ¥çœ‹åŒºé—´æŸ¥è¯¢ã€‚

å›é¡¾æŸ¥è¯¢ $a[4 \ldots 7]$ çš„è¿‡ç¨‹ï¼Œæˆ‘ä»¬æ˜¯å°†å®ƒè½¬åŒ–ä¸ºä¸¤ä¸ªå­è¿‡ç¨‹ï¼šæŸ¥è¯¢ $a[1 \ldots 7]$ å’ŒæŸ¥è¯¢ $a[1 \ldots 3]$ çš„å’Œï¼Œæœ€ç»ˆä½œå·®ã€‚

å…¶å®ä»»ä½•ä¸€ä¸ªåŒºé—´æŸ¥è¯¢éƒ½å¯ä»¥è¿™ä¹ˆåšï¼šæŸ¥è¯¢ $a[l \ldots r]$ çš„å’Œï¼Œå°±æ˜¯ $a[1 \ldots r]$ çš„å’Œå‡å» $a[1 \ldots l - 1]$ çš„å’Œï¼Œä»è€ŒæŠŠåŒºé—´é—®é¢˜è½¬åŒ–ä¸ºå‰ç¼€é—®é¢˜ï¼Œæ›´æ–¹ä¾¿å¤„ç†ã€‚

äº‹å®ä¸Šï¼Œå°†æœ‰å…³ $l \ldots r$ çš„åŒºé—´è¯¢é—®è½¬åŒ–ä¸º $1 \ldots r$ å’Œ $1 \ldots l - 1$ çš„å‰ç¼€è¯¢é—®å†å·®åˆ†ï¼Œåœ¨ç«èµ›ä¸­æ˜¯ä¸€ä¸ªéå¸¸å¸¸ç”¨çš„æŠ€å·§ã€‚

é‚£å‰ç¼€æŸ¥è¯¢æ€ä¹ˆåšå‘¢ï¼Ÿå›é¡¾ä¸‹æŸ¥è¯¢ $a[1 \ldots 7]$ çš„è¿‡ç¨‹ï¼š

> ä» $c_{7}$ å¾€å‰è·³ï¼Œå‘ç° $c_{7}$ åªç®¡è¾– $a_{7}$ è¿™ä¸ªå…ƒç´ ï¼›ç„¶åæ‰¾ $c_{6}$ï¼Œå‘ç° $c_{6}$ ç®¡è¾–çš„æ˜¯ $a[5 \ldots 6]$ï¼Œç„¶åè·³åˆ° $c_{4}$ï¼Œå‘ç° $c_{4}$ ç®¡è¾–çš„æ˜¯ $a[1 \ldots 4]$ è¿™äº›å…ƒç´ ï¼Œç„¶åå†è¯•å›¾è·³åˆ° $c_0$ï¼Œä½†äº‹å®ä¸Š $c_0$ ä¸å­˜åœ¨ï¼Œä¸è·³äº†ã€‚
>
> æˆ‘ä»¬åˆšåˆšæ‰¾åˆ°çš„ $c$ æ˜¯ $c_7, c_6, c_4$ï¼Œäº‹å®ä¸Šè¿™å°±æ˜¯ $a[1 \ldots 7]$ æ‹†åˆ†å‡ºçš„ä¸‰ä¸ªå°åŒºé—´ï¼Œåˆå¹¶ä¸€ä¸‹ï¼Œç­”æ¡ˆæ˜¯ $c_7 + c_6 + c_4$ã€‚

è§‚å¯Ÿä¸Šé¢çš„è¿‡ç¨‹ï¼Œæ¯æ¬¡å¾€å‰è·³ï¼Œä¸€å®šæ˜¯è·³åˆ°ç°åŒºé—´çš„å·¦ç«¯ç‚¹çš„å·¦ä¸€ä½ï¼Œä½œä¸ºæ–°åŒºé—´çš„å³ç«¯ç‚¹ï¼Œè¿™æ ·æ‰èƒ½å°†å‰ç¼€ä¸é‡ä¸æ¼åœ°æ‹†åˆ†ã€‚æ¯”å¦‚ç°åœ¨ $c_6$ ç®¡çš„æ˜¯ $a[5 \ldots 6]$ï¼Œä¸‹ä¸€æ¬¡å°±è·³åˆ° $5 - 1 = 4$ï¼Œå³è®¿é—® $c_4$ã€‚

æˆ‘ä»¬å¯ä»¥å†™å‡ºæŸ¥è¯¢ $a[1 \ldots x]$ çš„è¿‡ç¨‹ï¼š

-   ä» $c[x]$ å¼€å§‹å¾€å‰è·³ï¼Œæœ‰ $c[x]$ ç®¡è¾– $a[x-\operatorname{lowbit}(x)+1 \ldots x]$ï¼›
-   ä»¤ $x \gets x - \operatorname{lowbit}(x)$ï¼Œå¦‚æœ $x = 0$ è¯´æ˜å·²ç»è·³åˆ°å°½å¤´äº†ï¼Œç»ˆæ­¢å¾ªç¯ï¼›å¦åˆ™å›åˆ°ç¬¬ä¸€æ­¥ã€‚
-   å°†è·³åˆ°çš„ $c$ åˆå¹¶ã€‚

å®ç°æ—¶ï¼Œæˆ‘ä»¬ä¸ä¸€å®šè¦å…ˆæŠŠ $c$ éƒ½è·³å‡ºæ¥ç„¶åä¸€èµ·åˆå¹¶ï¼Œå¯ä»¥è¾¹è·³è¾¹åˆå¹¶ã€‚

æ¯”å¦‚æˆ‘ä»¬è¦ç»´æŠ¤çš„ä¿¡æ¯æ˜¯å’Œï¼Œç›´æ¥ä»¤åˆå§‹ $\mathrm{ans} = 0$ï¼Œç„¶åæ¯è·³åˆ°ä¸€ä¸ª $c[x]$ å°± $\mathrm{ans} \gets \mathrm{ans} + c[x]$ï¼Œæœ€ç»ˆ $\mathrm{ans}$ å°±æ˜¯æ‰€æœ‰åˆå¹¶çš„ç»“æœã€‚

???+ note "å®ç°"
    === "C++"
    
        ```cpp
        int getsum(int x) {  // a[1]..a[x]çš„å’Œ
          int ans = 0;
          while (x > 0) {
            ans = ans + c[x];
            x = x - lowbit(x);
          }
          return ans;
        }
        ```
    
    === "Python"
    
        ```python
        def getsum(x): # a[1]..a[x]çš„å’Œ
            ans = 0
            while x > 0:
                ans = ans + c[x]
                x = x - lowbit(x)
            return ans
        ```

### æ ‘çŠ¶æ•°ç»„ä¸å…¶æ ‘å½¢æ€çš„æ€§è´¨

åœ¨è®²è§£å•ç‚¹ä¿®æ”¹ä¹‹å‰ï¼Œå…ˆè®²è§£æ ‘çŠ¶æ•°ç»„çš„ä¸€äº›åŸºæœ¬æ€§è´¨ï¼Œä»¥åŠå…¶æ ‘å½¢æ€æ¥æºï¼Œè¿™æœ‰åŠ©äºæ›´å¥½ç†è§£æ ‘çŠ¶æ•°ç»„çš„å•ç‚¹ä¿®æ”¹ã€‚

æˆ‘ä»¬çº¦å®šï¼š

-   $l(x) = x - \operatorname{lowbit}(x) + 1$ã€‚å³ï¼Œ$l(x)$ æ˜¯ $c[x]$ ç®¡è¾–èŒƒå›´çš„å·¦ç«¯ç‚¹ã€‚
-   å¯¹äºä»»æ„æ­£æ•´æ•° $x$ï¼Œæ€»èƒ½å°† $x$ è¡¨ç¤ºæˆ $s \times 2^{k + 1} + 2^k$ çš„å½¢å¼ï¼Œå…¶ä¸­ $\operatorname{lowbit}(x) = 2^k$ã€‚
-   ä¸‹é¢ã€Œ$c[x]$ å’Œ $c[y]$ ä¸äº¤ã€æŒ‡ $c[x]$ çš„ç®¡è¾–èŒƒå›´å’Œ $c[y]$ çš„ç®¡è¾–èŒƒå›´ä¸ç›¸äº¤ï¼Œå³ $[l(x), x]$ å’Œ $[l(y), y]$ ä¸ç›¸äº¤ã€‚ã€Œ$c[x]$ åŒ…å«äº $c[y]$ã€ç­‰è¡¨è¿°åŒç†ã€‚

**æ€§è´¨ $\mathbf{1}$ï¼šå¯¹äº $\mathbf{x \le y}$ï¼Œè¦ä¹ˆæœ‰ $\mathbf{c[x]}$ å’Œ $\mathbf{c[y]}$ ä¸äº¤ï¼Œè¦ä¹ˆæœ‰ $\mathbf{c[x]}$ åŒ…å«äº $\mathbf{c[y]}$ã€‚**

??? note "è¯æ˜"
    è¯æ˜ï¼šå‡è®¾ $c[x]$ å’Œ $c[y]$ ç›¸äº¤ï¼Œå³ $[l(x), x]$ å’Œ $[l(y), y]$ ç›¸äº¤ï¼Œåˆ™ä¸€å®šæœ‰ $l(y) \le x \le y$ã€‚
    
    å°† $y$ è¡¨ç¤ºä¸º $s \times 2^{k +1} + 2^k$ï¼Œåˆ™ $l(y) = s \times 2^{k + 1} + 1$ã€‚æ‰€ä»¥ï¼Œ$x$ å¯ä»¥è¡¨ç¤ºä¸º $s \times 2^{k +1} + b$ï¼Œå…¶ä¸­ $1 \le b \le 2^k$ã€‚
    
    ä¸éš¾å‘ç° $\operatorname{lowbit}(x) = \operatorname{lowbit}(b)$ã€‚åˆå› ä¸º $b - \operatorname{lowbit}(b) \ge 0$ï¼Œ
    
    æ‰€ä»¥ $l(x) = x - \operatorname{lowbit}(x) + 1 = s \times 2^{k +1} + b - \operatorname{lowbit}(b) +1 \ge s \times 2^{k +1} + 1 = l(y)$ï¼Œå³ $l(y) \le l(x) \le x \le y$ã€‚
    
    æ‰€ä»¥ï¼Œå¦‚æœ $c[x]$ å’Œ $c[y]$ ç›¸äº¤ï¼Œé‚£ä¹ˆ $c[x]$ çš„ç®¡è¾–èŒƒå›´ä¸€å®šå®Œå…¨åŒ…å«äº $c[y]$ã€‚

**æ€§è´¨ $\mathbf{2}$ï¼šåœ¨ $\mathbf{c[x]}$ çœŸåŒ…å«äº $\mathbf{c[x + \operatorname{lowbit}(x)]}$ã€‚**

??? note "è¯æ˜"
    è¯æ˜ï¼šè®¾ $y = x + \operatorname{lowbit}(x)$ï¼Œ$x = s \times 2^{k + 1} + 2^k$ï¼Œåˆ™ $y = (s + 1) \times 2^{k +1}$ï¼Œ$l(x) = s \times 2^{k + 1} + 1$ã€‚
    
    ä¸éš¾å‘ç° $\operatorname{lowbit}(y) \ge 2^{k + 1}$ï¼Œæ‰€ä»¥ $l(y) = (s + 1) \times 2^{k + 1} - \operatorname{lowbit}(y) + 1 \le s \times 2^{k +1} + 1= l(x)$ï¼Œå³ $l(y) \le l(x) \le x < y$ã€‚
    
    æ‰€ä»¥ï¼Œ$c[x]$ çœŸåŒ…å«äº $c[x + \operatorname{lowbit}(x)]$ã€‚

**æ€§è´¨ $3$ï¼šå¯¹äºä»»æ„ $\mathbf{x < y < x + \operatorname{lowbit}(x)}$ï¼Œæœ‰ $\mathbf{c[x]}$ å’Œ $\mathbf{c[y]}$ ä¸äº¤ã€‚**

??? note "è¯æ˜"
    è¯æ˜ï¼šè®¾ $x = s \times 2^{k + 1} + 2^k$ï¼Œåˆ™ $y = x + b = s \times 2^{k + 1} + 2^k + b$ï¼Œå…¶ä¸­ $1 \le b < 2^k$ã€‚
    
    ä¸éš¾å‘ç° $\operatorname{lowbit}(y) = \operatorname{lowbit}(b)$ã€‚åˆå› ä¸º $b - \operatorname{lowbit}(b) \ge 0$ï¼Œ
    
    å› æ­¤ $l(y) = y - \operatorname{lowbit}(y) + 1 = x + b - \operatorname{lowbit}(b) + 1 > x$ï¼Œå³ $l(x) \le x < l(y) \le y$ã€‚
    
    æ‰€ä»¥ï¼Œ$c[x]$ å’Œ $c[y]$ ä¸äº¤ã€‚

æœ‰äº†è¿™ä¸‰æ¡æ€§è´¨çš„é“ºå«ï¼Œæˆ‘ä»¬æ¥ä¸‹æ¥çœ‹æ ‘çŠ¶æ•°ç»„çš„æ ‘å½¢æ€ï¼ˆè¯·å¿½ç•¥ $a$ å‘ $c$ çš„è¿è¾¹ï¼‰ã€‚

![](./images/fenwick.svg)

äº‹å®ä¸Šï¼Œæ ‘çŠ¶æ•°ç»„çš„æ ‘å½¢æ€æ˜¯ $x$ å‘ $x + \operatorname{lowbit}(x)$ è¿è¾¹å¾—åˆ°çš„å›¾ï¼Œå…¶ä¸­ $x + \operatorname{lowbit}(x)$ æ˜¯ $x$ çš„çˆ¶äº²ã€‚

æ³¨æ„ï¼Œåœ¨è€ƒè™‘æ ‘çŠ¶æ•°ç»„çš„æ ‘å½¢æ€æ—¶ï¼Œæˆ‘ä»¬ä¸è€ƒè™‘æ ‘çŠ¶æ•°ç»„å¤§å°çš„å½±å“ï¼Œå³æˆ‘ä»¬è®¤ä¸ºè¿™æ˜¯ä¸€æ£µæ— é™å¤§çš„æ ‘ï¼Œæ–¹ä¾¿åˆ†æã€‚å®é™…å®ç°æ—¶ï¼Œæˆ‘ä»¬åªéœ€ç”¨åˆ° $x \le n$ çš„ $c[x]$ï¼Œå…¶ä¸­ $n$ æ˜¯åŸæ•°ç»„é•¿åº¦ã€‚

è¿™æ£µæ ‘å¤©ç„¶æ»¡è¶³äº†å¾ˆå¤šç¾å¥½æ€§è´¨ï¼Œä¸‹é¢åˆ—ä¸¾è‹¥å¹²ï¼ˆè®¾ $fa[u]$ è¡¨ç¤º $u$ çš„ç›´ç³»çˆ¶äº²ï¼‰ï¼š

-   $u < fa[u]$ã€‚
-   $u$ å¤§äºä»»ä½•ä¸€ä¸ª $u$ çš„åä»£ï¼Œå°äºä»»ä½•ä¸€ä¸ª $u$ çš„ç¥–å…ˆã€‚
-   ç‚¹ $u$ çš„ $\operatorname{lowbit}$ ä¸¥æ ¼å°äº $fa[u]$ çš„ $\operatorname{lowbit}$ã€‚

??? note "è¯æ˜"
    è®¾ $y = x + \operatorname{lowbit}(x)$ï¼Œ$x = s \times 2^{k + 1} + 2^k$ï¼Œåˆ™ $y = (s + 1) \times 2^{k +1}$ï¼Œä¸éš¾å‘ç° $\operatorname{lowbit}(y) \ge 2^{k + 1} > \operatorname{lowbit}(x)$ï¼Œè¯æ¯•ã€‚

-   ç‚¹ $x$ çš„é«˜åº¦æ˜¯ $\log_2\operatorname{lowbit}(x)$ï¼Œå³ $x$ äºŒè¿›åˆ¶æœ€ä½ä½ `1` çš„ä½æ•°ã€‚

??? note "é«˜åº¦çš„å®šä¹‰"
    ç‚¹ $x$ çš„é«˜åº¦ $h(x)$ æ»¡è¶³ï¼šå¦‚æœ $x \bmod 2 = 1$ï¼Œåˆ™ $h(x) = 0$ï¼Œå¦åˆ™ $h(x) = \max(h(y)) + 1$ï¼Œå…¶ä¸­ $y$ ä»£è¡¨ $x$ çš„æ‰€æœ‰å„¿å­ï¼ˆæ­¤æ—¶ $x$ è‡³å°‘å­˜åœ¨ä¸€ä¸ªå„¿å­ $x - 1$ï¼‰ã€‚
    
    ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€ä¸ªç‚¹çš„é«˜åº¦æ°å¥½æ¯”å®ƒæœ€é«˜çš„é‚£ä¸ªå„¿å­å†é«˜ $1$ã€‚å¦‚æœä¸€ä¸ªç‚¹æ²¡æœ‰å„¿å­ï¼Œå®ƒçš„é«˜åº¦æ˜¯ $0$ã€‚
    
    è¿™é‡Œå¼•å‡ºé«˜åº¦è¿™ä¸€æ¦‚å¿µï¼Œæ˜¯ä¸ºåé¢è§£é‡Šå¤æ‚åº¦æ›´æ–¹ä¾¿ã€‚

-   $c[u]$ çœŸåŒ…å«äº $c[fa[u]]$ï¼ˆæ€§è´¨ $2$ï¼‰ã€‚
-   $c[u]$ çœŸåŒ…å«äº $c[v]$ï¼Œå…¶ä¸­ $v$ æ˜¯ $u$ çš„ä»»ä¸€ç¥–å…ˆï¼ˆåœ¨ä¸Šä¸€æ¡æ€§è´¨ä¸Šå½’çº³ï¼‰ã€‚
-   $c[u]$ çœŸåŒ…å« $c[v]$ï¼Œå…¶ä¸­ $v$ æ˜¯ $u$ çš„ä»»ä¸€åä»£ï¼ˆä¸Šé¢é‚£æ¡æ€§è´¨ $u$ï¼Œ$v$ é¢ å€’ï¼‰ã€‚
-   å¯¹äºä»»æ„ $v' > u$ï¼Œè‹¥ $v'$ ä¸æ˜¯ $u$ çš„ç¥–å…ˆï¼Œåˆ™ $c[u]$ å’Œ $c[v']$ ä¸äº¤ã€‚

??? note "è¯æ˜"
    $u$ å’Œ $u$ çš„ç¥–å…ˆä¸­ï¼Œä¸€å®šå­˜åœ¨ä¸€ä¸ªç‚¹ $v$ ä½¿å¾— $v < v' < fa[v]$ï¼Œæ ¹æ®æ€§è´¨ $3$ å¾— $c[v']$ ä¸ç›¸äº¤äº $c[v]$ï¼Œè€Œ $c[v]$ åŒ…å« $c[u]$ï¼Œå› æ­¤ $c[v']$ ä¸äº¤äº $c[u]$ã€‚

-   å¯¹äºä»»æ„ $v < u$ï¼Œå¦‚æœ $v$ ä¸åœ¨ $u$ çš„å­æ ‘ä¸Šï¼Œåˆ™ $c[u]$ å’Œ $c[v]$ ä¸äº¤ï¼ˆä¸Šé¢é‚£æ¡æ€§è´¨ $u$ï¼Œ$v'$ é¢ å€’ï¼‰ã€‚
-   å¯¹äºä»»æ„ $v > u$ï¼Œå½“ä¸”ä»…å½“ $v$ æ˜¯ $u$ çš„ç¥–å…ˆï¼Œ$c[u]$ çœŸåŒ…å«äº $c[v]$ï¼ˆä¸Šé¢å‡ æ¡æ€§è´¨çš„æ€»ç»“ï¼‰ã€‚è¿™å°±æ˜¯æ ‘çŠ¶æ•°ç»„å•ç‚¹ä¿®æ”¹çš„æ ¸å¿ƒåŸç†ã€‚
-   è®¾ $u = s \times 2^{k + 1} + 2^k$ï¼Œåˆ™å…¶å„¿å­æ•°é‡ä¸º $k = \log_2\operatorname{lowbit}(u)$ï¼Œç¼–å·åˆ†åˆ«ä¸º $u - 2^t(0 \le t < k)$ã€‚
    -   ä¸¾ä¾‹ï¼šå‡è®¾ $k = 3$ï¼Œ$u$ çš„äºŒè¿›åˆ¶ç¼–å·ä¸º `...1000`ï¼Œåˆ™ $u$ æœ‰ä¸‰ä¸ªå„¿å­ï¼ŒäºŒè¿›åˆ¶ç¼–å·åˆ†åˆ«ä¸º `...0111`ã€`...0110`ã€`...0100`ã€‚

??? note "è¯æ˜"
    åœ¨ä¸€ä¸ªæ•° $x$ çš„åŸºç¡€ä¸Šå‡å» $2^t$ï¼Œ$x$ äºŒè¿›åˆ¶ç¬¬ $t$ ä½ä¼šåè½¬ï¼Œè€Œæ›´ä½çš„ä½ä¿æŒä¸å˜ã€‚
    
    è€ƒè™‘ $u$ çš„å„¿å­ $v$ï¼Œæœ‰ $v + \operatorname{lowbit}(v) = u$ï¼Œå³ $v = u - 2^t$ ä¸” $\operatorname{lowbit}(v) = 2^t$ã€‚è®¾ $u = s \times 2^{k + 1} + 2^k$ã€‚
    
    **è€ƒè™‘ $\mathbf{0 \le t < k}$**ï¼Œ$u$ çš„ç¬¬ $t$ ä½åŠåæ–¹å‡ä¸º $0$ï¼Œæ‰€ä»¥ $v = u - 2^t$ çš„ç¬¬ $t$ ä½å˜ä¸º $1$ï¼Œåé¢ä»ä¸º $0$ï¼Œ**æ»¡è¶³** $\operatorname{lowbit}(v) = 2^t$ã€‚
    
    **è€ƒè™‘ $\mathbf{t = k}$**ï¼Œåˆ™ $v = u - 2^k$ï¼Œ$v$ çš„ç¬¬ $k$ ä½å˜ä¸º $0$ï¼Œ**ä¸æ»¡è¶³** $\operatorname{lowbit}(v) = 2^t$ã€‚
    
    **è€ƒè™‘ $\mathbf{t > k}$**ï¼Œåˆ™ $v = u - 2^t$ï¼Œ$v$ çš„ç¬¬ $k$ ä½æ˜¯ $1$ï¼Œæ‰€ä»¥ $\operatorname{lowbit}(v) = 2^k$ï¼Œ**ä¸æ»¡è¶³** $\operatorname{lowbit}(v) = 2^t$ã€‚

-   $u$ çš„æ‰€æœ‰å„¿å­å¯¹åº” $c$ çš„ç®¡è¾–åŒºé—´æ°å¥½æ‹¼æ¥æˆ $[l(u), u - 1]$ã€‚
    -   ä¸¾ä¾‹ï¼šå‡è®¾ $k = 3$ï¼Œ$u$ çš„äºŒè¿›åˆ¶ç¼–å·ä¸º `...1000`ï¼Œåˆ™ $u$ æœ‰ä¸‰ä¸ªå„¿å­ï¼ŒäºŒè¿›åˆ¶ç¼–å·åˆ†åˆ«ä¸º `...0111`ã€`...0110`ã€`...0100`ã€‚
    -   `c[...0100]` è¡¨ç¤º `a[...0001 ~ ...0100]`ã€‚
    -   `c[...0110]` è¡¨ç¤º `a[...0101 ~ ...0110]`ã€‚
    -   `c[...0111]` è¡¨ç¤º `a[...0111 ~ ...0111]`ã€‚
    -   ä¸éš¾å‘ç°ä¸Šé¢æ˜¯ä¸‰ä¸ªç®¡è¾–åŒºé—´çš„å¹¶é›†æ°å¥½æ˜¯ `a[...0001 ~ ...0111]`ï¼Œå³ $[l(u), u - 1]$ã€‚

??? note "è¯æ˜"
    $u$ çš„å„¿å­æ€»èƒ½è¡¨ç¤ºæˆ $u - 2^t(0 \le t < k)$ï¼Œä¸éš¾å‘ç°ï¼Œ$t$ è¶Šå°ï¼Œ$u - 2^t$ è¶Šå¤§ï¼Œä»£è¡¨çš„åŒºé—´è¶Šé å³ã€‚æˆ‘ä»¬è®¾ $f(t) = u - 2^t$ï¼Œåˆ™ $f(k - 1), f(k - 2), \ldots, f(0)$ åˆ†åˆ«æ„æˆ $u$ ä»å·¦åˆ°å³çš„å„¿å­ã€‚
    
    ä¸éš¾å‘ç° $\operatorname{lowbit}(f(t)) = 2^t$ï¼Œæ‰€ä»¥ $l(f(t)) = u - 2^t - 2^t + 1 = u - 2^{t + 1} + 1$ã€‚
    
    è€ƒè™‘ç›¸é‚»çš„ä¸¤ä¸ªå„¿å­ $f(t + 1)$ å’Œ $f(t)$ã€‚å‰è€…ç®¡è¾–åŒºé—´çš„å³ç«¯ç‚¹æ˜¯ $f(t + 1) = u - 2^{t + 1}$ï¼Œåè€…ç®¡è¾–åŒºé—´çš„å·¦ç«¯ç‚¹æ˜¯ $l(f(t)) = u - 2^{t + 1} + 1$ï¼Œæ°å¥½ç›¸æ¥ã€‚
    
    è€ƒè™‘æœ€å·¦é¢çš„å„¿å­ $f(k - 1)$ï¼Œå…¶ç®¡è¾–å·¦è¾¹ç•Œ $l(f(k - 1)) = u - 2^k + 1$ æ°ä¸º $l(u)$ã€‚
    
    è€ƒè™‘æœ€å³é¢çš„å„¿å­ $f(0)$ï¼Œå…¶ç®¡è¾–å³è¾¹ç•Œå°±æ˜¯ $u - 1$ã€‚
    
    å› æ­¤ï¼Œè¿™äº›å„¿å­çš„ç®¡è¾–åŒºé—´å¯ä»¥æ°å¥½æ‹¼æˆ $[l(u), u - 1]$ã€‚

### å•ç‚¹ä¿®æ”¹

ç°åœ¨æ¥è€ƒè™‘å¦‚ä½•å•ç‚¹ä¿®æ”¹ $a[x]$ã€‚

æˆ‘ä»¬çš„ç›®æ ‡æ˜¯å¿«é€Ÿæ­£ç¡®åœ°ç»´æŠ¤ $c$ æ•°ç»„ã€‚ä¸ºä¿è¯æ•ˆç‡ï¼Œæˆ‘ä»¬åªéœ€éå†å¹¶ä¿®æ”¹ç®¡è¾–äº† $a[x]$ çš„æ‰€æœ‰ $c[y]$ï¼Œå› ä¸ºå…¶ä»–çš„ $c$ æ˜¾ç„¶æ²¡æœ‰å‘ç”Ÿå˜åŒ–ã€‚

ç®¡è¾– $a[x]$ çš„ $c[y]$ ä¸€å®šåŒ…å« $c[x]$ï¼ˆæ ¹æ®æ€§è´¨ $1$ï¼‰ï¼Œæ‰€ä»¥ $y$ åœ¨æ ‘çŠ¶æ•°ç»„æ ‘å½¢æ€ä¸Šæ˜¯ $x$ çš„ç¥–å…ˆã€‚å› æ­¤æˆ‘ä»¬ä» $x$ å¼€å§‹ä¸æ–­è·³çˆ¶äº²ï¼Œç›´åˆ°è·³å¾—è¶…è¿‡äº†åŸæ•°ç»„é•¿åº¦ä¸ºæ­¢ã€‚

è®¾ $n$ è¡¨ç¤º $a$ çš„å¤§å°ï¼Œä¸éš¾å†™å‡ºå•ç‚¹ä¿®æ”¹ $a[x]$ çš„è¿‡ç¨‹ï¼š

-   åˆå§‹ä»¤ $x' = x$ã€‚
-   ä¿®æ”¹ $c[x']$ã€‚
-   ä»¤ $x' \gets x' + \operatorname{lowbit}(x')$ï¼Œå¦‚æœ $x' > n$ è¯´æ˜å·²ç»è·³åˆ°å°½å¤´äº†ï¼Œç»ˆæ­¢å¾ªç¯ï¼›å¦åˆ™å›åˆ°ç¬¬äºŒæ­¥ã€‚

åŒºé—´ä¿¡æ¯å’Œå•ç‚¹ä¿®æ”¹çš„ç§ç±»ï¼Œå…±åŒå†³å®š $c[x']$ çš„ä¿®æ”¹æ–¹å¼ã€‚ä¸‹é¢ç»™å‡ ä¸ªä¾‹å­ï¼š

-   è‹¥ $c[x']$ ç»´æŠ¤åŒºé—´å’Œï¼Œä¿®æ”¹ç§ç±»æ˜¯å°† $a[x]$ åŠ ä¸Š $p$ï¼Œåˆ™ä¿®æ”¹æ–¹å¼åˆ™æ˜¯å°†æ‰€æœ‰ $c[x']$ ä¹ŸåŠ ä¸Š $p$ã€‚
-   è‹¥ $c[x']$ ç»´æŠ¤åŒºé—´ç§¯ï¼Œä¿®æ”¹ç§ç±»æ˜¯å°† $a[x]$ ä¹˜ä¸Š $p$ï¼Œåˆ™ä¿®æ”¹æ–¹å¼åˆ™æ˜¯å°†æ‰€æœ‰ $c[x']$ ä¹Ÿä¹˜ä¸Š $p$ã€‚

ç„¶è€Œï¼Œå•ç‚¹ä¿®æ”¹çš„è‡ªç”±æ€§ä½¿å¾—ä¿®æ”¹çš„ç§ç±»å’Œç»´æŠ¤çš„ä¿¡æ¯ä¸ä¸€å®šæ˜¯åŒç§è¿ç®—ï¼Œæ¯”å¦‚ï¼Œè‹¥ $c[x']$ ç»´æŠ¤åŒºé—´å’Œï¼Œä¿®æ”¹ç§ç±»æ˜¯å°† $a[x]$ èµ‹å€¼ä¸º $p$ï¼Œå¯ä»¥è€ƒè™‘è½¬åŒ–ä¸ºå°† $a[x]$ åŠ ä¸Š $p - a[x]$ã€‚å¦‚æœæ˜¯å°† $a[x]$ ä¹˜ä¸Š $p$ï¼Œå°±è€ƒè™‘è½¬åŒ–ä¸º $a[x]$ åŠ ä¸Š $a[x] \times p - a[x]$ã€‚

ä¸‹é¢ä»¥ç»´æŠ¤åŒºé—´å’Œï¼Œå•ç‚¹åŠ ä¸ºä¾‹ç»™å‡ºå®ç°ã€‚

???+ note "å®ç°"
    === "C++"

        ```cpp
        #define lowbit(x)  ((x) & - (x))   
        int tree[Maxn];
        void update(int x, int d) {   //ä¿®æ”¹å…ƒç´ ax,  ax = ax + d
            while(x <= Maxn) {
                tree[x] += d;  
                x += lowbit(x); 
            }
        }
        ```
    
    === "Python"
    
        ```python
        def add(x, k):
            while x <= n: # ä¸èƒ½è¶Šç•Œ
                c[x] = c[x] + k
                x = x + lowbit(x)
        ```

### å»ºæ ‘

ä¹Ÿå°±æ˜¯æ ¹æ®æœ€å¼€å§‹ç»™å‡ºçš„åºåˆ—ï¼Œå°†æ ‘çŠ¶æ•°ç»„å»ºå‡ºæ¥ï¼ˆ$c$ å…¨éƒ¨é¢„å¤„ç†å¥½ï¼‰ã€‚

ä¸€èˆ¬å¯ä»¥ç›´æ¥è½¬åŒ–ä¸º $n$ æ¬¡å•ç‚¹ä¿®æ”¹ï¼Œæ—¶é—´å¤æ‚åº¦ $\Theta(n \log n)$ï¼ˆå¤æ‚åº¦åˆ†æåœ¨åé¢ï¼‰ã€‚

æ¯”å¦‚ç»™å®šåºåˆ— $a = (5, 1, 4)$ è¦æ±‚å»ºæ ‘ï¼Œç›´æ¥çœ‹ä½œå¯¹ $a[1]$ å•ç‚¹åŠ  $5$ï¼Œå¯¹ $a[2]$ å•ç‚¹åŠ  $1$ï¼Œå¯¹ $a[3]$ å•ç‚¹åŠ  $4$ å³å¯ã€‚

ä¹Ÿæœ‰ $\Theta(n)$ çš„å»ºæ ‘æ–¹æ³•ï¼Œè§æœ¬é¡µé¢ [$\Theta(n)$ å»ºæ ‘](./#thetan-å»ºæ ‘) ä¸€èŠ‚ã€‚

### å¤æ‚åº¦åˆ†æ

ç©ºé—´å¤æ‚åº¦æ˜¾ç„¶ $\Theta(n)$ã€‚

æ—¶é—´å¤æ‚åº¦ï¼š

-   å¯¹äºåŒºé—´æŸ¥è¯¢æ“ä½œï¼šæ•´ä¸ª $x \gets x - \operatorname{lowbit}(x)$ çš„è¿­ä»£è¿‡ç¨‹ï¼Œå¯çœ‹åšå°† $x$ äºŒè¿›åˆ¶ä¸­çš„æ‰€æœ‰ $1$ï¼Œä»ä½ä½åˆ°é«˜ä½é€æ¸æ”¹æˆ $0$ çš„è¿‡ç¨‹ï¼Œæ‹†åˆ†å‡ºçš„åŒºé—´æ•°ç­‰äº $x$ äºŒè¿›åˆ¶ä¸­ $1$ çš„æ•°é‡ï¼ˆå³ $\operatorname{popcount}(x)$ï¼‰ã€‚å› æ­¤ï¼Œå•æ¬¡æŸ¥è¯¢æ—¶é—´å¤æ‚åº¦æ˜¯ $\Theta(\log n)$ï¼›
-   å¯¹äºå•ç‚¹ä¿®æ”¹æ“ä½œï¼šè·³çˆ¶äº²æ—¶ï¼Œè®¿é—®åˆ°çš„é«˜åº¦ä¸€ç›´ä¸¥æ ¼å¢åŠ ï¼Œä¸”å§‹ç»ˆæœ‰ $x \le n$ã€‚ç”±äºç‚¹ $x$ çš„é«˜åº¦æ˜¯ $\log_2\operatorname{lowbit}(x)$ï¼Œæ‰€ä»¥è·³åˆ°çš„é«˜åº¦ä¸ä¼šè¶…è¿‡ $\log_2n$ï¼Œæ‰€ä»¥è®¿é—®åˆ°çš„ $c$ çš„æ•°é‡æ˜¯ $\log n$ çº§åˆ«ã€‚å› æ­¤ï¼Œå•æ¬¡å•ç‚¹ä¿®æ”¹å¤æ‚åº¦æ˜¯ $\Theta(\log n)$ã€‚

* * *

ä¸‹é¢ä»‹ç»æ ‘çŠ¶æ•°ç»„çš„ç»å…¸åº”ç”¨ï¼Œå®ƒä»¬éƒ½ç»“åˆäº†â€œå·®åˆ†æ•°ç»„â€çš„æ¦‚å¿µï¼Œâ€œå·®åˆ†æ•°ç»„â€æ˜¯ç”¨äºåŒºé—´æŸ¥è¯¢çš„ä¸€ä¸ªæŠ€å·§ã€‚

## åŒºé—´ä¿®æ”¹ + å•ç‚¹æŸ¥è¯¢

ä¸€ä¸ªåºåˆ—ğ´=ğ‘1,ğ‘2,...,ğ‘ğ‘›çš„æ›´æ–°ï¼ˆä¿®æ”¹ï¼‰æœ‰ä¸¤ç§ï¼š

ï¼ˆ1ï¼‰å•ç‚¹ä¿®æ”¹ã€‚ä¸€æ¬¡æ”¹ä¸€ä¸ªæ•°ï¼›

ï¼ˆ2ï¼‰åŒºé—´ä¿®æ”¹ã€‚ä¸€æ¬¡æ”¹å˜ä¸€ä¸ªåŒºé—´\[ğ¿,ğ‘…\]å†…æ‰€æœ‰çš„æ•°ï¼Œä¾‹å¦‚æŠŠæ¯ä¸ªæ•°ç»Ÿä¸€åŠ ä¸Šğ‘‘ã€‚

æ ‘çŠ¶æ•°ç»„çš„åŸå§‹åŠŸèƒ½æ˜¯â€œå•ç‚¹ä¿®æ”¹ + åŒºé—´æŸ¥è¯¢â€ï¼Œæ˜¯å¦èƒ½æ‰©å±•ä¸ºâ€œåŒºé—´ä¿®æ”¹â€ï¼Ÿåªéœ€ä¸€ä¸ªç®€å•è€Œå·§å¦™çš„æ“ä½œï¼ˆå·®åˆ†æ•°ç»„ï¼‰ï¼Œå°±èƒ½æŠŠå•ç‚¹ä¿®æ”¹ç”¨æ¥å¤„ç†åŒºé—´ä¿®æ”¹é—®é¢˜ï¼Œå®ç°é«˜æ•ˆçš„â€œåŒºé—´ä¿®æ”¹ + å•ç‚¹æŸ¥è¯¢â€ï¼Œè¿›ä¸€æ­¥ä¹Ÿèƒ½åšåˆ°â€œåŒºé—´ä¿®æ”¹ + åŒºé—´æŸ¥è¯¢â€ã€‚

???+note "[Color the ball](https://vjudge.net/problem/HDU-1556)"
    **é—®é¢˜æè¿°ï¼š** Nä¸ªæ°”çƒæ’æˆä¸€æ’ï¼Œä»å·¦åˆ°å³ä¾æ¬¡ç¼–å·ä¸º1, 2, 3 .... Nã€‚æ¯æ¬¡ç»™å®š2ä¸ªæ•´æ•°L, R`(L<= R)`ï¼Œleleä»æ°”çƒLå¼€å§‹åˆ°æ°”çƒRä¾æ¬¡ç»™æ¯ä¸ªæ°”çƒæ¶‚ä¸€æ¬¡é¢œè‰²ã€‚ä½†æ˜¯Næ¬¡ä»¥åleleå·²ç»å¿˜è®°äº†ç¬¬iä¸ªæ°”çƒå·²ç»æ¶‚è¿‡å‡ æ¬¡é¢œè‰²äº†ï¼Œä½ èƒ½å¸®ä»–ç®—å‡ºæ¯ä¸ªæ°”çƒè¢«æ¶‚è¿‡å‡ æ¬¡é¢œè‰²å—ï¼Ÿ
    
    **è¾“å…¥ï¼š** æ¯ä¸ªæµ‹è¯•å®ä¾‹ç¬¬ä¸€è¡Œä¸ºä¸€ä¸ªæ•´æ•°Nï¼Œ`(N <= 100000)`ã€‚æ¥ä¸‹æ¥çš„Nè¡Œï¼Œæ¯è¡ŒåŒ…æ‹¬2ä¸ªæ•´æ•°`L, R(1 <= L<= R<= N)`ã€‚å½“N = 0ï¼Œè¾“å…¥ç»“æŸã€‚
    
    **è¾“å‡ºï¼š** æ¯ä¸ªæµ‹è¯•å®ä¾‹è¾“å‡ºä¸€è¡Œï¼ŒåŒ…æ‹¬Nä¸ªæ•´æ•°ï¼Œç¬¬Iä¸ªæ•°ä»£è¡¨ç¬¬Iä¸ªæ°”çƒæ€»å…±è¢«æ¶‚è‰²çš„æ¬¡æ•°ã€‚

???+note "è§£é¢˜æ€è·¯"
    å®šä¹‰æ•°ç»„ğ‘\[ğ‘–\]ä¸ºæ°”çƒğ‘–è¢«æ¶‚è‰²çš„æ¬¡æ•°ã€‚
    
    å¦‚æœç”¨æš´åŠ›å¤„ç†Næ¬¡åŒºé—´ä¿®æ”¹ï¼Œæ˜¯ğ‘‚(ğ‘2)çš„ã€‚ç”¨æ ‘çŠ¶æ•°ç»„ï¼Œå¦‚æœåªæ˜¯ç®€å•æŠŠåŒºé—´\[ğ¿,ğ‘…\]å†…çš„æ¯ä¸ªæ•°ğ‘\[ğ‘¥\]ç”¨ğ‘¢ğ‘ğ‘‘ğ‘ğ‘¡ğ‘’()è¿›è¡Œå•ç‚¹ä¿®æ”¹ï¼Œå¤æ‚åº¦æ›´å·®ï¼Œæ˜¯ğ‘‚(ğ‘2ğ‘™ğ‘œğ‘”ğ‘)çš„ã€‚ä¸‹é¢æŠŠå•ç‚¹ä¿®æ”¹å¤„ç†æˆåŒºé—´ä¿®æ”¹ï¼Œå¤æ‚åº¦ğ‘‚(ğ‘ğ‘™ğ‘œğ‘”ğ‘)ã€‚
    
    å¦‚ä½•ç”¨æ ‘çŠ¶æ•°ç»„å¤„ç†åŒºé—´ä¿®æ”¹ï¼Ÿé¢˜ç›®è¦æ±‚æŠŠ\[ğ¿,ğ‘…\]åŒºé—´å†…æ¯ä¸ªæ•°åŠ ä¸Šğ‘‘ï¼Œä½†æ˜¯ä¸‹é¢çš„è§£æ³•ä¸æ˜¯å¯¹åŒºé—´å†…æ¯ä¸ªæ•°åŠ ğ‘‘ï¼Œè€Œæ˜¯æ“ä½œä¸€ä¸ªè¢«ç§°ä¸ºâ€œå·®åˆ†æ•°ç»„â€çš„ğ·ï¼Œå®ƒçš„å®šä¹‰æ˜¯ï¼š
    
    `ğ·[ğ‘˜]=ğ‘[ğ‘˜]âˆ’ğ‘[ğ‘˜âˆ’1]`ï¼Œå³åŸæ•°ç»„ç›¸é‚»å…ƒç´ çš„å·®ã€‚
    
    ä»å®šä¹‰å¯ä»¥æ¨å‡ºï¼š
    
    `ğ‘[ğ‘˜]=ğ·[1]+ğ·[2]+...+ğ·[ğ‘˜]=âˆ‘ğ‘˜ğ‘–=1ğ·(ğ‘–)`
    
    è¿™ä¸ªå…¬å¼æ·±åˆ»åœ°æè¿°äº†ğ‘å’Œğ·çš„å…³ç³»ï¼Œâ€œå·®åˆ†æ˜¯å‰ç¼€å’Œçš„é€†è¿ç®—â€ï¼Œå®ƒæŠŠæ±‚ğ‘\[ğ‘˜\]è½¬åŒ–ä¸ºæ±‚ğ·çš„å‰ç¼€å’Œï¼Œå‰ç¼€å’Œæ­£é€‚åˆç”¨æ ‘çŠ¶æ•°ç»„æ¥å¤„ç†ã€‚
    
    å¯¹äºåŒºé—´\[ğ¿,ğ‘…\]çš„ä¿®æ”¹é—®é¢˜ï¼Œå¯¹ğ·åšä»¥ä¸‹æ“ä½œï¼š
    
    1. æŠŠğ·\[ğ¿\]åŠ ä¸Šğ‘‘ï¼›
    2. æŠŠğ·\[ğ‘…+1\]å‡å»ğ‘‘ã€‚

    ç„¶åç”¨æ ‘çŠ¶æ•°ç»„å‡½æ•°ğ‘ ğ‘¢ğ‘š()æ±‚å‰ç¼€å’Œ`ğ‘ ğ‘¢ğ‘š[ğ‘¥]=ğ·[1]+ğ·[2]+...+ğ·[ğ‘¥]`ï¼Œæœ‰ï¼š

    1. `1â‰¤ğ‘¥<ğ¿ï¼Œå‰ç¼€å’Œğ‘ ğ‘¢ğ‘š[ğ‘¥]`ä¸å˜ï¼›
    2. `ğ¿â‰¤ğ‘¥â‰¤ğ‘…ï¼Œå‰ç¼€å’Œğ‘ ğ‘¢ğ‘š[ğ‘¥]`å¢åŠ äº†ğ‘‘ï¼›
    3. `ğ‘…<ğ‘¥â‰¤ğ‘ï¼Œå‰ç¼€å’Œğ‘ ğ‘¢ğ‘š[ğ‘¥]`ä¸å˜ï¼Œå› ä¸ºè¢«ğ·\[ğ‘…+1\]ä¸­å‡å»çš„ğ‘‘æŠµæ¶ˆäº†ã€‚

    ğ‘ ğ‘¢ğ‘š\[ğ‘¥\]çš„å€¼ä¸ç›´æ¥æŠŠ\[ğ¿,ğ‘…\]åŒºé—´å†…æ¯ä¸ªæ•°åŠ ä¸Šğ‘‘å¾—åˆ°çš„ğ‘\[ğ‘¥\]æ˜¯ç›¸ç­‰çš„ã€‚è¿™æ ·ï¼Œå°±åˆ©ç”¨æ ‘çŠ¶æ•°ç»„é«˜æ•ˆåœ°è®¡ç®—å‡ºäº†åŒºé—´ä¿®æ”¹åçš„ğ‘\[ğ‘¥\]ã€‚

???+note "å‚è€ƒä»£ç "
    === "æ ‘çŠ¶æ•°ç»„"
        ```cpp
        //tree[Maxn]ï¼Œlowbit(x)ï¼Œupdate()ï¼Œsum()çš„ä»£ç å‰é¢å·²ç»™å‡º
        const int Maxn = 100010;
        int main(){
            int n;
            while(~scanf("%d",&n)) {  
                memset(tree,0,sizeof(tree));          //åªéœ€è¦ä¸€ä¸ªtree[]æ•°ç»„
                for(int i=1;i<=n;i++) {               //åŒºé—´ä¿®æ”¹
                    int L, R; 
                    scanf("%d%d",&L,&R);
                    update(L,1);                       //æœ¬é¢˜çš„d = 1
                    update(R+1,-1);
                }
                for(int i=1;i<=n;i++){                //å•ç‚¹æŸ¥è¯¢
                    if(i!=n)  printf("%d ",sum(i));   //æŠŠsum(i)çœ‹æˆa[i]
                    else      printf("%d\n",sum(i));
                }
            }
            return 0;
        }
        ```

        ä»£ç ä¸­çš„ç¬¬ä¸€ä¸ªğ‘“ğ‘œğ‘Ÿå¾ªç¯åšäº†ğ‘›æ¬¡åŒºé—´ä¿®æ”¹ï¼Œå¤æ‚åº¦ğ‘‚(ğ‘›ğ‘™ğ‘œğ‘”ğ‘›)ï¼›ç¬¬äºŒä¸ªğ‘“ğ‘œğ‘Ÿå¾ªç¯åšäº†ğ‘›æ¬¡å•ç‚¹æŸ¥è¯¢ï¼Œå¤æ‚åº¦ğ‘‚(ğ‘›ğ‘™ğ‘œğ‘”ğ‘›)ã€‚åŠ èµ·æ¥æ€»å¤æ‚åº¦ä»æ˜¯ğ‘‚(ğ‘›ğ‘™ğ‘œğ‘”ğ‘›)ã€‚

    === "å·®åˆ†æ•°ç»„"
        ```cpp
        #include<bits/stdc++.h>
        using namespace std;
        const int Maxn = 100010;
        int a[Maxn],D[Maxn];               //aæ˜¯æ°”çƒï¼ŒDæ˜¯å·®åˆ†æ•°ç»„
        int main(){
            int n;
            while(~scanf("%d",&n)) { 
                memset(a,0,sizeof(a)); memset(D,0,sizeof(D));
                for(int i=1;i<=n;i++){
                    int L,R; scanf("%d%d",&L,&R);
                    D[L]++;                 //å·®åˆ†ï¼ŒåŸç†å’Œå‰é¢æ ‘çŠ¶æ•°ç»„ä¸€æ ·
                    D[R+1]--;
                }
                for(int i=1;i<=n;i++){
                    a[i] = a[i-1] + D[i];          //æ±‚å‰ç¼€å’Œa[]ï¼Œa[i]å°±æ˜¯æ°”çƒiçš„å€¼
                    if(i!=n)  printf("%d ", a[i]);  //é€ä¸ªæ‰“å°ç»“æœ
                    else      printf("%d\n",a[i]);
                }        
            }
            return 0;
        }
        ```

        ä¸è¿‡ï¼Œé‡åˆ°â€œåŒºé—´ä¿®æ”¹â€è¿™ç§é¢˜å‹ï¼Œè¿˜æ˜¯å»ºè®®ç”¨æ ‘çŠ¶æ•°ç»„æ¥æ±‚è§£ã€‚åŸå› æ˜¯å·®åˆ†æ•°ç»„å¯¹â€œåŒºé—´ä¿®æ”¹â€æ˜¯å¾ˆé«˜æ•ˆçš„ï¼Œä½†æ˜¯å¯¹â€œå•ç‚¹æŸ¥è¯¢â€å¹¶ä¸é«˜æ•ˆã€‚å³ä½¿åªæŸ¥è¯¢ä¸€ä¸ªå‰ç¼€å’Œï¼Œå·®åˆ†æ•°ç»„ä»ç„¶è¦è®¡ç®—æ‰€æœ‰çš„å‰ç¼€å’Œï¼Œå¤æ‚åº¦ğ‘‚(ğ‘›)ï¼›è€Œæ ‘çŠ¶æ•°ç»„åšä¸€æ¬¡å‰ç¼€å’Œè®¡ç®—æ˜¯ğ‘‚(ğ‘™ğ‘œğ‘”ğ‘›)çš„ã€‚

## åŒºé—´ä¿®æ”¹ + åŒºé—´æŸ¥è¯¢

å‰é¢çš„ä¾‹é¢˜å®Œæˆçš„æ˜¯â€œåŒºé—´ä¿®æ”¹ + å•ç‚¹æŸ¥è¯¢â€ï¼Œä¸‹é¢è€ƒè™‘æŠŠå•ç‚¹æŸ¥è¯¢æ‰©å±•åˆ°åŒºé—´æŸ¥è¯¢ï¼Œå³æŸ¥è¯¢çš„ä¸æ˜¯ä¸€ä¸ªå•ç‚¹ğ‘\[ğ‘¥\]çš„å€¼ï¼Œè€Œæ˜¯åŒºé—´\[ğ‘–,ğ‘—\]çš„å’Œã€‚

ä»…ä»…ç”¨ä¸€ä¸ªæ ‘çŠ¶æ•°ç»„ï¼Œæ— æ³•åŒæ—¶é«˜æ•ˆåœ°å®Œæˆâ€œåŒºé—´ä¿®æ”¹â€å’Œâ€œåŒºé—´æŸ¥è¯¢â€ï¼Œå› ä¸ºè¿™ä¸ªæ ‘çŠ¶æ•°ç»„çš„tree\[\]å·²ç»ç”¨äºâ€œåŒºé—´ä¿®æ”¹â€ï¼Œå®ƒç”¨ğ‘ ğ‘¢ğ‘š()è®¡ç®—äº†å•ç‚¹ğ‘\[ğ‘¥\]ï¼Œä¸èƒ½å†ç”¨äºæ±‚`ğ‘[ğ‘–]~ğ‘[ğ‘—]`çš„åŒºé—´å’Œã€‚

è¯»è€…å¯èƒ½æƒ³åˆ°å†åŠ ä¸€ä¸ªæ ‘çŠ¶æ•°ç»„ï¼Œä¹Ÿè®¸èƒ½æ¥ç€é«˜æ•ˆåœ°å®ŒæˆåŒºé—´æŸ¥è¯¢ã€‚ä½†æ˜¯å¦‚æœè¿™ä¸¤ä¸ªæ ‘çŠ¶æ•°ç»„åªæ˜¯ç®€å•åœ°ä¸€ä¸ªåšâ€œåŒºé—´ä¿®æ”¹â€ï¼Œä¸€ä¸ªåšâ€œåŒºé—´æŸ¥è¯¢â€ï¼Œåˆèµ·æ¥æ•ˆç‡å¹¶ä¸é«˜ã€‚åšä¸€æ¬¡é•¿åº¦ä¸ºğ‘˜çš„åŒºé—´ä¿®æ”¹ï¼Œè®¡ç®—åŒºé—´å†…æ¯ä¸ªğ‘\[ğ‘¥\]çš„å¤æ‚åº¦æ˜¯ğ‘‚(ğ‘™ğ‘œğ‘”ğ‘›)çš„ï¼›å¦‚æœç»§ç»­ç”¨ä¸€ä¸ªæ ‘çŠ¶æ•°ç»„å¤„ç†è¿™ğ‘˜ä¸ªğ‘\[ğ‘¥\]ï¼Œå¤æ‚åº¦æ˜¯ğ‘‚(ğ‘˜ğ‘™ğ‘œğ‘”ğ‘›)çš„ï¼›åšğ‘›æ¬¡ä¿®æ”¹å’Œè¯¢é—®ï¼Œæ€»å¤æ‚åº¦ğ‘‚(ğ‘›2ğ‘™ğ‘œğ‘”ğ‘›)ã€‚

è¿™ä¸¤ä¸ªæ ‘çŠ¶æ•°ç»„éœ€è¦ç´§å¯†ç»“åˆæ‰èƒ½é«˜æ•ˆå®Œæˆâ€œåŒºé—´ä¿®æ”¹ + åŒºé—´æŸ¥è¯¢â€ï¼Œç§°ä¸ºâ€œäºŒé˜¶æ ‘çŠ¶æ•°ç»„â€ï¼Œå®ƒä¹Ÿæ˜¯â€œå·®åˆ†æ•°ç»„â€æ¦‚å¿µå’Œæ ‘çŠ¶æ•°ç»„çš„ç»“åˆã€‚ä¸‹é¢ç»™å‡ºä¸€ä¸ªå…¸å‹ä¾‹é¢˜ã€‚

???+note "[ã€æ¨¡æ¿ã€‘çº¿æ®µæ ‘ 1](https://www.luogu.com.cn/problem/P3372)"
    **é—®é¢˜æè¿°ï¼š** å·²çŸ¥ä¸€ä¸ªæ•°åˆ—ï¼Œè¿›è¡Œä¸¤ç§æ“ä½œï¼šï¼ˆ1ï¼‰æŠŠæŸåŒºé—´æ¯ä¸ªæ•°åŠ ä¸Šdï¼›ï¼ˆ2ï¼‰æ±‚æŸåŒºé—´æ‰€æœ‰æ•°çš„å’Œã€‚
    
    **è¾“å…¥ï¼š** ç¬¬ä¸€è¡ŒåŒ…å«ä¸¤ä¸ªæ•´æ•° nï¼Œmï¼Œåˆ†åˆ«è¡¨ç¤ºè¯¥æ•°åˆ—æ•°å­—çš„ä¸ªæ•°å’Œæ“ä½œçš„æ€»ä¸ªæ•°ã€‚ç¬¬äºŒè¡ŒåŒ…å«nä¸ªç”¨ç©ºæ ¼åˆ†éš”çš„æ•´æ•°ï¼Œå…¶ä¸­ç¬¬iä¸ªæ•°å­—è¡¨ç¤ºæ•°åˆ—ç¬¬ié¡¹çš„åˆå§‹å€¼ã€‚æ¥ä¸‹æ¥mè¡Œæ¯è¡ŒåŒ…å«3æˆ–4ä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºä¸€ä¸ªæ“ä½œï¼Œå…·ä½“å¦‚ä¸‹ï¼š
    
    ï¼ˆ1ï¼‰1 L R dï¼šå°†åŒºé—´[L, R]å†…æ¯ä¸ªæ•°åŠ ä¸Šdã€‚
    
    ï¼ˆ2ï¼‰2 L Rï¼šè¾“å‡ºåŒºé—´[L, R]å†…æ¯ä¸ªæ•°çš„å’Œã€‚
    
    **è¾“å‡ºï¼š** è¾“å‡ºåŒ…å«è‹¥å¹²è¡Œæ•´æ•°ï¼Œå³ä¸ºæ‰€æœ‰æ“ä½œï¼ˆ2ï¼‰çš„ç»“æœã€‚
    
    `1â‰¤ğ‘›ï¼Œğ‘šâ‰¤10^5ï¼Œå…ƒç´ çš„å€¼åœ¨[âˆ’2^63,2^63)å†…`ã€‚

???+note "è§£é¢˜æ€è·¯"
    æ“ä½œï¼ˆ1ï¼‰æ˜¯åŒºé—´ä¿®æ”¹ï¼Œæ“ä½œï¼ˆ2ï¼‰æ˜¯åŒºé—´æŸ¥è¯¢ã€‚
    
    é¦–å…ˆï¼Œæ±‚åŒºé—´å’Œ`ğ‘ ğ‘¢ğ‘š(ğ¿,ğ‘…)=ğ‘[ğ¿]+ğ‘[ğ¿+1]+...+ğ‘[ğ‘…]=ğ‘ ğ‘¢ğ‘š(1,ğ‘…)âˆ’ğ‘ ğ‘¢ğ‘š(1,ğ¿âˆ’1)`ï¼Œé—®é¢˜è½¬åŒ–ä¸ºæ±‚ğ‘ ğ‘¢ğ‘š(1,ğ‘˜)ã€‚
    
    å®šä¹‰ä¸€ä¸ªå·®åˆ†æ•°ç»„ğ·ï¼Œå®ƒå’ŒåŸæ•°ç»„açš„å…³ç³»ä»ç„¶æ˜¯`ğ·[ğ‘˜]=ğ‘[ğ‘˜]âˆ’ğ‘[ğ‘˜âˆ’1]ï¼Œæœ‰ğ‘[ğ‘˜]=ğ·[1]+ğ·[2]+...+ğ·[ğ‘˜]`ï¼Œä¸‹é¢æ¨å¯¼åŒºé—´å’Œï¼Œçœ‹å®ƒå’Œæ±‚å‰ç¼€å’Œæœ‰æ²¡æœ‰å…³ç³»ï¼Œå¦‚æœæœ‰å…³ç³»ï¼Œå°±èƒ½ç”¨æ ‘çŠ¶æ•°ç»„ã€‚

    `ğ‘1+ğ‘2+...+ğ‘ğ‘˜
    =ğ·1+(ğ·1+ğ·2)+(ğ·1+ğ·2+ğ·3)+...+(ğ·1+ğ·2+...+ğ·ğ‘˜)
    =ğ‘˜âˆ—ğ·1+(ğ‘˜âˆ’1)âˆ—ğ·2+(ğ‘˜âˆ’2)âˆ—ğ·3+...+(ğ‘˜âˆ’(ğ‘˜âˆ’1))ğ·ğ‘˜
    =ğ‘˜(ğ·1+ğ·2+...+ğ·ğ‘˜)âˆ’(ğ·2+2ğ·3+...+(ğ‘˜âˆ’1)ğ·ğ‘˜)
    =ğ‘˜âˆ‘ğ‘˜ğ‘–=1ğ·ğ‘–âˆ’âˆ‘ğ‘˜ğ‘–=1(ğ‘–âˆ’1)ğ·ğ‘–`

    è¿™æ˜¯æ±‚ä¸¤ä¸ªå‰ç¼€å’Œï¼Œç”¨ä¸¤ä¸ªæ ‘çŠ¶æ•°ç»„åˆ†åˆ«å¤„ç†ï¼Œä¸€ä¸ªå®ç°ğ·ğ‘–ï¼Œä¸€ä¸ªå®ç°(ğ‘–âˆ’1)ğ·ğ‘–ã€‚
    
    ä¸‹é¢æ˜¯â€œåŒºé—´ä¿®æ”¹ + åŒºé—´æŸ¥è¯¢â€çš„ä»£ç ï¼Œå®Œå…¨é‡ç°äº†ä¸Šé¢æ¨å¯¼å‡ºçš„ç»“è®ºã€‚
    
    ä»£ç ä¸­çš„ğ‘¢ğ‘ğ‘‘ğ‘ğ‘¡ğ‘’1()å’Œğ‘¢ğ‘ğ‘‘ğ‘ğ‘¡ğ‘’2()ã€ğ‘ ğ‘¢ğ‘š1()å’Œğ‘ ğ‘¢ğ‘š2()å‡ ä¹ä¸€æ ·ã€‚ä¹Ÿå¯ä»¥åˆèµ·æ¥å†™æˆğ‘¢ğ‘ğ‘‘ğ‘ğ‘¡ğ‘’1(ğ‘™ğ‘™ ğ‘¥,ğ‘™ğ‘™ ğ‘‘,ğ‘–ğ‘›ğ‘¡ ğ‘£)çš„æ ·å­ï¼Œç”¨ğ‘£æ¥åŒºåˆ†å¤„ç†ğ‘¡ğ‘Ÿğ‘’ğ‘’1å’Œğ‘¡ğ‘Ÿğ‘’ğ‘’2ã€‚ä¸è¿‡åƒä¸‹é¢è¿™æ ·åˆ†å¼€å†™æ›´æ¸…æ™°ï¼Œç¼–ç æ›´å¿«ã€‚
    
    ä»£ç çš„å¤æ‚åº¦æ˜¯ğ‘‚(ğ‘šğ‘™ğ‘œğ‘”ğ‘›)ã€‚

???+note "å‚è€ƒä»£ç "
    ```cpp
    #include<bits/stdc++.h>
    using namespace std;
    #define ll long long
    const int Maxn = 100010;
    #define lowbit(x)  ((x) & - (x))   
    ll tree1[Maxn],tree2[Maxn];         //2ä¸ªæ ‘çŠ¶æ•°ç»„
    void update1(ll x,ll d){
        while(x<=Maxn){
            tree1[x]+=d;  x+=lowbit(x);
        }
    }
    void update2(ll x,ll d){
        while(x<=Maxn){
            tree2[x]+=d;  x+=lowbit(x);
        }
    }
    ll   sum1(ll x){
        ll ans = 0;
        while(x>0) {
            ans+=tree1[x];x-=lowbit(x);
        }
        return ans;
    }
    ll   sum2(ll x){
        ll ans = 0;
        while(x>0) {
            ans+=tree2[x];x-=lowbit(x);
        }
        return ans;
    }
    int main(){
        ll n, m; scanf("%lld%lld",&n,&m);
        ll old = 0, a;
        for (int i=1;i<=n;i++) {        
            scanf("%lld",&a);      //è¾“å…¥æ¯ä¸ªåˆå§‹å€¼
            update1(i, a-old);     //å·®åˆ†æ•°ç»„åŸç†ï¼Œåˆå§‹åŒ–
            update2(i,(i-1)*(a-old));
            old = a;
        }
        while (m--){                     //mä¸ªæ“ä½œ
            ll q, L, R, d; 
            scanf("%lld",&q);
            if (q==1){                   //åŒºé—´ä¿®æ”¹
                scanf("%lld%lld%lld",&L, &R, &d);
                update1(L,d);            //ç¬¬1ä¸ªæ ‘çŠ¶æ•°ç»„
                update1(R+1,-d); 
                update2(L,d*(L-1));      //ç¬¬2ä¸ªæ ‘çŠ¶æ•°ç»„
                update2(R+1,-d*R);       //d*R = d*(R+1-1)
            }
            else {                       //åŒºé—´è¯¢é—®
                scanf("%lld%lld",&L,&R);
                printf("%lld\n",R*sum1(R)-sum2(R) - (L-1)*sum1(L-1)+sum2(L-1));
            } 
        }
        return 0;
    }
    ```

## äºŒç»´åŒºé—´ä¿®æ”¹ + åŒºé—´æŸ¥è¯¢
å‰é¢çš„ä¾‹é¢˜éƒ½æ˜¯ä¸€ç»´çš„ï¼Œä¸‹é¢ç»™å‡ºä¸€ä¸ªäºŒç»´æ±‚â€œåŒºé—´ä¿®æ”¹+åŒºé—´æŸ¥è¯¢â€çš„ä¾‹é¢˜ã€‚

???+note "[ä¸Šå¸é€ é¢˜çš„ä¸ƒåˆ†é’Ÿ](https://www.luogu.com.cn/problem/P4514)"
    **è¾“å…¥ï¼š** ç¬¬ä¸€è¡Œæ˜¯X n mï¼Œä»£è¡¨çŸ©é˜µå¤§å°ä¸ºnÃ—mã€‚ä»ç¬¬äºŒè¡Œå¼€å§‹åˆ°æ–‡ä»¶å°¾çš„æ¯ä¸€è¡Œå‡ºç°ä»¥ä¸‹ä¸¤ç§æ“ä½œï¼š
    
    L a b c d delta ä»£è¡¨å°†(a,b),(c,d)ä¸ºé¡¶ç‚¹çš„çŸ©å½¢åŒºåŸŸå†…æ‰€æœ‰æ•°å­—åŠ ä¸Šdeltaã€‚
    
    k a b c d ä»£è¡¨æ±‚(a,b),(c,d)ä¸ºé¡¶ç‚¹çš„çŸ©å½¢åŒºåŸŸå†…æ‰€æœ‰æ•°å­—çš„å’Œã€‚
    
    **è¾“å‡ºï¼š** é’ˆå¯¹æ¯ä¸ªkæ“ä½œï¼Œè¾“å‡ºç­”æ¡ˆã€‚
    
    è¾“å…¥æ ·ä¾‹ï¼š
    
    X 4 4
    
    L 1 1 3 3 2
    
    L 2 2 4 4 1
    
    k 2 2 3 3
    
    è¾“å‡ºæ ·ä¾‹ï¼š
    
    12
    
    æ³¨ï¼š`1 â‰¤ n â‰¤ 2048, 1 â‰¤ m â‰¤ 2048, âˆ’500 â‰¤ delta â‰¤ 500`, æ“ä½œä¸è¶…è¿‡200000ä¸ª,ä¿è¯è¿ç®—è¿‡ç¨‹ä¸­åŠæœ€ç»ˆç»“æœå‡ä¸è¶…è¿‡32ä½å¸¦ç¬¦å·æ•´æ•°ç±»å‹çš„è¡¨ç¤ºèŒƒå›´ã€‚

???+note "è§£é¢˜æ€è·¯"
    æœ¬é¢˜éœ€è¦ç”¨äºŒç»´æ ‘çŠ¶æ•°ç»„ã€‚äºŒç»´çš„â€œåŒºé—´ä¿®æ”¹+åŒºé—´æŸ¥è¯¢â€ï¼Œå°±æ˜¯ä¸€ç»´â€œåŒºé—´ä¿®æ”¹+åŒºé—´æŸ¥è¯¢â€çš„æ‰©å±•ï¼Œæ–¹æ³•å’Œæ¨å¯¼è¿‡ç¨‹ç±»ä¼¼ã€‚ 
    
    ï¼ˆ1ï¼‰äºŒç»´åŒºé—´ä¿®æ”¹

    ![](./images/bit-3.png)

    å¦‚ä½•å®ç°åŒºé—´ä¿®æ”¹ï¼Ÿéœ€è¦ç»“åˆäºŒç»´çš„å·®åˆ†æ•°ç»„ã€‚å®šä¹‰ä¸€ä¸ªäºŒç»´çš„å·®åˆ†æ•°ç»„ğ·\[ğ‘–\]\[ğ‘—\]ï¼Œå®ƒå’ŒçŸ©é˜µå…ƒç´ ğ‘\[ğ‘\]\[ğ‘‘\]çš„å…³ç³»æ˜¯ï¼š
    
    `ğ·[ğ‘–][ğ‘—]=ğ‘[ğ‘–][ğ‘—]âˆ’ğ‘[ğ‘–âˆ’1][ğ‘—]âˆ’ğ‘[ğ‘–][ğ‘—âˆ’1]+ğ‘[ğ‘–âˆ’1][ğ‘—âˆ’1]`ï¼Œå¯¹ç…§ä¸Šå›¾ï¼Œ`ğ·[ğ‘–][ğ‘—]`å°±æ˜¯é˜´å½±çš„é¢ç§¯ã€‚
    
    `ğ‘[ğ‘][ğ‘‘]=âˆ‘ğ‘ğ‘–=1âˆ‘ğ‘‘ğ‘—=1ğ·[ğ‘–][ğ‘—]`ï¼Œçœ‹æˆå¯¹ä»¥(1,1)ã€(ğ‘,ğ‘‘)ä¸ºé¡¶ç‚¹çš„çŸ©é˜µå†…çš„`ğ·[ğ‘–][ğ‘—]`æ±‚å’Œã€‚
    
    å®ƒä»¬åŒæ ·æ»¡è¶³â€œå·®åˆ†æ˜¯å‰ç¼€å’Œçš„é€†è¿ç®—â€å…³ç³»ã€‚
    
    ç”¨äºŒç»´æ ‘çŠ¶æ•°ç»„å®ç°ğ·\[ğ‘–\]\[ğ‘—\]ï¼Œç¼–ç è§åé¢çš„ä»£ç ä¸­çš„ğ‘¢ğ‘ğ‘‘ğ‘ğ‘¡ğ‘’()å’Œğ‘ ğ‘¢ğ‘š()ã€‚è¿›è¡ŒåŒºé—´ä¿®æ”¹çš„æ—¶å€™ï¼Œåœ¨ğ‘¢ğ‘ğ‘‘ğ‘ğ‘¡ğ‘’()ä¸­ï¼Œæ¯æ¬¡ç¬¬ğ‘–è¡Œå‡å°‘ğ‘™ğ‘œğ‘¤ğ‘ğ‘–ğ‘¡(ğ‘–)ï¼Œç¬¬ğ‘—jåˆ—å‡ğ‘™ğ‘œğ‘¤ğ‘ğ‘–ğ‘¡(ğ‘—)ï¼Œå¤æ‚åº¦ğ‘‚(ğ‘™ğ‘œğ‘”ğ‘›ğ‘™ğ‘œğ‘”ğ‘š)ã€‚
    
    ï¼ˆ2ï¼‰äºŒç»´åŒºé—´æŸ¥è¯¢

    ![](./images/bit-4.png)

    æŸ¥è¯¢(a, b)ã€(c, d)ä¸ºé¡¶ç‚¹çš„çŸ©é˜µåŒºé—´å’Œï¼Œå¯¹ç…§ä¸Šå›¾çš„é˜´å½±éƒ¨åˆ†ï¼Œæœ‰ï¼š

    `âˆ‘ğ‘ğ‘–=ğ‘âˆ‘ğ‘‘ğ‘—=ğ‘ğ‘[ğ‘–][ğ‘—]=âˆ‘ğ‘ğ‘–=1âˆ‘ğ‘‘ğ‘—=1ğ‘[ğ‘–][ğ‘—]âˆ’âˆ‘ğ‘ğ‘–=1âˆ‘ğ‘âˆ’1ğ‘—=1ğ‘[ğ‘–][ğ‘—]âˆ’âˆ‘ğ‘âˆ’1ğ‘–=1âˆ‘ğ‘‘ğ‘—=1ğ‘[ğ‘–][ğ‘—]+âˆ‘ğ‘âˆ’1ğ‘–=1âˆ‘ğ‘âˆ’1ğ‘—=1ğ‘[ğ‘–][ğ‘—]`
    
    é—®é¢˜è½¬åŒ–ä¸ºè®¡ç®—`âˆ‘ğ‘›ğ‘–=1âˆ‘ğ‘šğ‘—=1ğ‘[ğ‘–][ğ‘—]`ï¼Œæ ¹æ®å®ƒå’Œå·®åˆ†æ•°ç»„Dçš„å…³ç³»è¿›è¡Œå˜æ¢\[1:1\]ï¼š
    
    `âˆ‘ğ‘›ğ‘–=1âˆ‘ğ‘šğ‘—=1ğ‘[ğ‘–][ğ‘—]
    =âˆ‘ğ‘›ğ‘–=1âˆ‘ğ‘šğ‘—=1âˆ‘ğ‘–ğ‘˜=1âˆ‘ğ‘—ğ‘™=1ğ·[ğ‘˜][ğ‘™]
    =âˆ‘ğ‘›ğ‘–=1âˆ‘ğ‘šğ‘—=1ğ·[ğ‘–][ğ‘—]Ã—(ğ‘›âˆ’ğ‘–+1)Ã—(ğ‘šâˆ’ğ‘—âˆ’1)
    =(ğ‘›+1)(ğ‘š+1)âˆ‘ğ‘›ğ‘–=1âˆ‘ğ‘šğ‘—=1ğ·[ğ‘–][ğ‘—]âˆ’(ğ‘š+1)âˆ‘ğ‘›ğ‘–=1âˆ‘ğ‘šğ‘—=1ğ·[ğ‘–][ğ‘—]Ã—ğ‘–âˆ’(ğ‘›+1)âˆ‘ğ‘›ğ‘–=1âˆ‘ğ‘šğ‘—=1ğ·[ğ‘–][ğ‘—]Ã—ğ‘—+âˆ‘ğ‘›ğ‘–=1âˆ‘ğ‘šğ‘—=1ğ·[ğ‘–][ğ‘—]Ã—ğ‘–Ã—ğ‘—`
    
    è¿™æ˜¯4ä¸ªäºŒç»´æ ‘çŠ¶æ•°ç»„ã€‚

???+note "å‚è€ƒä»£ç "

    ```cpp
    #include<bits/stdc++.h>
    using namespace std;
    const int N = 2050;
    int t1[N][N],t2[N][N],t3[N][N],t4[N][N];
    #define lowbit(x)  ((x) & - (x))  
    int n,m; 
    void update(int x,int y,int d){
        for(int i=x;i<=n;i+=lowbit(i))
            for(int j=y;j<=m;j+=lowbit(j)){
                t1[i][j] += d;
                t2[i][j] += x*d;
                t3[i][j] += y*d;
                t4[i][j] += x*y*d;
            }
    }
    int sum(int x,int y){
        int ans = 0;
        for(int i=x;i>0;i-=lowbit(i))
            for(int j=y;j>0;j-=lowbit(j))
                ans += (x+1)*(y+1)*t1[i][j] - (y+1)*t2[i][j] - (x+1)*t3[i][j] + t4[i][j];
        return ans;
    }
    int main(){
        char ch[2];	scanf("%s",ch);
        scanf("%d%d",&n,&m);     
    while(scanf("%s",ch)!=EOF){
            int a,b,c,d,delta;
            scanf("%d%d%d%d",&a,&b,&c,&d);
            if(ch[0]=='L'){
                scanf("%d",&delta);
                update(a,  b,   delta);    
                update(c+1,d+1, delta);
                update(a,  d+1,-delta); 
                update(c+1,b,  -delta);
            }
            else printf("%d\n",sum(c,d)+sum(a-1,b-1)-sum(a-1,d)-sum(c,b-1));
        }	
        return 0;
    }
    ```

### ååºé—®é¢˜ï¼ˆé€†åºå¯¹ + ç¦»æ•£åŒ–ï¼‰

ååºé—®é¢˜ï¼š

1. ä¸€ç»´ååºï¼ˆé€†åºå¯¹ï¼‰ã€‚ç»™å®šæ•°åˆ—aï¼Œæ±‚æ»¡è¶³i < jä¸”ai > ajçš„äºŒå…ƒç»„(i, j)çš„æ•°é‡ã€‚
2. äºŒç»´ååºã€‚ç»™å®šnä¸ªç‚¹çš„åæ ‡ï¼Œæ±‚å‡ºæ»¡è¶³xi < xjã€yi < yjçš„äºŒå…ƒç»„(i, j)çš„æ•°é‡ã€‚
3. ä¸‰ç»´ååºã€‚ç»™å®šnä¸ªç‚¹çš„åæ ‡ï¼Œæ±‚æ»¡è¶³xi < xjã€yi < yjã€zi < zjçš„äºŒå…ƒç»„(i, j)çš„æ•°é‡ã€‚

é€†åºå¯¹é—®é¢˜æœ‰ä¸¤ç§è§£æ³•ï¼šå½’å¹¶æ’åºã€æ ‘çŠ¶æ•°ç»„ã€‚ç”¨æ ‘çŠ¶æ•°ç»„è§£é€†åºå¯¹åˆç®€å•åˆå·§å¦™ï¼Œæ˜¯æ ‘çŠ¶æ•°ç»„åº”ç”¨çš„ç»ä½³ä¾‹å­ã€‚

???+note "[é€†åºå¯¹](https://www.luogu.com.cn/problem/P1908)"
    **é¢˜ç›®æè¿°ï¼š** å¯¹äºç»™å®šçš„ä¸€æ®µæ­£æ•´æ•°åºåˆ—ï¼Œé€†åºå¯¹å°±æ˜¯åºåˆ—ä¸­ai > ajä¸”i < jçš„æœ‰åºå¯¹ã€‚è®¡ç®—ä¸€æ®µæ­£æ•´æ•°åºåˆ—ä¸­é€†åºå¯¹çš„æ•°ç›®ã€‚åºåˆ—ä¸­å¯èƒ½æœ‰é‡å¤æ•°å­—ã€‚
    
    **è¾“å…¥æ ¼å¼ï¼š** ç¬¬ä¸€è¡Œï¼Œä¸€ä¸ªæ•° nï¼Œè¡¨ç¤ºåºåˆ—ä¸­æœ‰ nä¸ªæ•°ã€‚ç¬¬äºŒè¡Œnä¸ªæ•°ï¼Œè¡¨ç¤ºç»™å®šçš„åºåˆ—ã€‚åºåˆ—ä¸­æ¯ä¸ªæ•°å­—ä¸è¶…è¿‡ 109ã€‚n <= 5Ã—105ã€‚
    
    **è¾“å‡ºæ ¼å¼ï¼š** è¾“å‡ºåºåˆ—ä¸­é€†åºå¯¹çš„æ•°ç›®ã€‚
    
    è¾“å…¥æ ·ä¾‹ï¼š
    
    6
    
    5 4 2 6 3 1
    
    è¾“å‡ºæ ·ä¾‹ï¼š
    
    11

???+note "è§£é¢˜æ€è·¯"
    ç›´æ¥ç”¨ä¸¤é‡å¾ªç¯æš´åŠ›æœï¼Œå¤æ‚åº¦O(n2)ã€‚ç”¨æ ‘çŠ¶æ•°ç»„ï¼Œå¤æ‚åº¦O(nlogn)ã€‚
    
    ç”¨æ ‘çŠ¶æ•°ç»„è§£é€†åºå¯¹ç”¨åˆ°ä¸€ä¸ªæŠ€å·§ï¼šæŠŠæ•°å­—çœ‹æˆæ ‘çŠ¶æ•°ç»„çš„ä¸‹æ ‡ã€‚æ¯å¤„ç†ä¸€ä¸ªæ•°å­—ï¼Œæ ‘çŠ¶æ•°ç»„çš„ä¸‹æ ‡æ‰€å¯¹åº”çš„å…ƒç´ æ•°å€¼åŠ ä¸€ï¼Œç»Ÿè®¡å‰ç¼€å’Œï¼Œå°±æ˜¯é€†åºå¯¹çš„æ•°é‡ã€‚å€’åºæˆ–æ­£åºå¤„ç†æ•°æ®éƒ½è¡Œï¼Œä¸‹é¢æ˜¯ä¾‹å­ã€‚
    
    ï¼ˆ1ï¼‰å€’åºã€‚ç”¨æ ‘çŠ¶æ•°ç»„å€’åºå¤„ç†æ•°åˆ—ï¼Œå½“å‰æ•°å­—çš„å‰ä¸€ä¸ªæ•°çš„å‰ç¼€å’Œå³ä¸ºä»¥è¯¥æ•°ä¸ºè¾ƒå¤§æ•°çš„é€†åºå¯¹çš„ä¸ªæ•°ã€‚ä¾‹å¦‚æ ·ä¾‹çš„{5, 4, 2, 6, 3, 1}ï¼Œå€’åºå¤„ç†æ•°å­—ï¼š

        1. æ•°å­—1ã€‚æŠŠa\[1\]åŠ ä¸€ï¼Œè®¡ç®—a\[1\]å‰é¢çš„å‰ç¼€å’Œsum(0)ï¼Œé€†åºå¯¹æ•°é‡ans=ans+sum(0)=0ï¼›
        2. æ•°å­—3ã€‚æŠŠa\[3\]åŠ ä¸€ï¼Œè®¡ç®—a\[3\]å‰é¢çš„å‰ç¼€å’Œsum(2)ï¼Œé€†åºå¯¹æ•°é‡ans=ans+sum(2)=1ï¼›
        3. æ•°å­—6ã€‚æŠŠa\[6\]åŠ ä¸€ï¼Œè®¡ç®—a\[6\]å‰é¢çš„å‰ç¼€å’Œsum(5)ï¼Œé€†åºå¯¹æ•°é‡ans=ans+sum(5)=1+2=3ï¼›
        
        ç­‰ç­‰ã€‚
    
    ï¼ˆ2ï¼‰æ­£åºã€‚å½“å‰å·²ç»å¤„ç†çš„æ•°å­—ä¸ªæ•°å‡æ‰å½“å‰æ•°å­—çš„å‰ç¼€å’Œå³ä¸ºä»¥è¯¥æ•°ä¸ºè¾ƒå°æ•°çš„é€†åºå¯¹ä¸ªæ•°ã€‚ä¾‹å¦‚æ ·ä¾‹çš„{5, 4, 2, 6, 3, 1}ï¼Œæ­£åºå¤„ç†æ•°å­—ï¼š

        1. æ•°å­—5ã€‚æŠŠa\[5\]åŠ ä¸€ï¼Œå½“å‰å¤„ç†äº†1ä¸ªæ•°ï¼Œans=ans+(1-sum(5))=0ï¼›
        2. æ•°å­—4ã€‚æŠŠa\[4\]åŠ ä¸€ï¼Œå½“å‰å¤„ç†äº†2ä¸ªæ•°ï¼Œans=ans+(2-sum(4))=0+1=1ï¼›
        3. æ•°å­—2ã€‚æŠŠa\[2\]åŠ ä¸€ï¼Œans=ans+(3-sum(2))=1+2=3ï¼›
        4. æ•°å­—6ã€‚æŠŠa\[6\]åŠ ä¸€ï¼Œans=ans+(4-sum(6))=3+0=3ï¼›
    
    ç­‰ç­‰ã€‚
    
    ä¸è¿‡ï¼Œä¸Šé¢çš„å¤„ç†æ–¹æ³•â€œæŠŠæ•°å­—çœ‹æˆæ ‘çŠ¶æ•°ç»„çš„ä¸‹æ ‡â€æœ‰ä¸ªé—®é¢˜ï¼Œå¦‚æœæ•°å­—æ¯”è¾ƒå¤§ï¼Œä¾‹å¦‚æ•°å­—ç­‰äº10^9^ï¼Œé‚£ä¹ˆæ ‘çŠ¶æ•°ç»„çš„ç©ºé—´ä¹Ÿè¦å¼€åˆ°10^9^ = 1Gï¼Œè¿™è¿œè¿œè¶…è¿‡äº†é¢˜ç›®é™åˆ¶çš„ç©ºé—´ã€‚ç”¨â€œç¦»æ•£åŒ–â€è¿™ä¸ªå°æŠ€å·§èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ã€‚
    
    æ‰€è°“ç¦»æ•£åŒ–ï¼Œå°±æ˜¯æŠŠåŸæ¥çš„æ•°å­—ï¼Œç”¨å®ƒä»¬çš„ç›¸å¯¹å¤§å°æ¥æ›¿æ¢åŸæ¥çš„æ•°å€¼ï¼Œè€Œå®ƒä»¬çš„é¡ºåºä»ç„¶ä¸å˜ï¼Œä¸å½±å“é€†åºå¯¹çš„è®¡ç®—ã€‚ä¾‹å¦‚{1, 20000,10, 300, 890000000}ï¼Œå®ƒä»¬çš„ç›¸å¯¹å¤§å°æ˜¯{1, 4, 2, 3, 5}ï¼Œè¿™ä¸¤ä¸ªåºåˆ—çš„é€†åºå¯¹æ•°é‡æ˜¯ä¸€æ ·çš„ã€‚å‰è€…éœ€è¦æå¤§çš„ç©ºé—´ï¼Œåè€…ç©ºé—´å¾ˆå°ã€‚æœ‰å¤šå°‘ä¸ªæ•°å­—ï¼Œç¦»æ•£åŒ–åå¼€çš„ç©ºé—´å°±æ˜¯å¤šå¤§ã€‚ 
    
    ä¸‹é¢æ˜¯æ´›è°· 1908çš„ä»£ç ï¼Œæ³¨æ„å…¶ä¸­çš„ç¦»æ•£åŒ–æ“ä½œã€‚ç¦»æ•£åŒ–æ—¶è®¡ç®—â€œç›¸å¯¹å¤§å°â€éœ€è¦ç”¨åˆ°æ’åºï¼Œè¯·ä»”ç»†åˆ†æã€‚

???+note "å‚è€ƒä»£ç "
    ```cpp
    //lowbit(x)ï¼Œupdate()ï¼Œsum()çš„ä»£ç å‰é¢å·²ç»™å‡º
    const int Maxn = 500010;
    int tree[Maxn],rank[Maxn],n;
    struct point{
    int num,val;
    }a[Maxn];
    bool cmp(point x,point y){
        if(x.val == y.val)   return x.num < y.num;  //æ³¨æ„ï¼šç›¸ç­‰çš„æƒ…å†µï¼Œå…ˆå‡ºç°æ ‡è®°æ›´å°
        return x.val < y.val;
    }
    int main(){
        scanf("%d",&n);
        for(int i=1;i<=n;i++) {
            scanf("%d",&a[i].val);
            a[i].num = i;         //è®°å½•é¡ºåºï¼Œç”¨äºç¦»æ•£åŒ–
        }
        sort(a+1,a+1+n,cmp);      //æ’åº
        for(int i=1;i<=n;i++)     //ç¦»æ•£åŒ–ï¼Œå¾—åˆ°æ–°çš„æ•°å­—åºåˆ—rank[]
            rank[a[i].num]=i;     
    long long ans=0; 
        /*for(int i=1;i<=n;i++){    //æ­£åºå¤„ç†
            update(rank[i],1);
            ans += i-sum(rank[i]);
        }*/
        for(int i=n;i > 0;--i){     //å€’åºå¤„ç†
            update(rank[i],1);
            ans += sum(rank[i]-1);
        }
        printf("%lld",ans);
        return 0;
    } 
    ```

## åŒºé—´æœ€å€¼

æ ‘çŠ¶æ•°ç»„ä¸€èˆ¬ç”¨æ¥è®¡ç®—å‰ç¼€å’Œï¼Œä¸è¿‡ï¼Œä¹Ÿèƒ½é«˜æ•ˆç‡åœ°æ±‚åŒºé—´æœ€å€¼ï¼Œæ­¤æ—¶éœ€è¦æ”¹å†™æ ‘çŠ¶æ•°ç»„çš„ä»£ç ã€‚

???+note "[I hate it](https://vjudge.net/problem/HDU-1754)"
    **é¢˜ç›®æè¿°ï¼š** æ±‚åŒºé—´å†…æœ€å¤§å€¼ã€‚
    
    **è¾“å…¥ï¼š** ç¬¬ä¸€è¡Œæ˜¯æ­£æ•´æ•°`N,M ( 0<N<=200000,0<M<5000 )`ï¼Œä»£è¡¨æ•°å­—ä¸ªæ•°å’Œæ“ä½œæ•°ã€‚ç¬¬äºŒè¡ŒåŒ…å«Nä¸ªæ•´æ•°ï¼Œæ¥ä¸‹æ¥Mè¡Œï¼Œæ¯è¡Œæœ‰ä¸€ä¸ªè¯¢é—®ï¼Œæ ¼å¼ä¸ºï¼š
    
    Q A B ä»£è¡¨ä¸€ä¸ªè¯¢é—®ï¼Œè¯¢é—®ä»ç¬¬Aåˆ°ç¬¬Bä¸ªæ•°å­—ä¸­çš„æœ€å¤§å€¼ã€‚
    
    U A B ä»£è¡¨ä¸€ä¸ªæ›´æ–°ï¼ŒæŠŠç¬¬Aä¸ªæ•°å­—æ”¹ä¸ºBã€‚
    
    **è¾“å‡ºï¼š** å¯¹æ¯ä¸ªè¯¢é—®ï¼Œè¾“å‡ºåŒºé—´æœ€å¤§å€¼ã€‚

???+note "è§£é¢˜æ€è·¯"
    ç”¨æš´åŠ›æ³•ï¼Œå¤æ‚åº¦æ˜¯O(MN)çš„ã€‚ä¸‹é¢ç”¨æ ‘çŠ¶æ•°ç»„æ±‚è§£ã€‚ 

    åœ¨æ ‡å‡†çš„å‰ç¼€å’Œæ ‘çŠ¶æ•°ç»„ä¸­ï¼Œtree\[x\]ä¸­å‚¨å­˜çš„æ˜¯\[x-lowbit(x)+1, x\]ä¸­æ¯ä¸ªæ•°çš„å’Œã€‚åœ¨æ±‚æœ€å€¼çš„æ ‘çŠ¶æ•°ç»„ä¸­ï¼Œtree\[x\]è®°å½•\[x-lowbit(x)+1, x\]å†…æ‰€æœ‰æ•°çš„æœ€å¤§å€¼ã€‚
    
    ï¼ˆ1ï¼‰å•ç‚¹ä¿®æ”¹ğ‘¢ğ‘ğ‘‘ğ‘ğ‘¡ğ‘’1(ğ‘¥,ğ‘£ğ‘ğ‘™ğ‘¢ğ‘’)ã€‚ç”¨ğ‘£ğ‘ğ‘™ğ‘¢ğ‘’æ›´æ–°ğ‘¡ğ‘Ÿğ‘’ğ‘’\[ğ‘¥\]çš„æœ€å¤§å€¼ï¼Œå¹¶æ›´æ–°æ ‘çŠ¶æ•°ç»„ä¸Šè¢«å®ƒå½±å“çš„ç»“ç‚¹ã€‚ä¾‹å¦‚ä¿®æ”¹ğ‘¥ = 4ï¼Œæ­¥éª¤æ˜¯ï¼š
    
        1ï¼‰ä¿®æ”¹ğ‘¥å­æ ‘ä¸Šç›´è¿çš„ğ‘¡ğ‘Ÿğ‘’ğ‘’\[2\]ã€ğ‘¡ğ‘Ÿğ‘’ğ‘’\[3\]ï¼›
        
        2ï¼‰ğ‘¥çš„çˆ¶ç»“ç‚¹ğ‘¡ğ‘Ÿğ‘’ğ‘’\[8\]ï¼Œä»¥åŠğ‘¡ğ‘Ÿğ‘’ğ‘’\[8\]çš„ç›´è¿å­ç»“ç‚¹ğ‘¡ğ‘Ÿğ‘’ğ‘’\[6\]ã€ğ‘¡ğ‘Ÿğ‘’ğ‘’\[7\]ï¼›...ç­‰ç­‰ã€‚
    
    æ¯ä¸€æ­¥å¤æ‚åº¦æ˜¯ğ‘‚(ğ‘™ğ‘œğ‘”ğ‘›)ï¼Œå…±ğ‘‚(ğ‘™ğ‘œğ‘”ğ‘›)æ­¥ï¼Œæ€»å¤æ‚åº¦æ˜¯ğ‘‚((ğ‘™ğ‘œğ‘”ğ‘›)2)ã€‚æ³¨æ„ä¸€ä¸ªç‰¹æ®Šæƒ…å†µï¼Œåˆå§‹åŒ–çš„æ—¶å€™éœ€è¦ä¿®æ”¹æ‰€æœ‰nä¸ªæ•°ï¼Œå¤æ‚åº¦ğ‘‚(ğ‘›(ğ‘™ğ‘œğ‘”ğ‘›)2)ï¼Œç¬¦åˆè¦æ±‚ã€‚

    ```cpp
    void update1(int x,int value){
        while(x <= n){
            tree[x] = value;
            for(int i=1; i<lowbit(x); i<<=1)      //ç”¨å­ç»“ç‚¹æ›´æ–°è‡ªå·±
                tree[x] = max(tree[x], tree[x-i]);
            x += lowbit(x);                       //çˆ¶ç»“ç‚¹
        }
    }
    ```

    ï¼ˆ2ï¼‰åŒºé—´æœ€å€¼æŸ¥è¯¢query1()ã€‚åŒºé—´ \[L, R\]çš„æœ€å€¼ï¼Œåˆ†ä¸¤ç§æƒ…å†µè®¨è®ºã€‚

        1ï¼‰R - L >= lowbit( R)ã€‚å¯¹ç…§â€œæ ‘çŠ¶æ•°ç»„åŸç†å›¾â€ï¼Œå³\[L, R\]èŒƒå›´åŒ…å«äº†tree\[R\]ç›´è¿å­ç»“ç‚¹çš„ä¸ªæ•°ï¼Œæ­¤æ—¶ç›´æ¥ä½¿ç”¨tree\[R\]çš„å€¼ï¼šquery1(L, R) = max(tree\[R\], query1(L, Râˆ’lowbit( R)))ã€‚

        2ï¼‰å½“ R - L < lowbit(R) æ—¶ï¼Œä¸Šè¿°åŒ…å«å…³ç³»ä¸æˆç«‹ï¼Œå…ˆä½¿ç”¨a\[R\]çš„å€¼ï¼Œç„¶åå¾€å‰é€’æ¨ï¼šquery1(L, R) = max(a\[R\], query1(L, Râˆ’1))ã€‚

    query1()çš„å¤æ‚åº¦ä»ç„¶æ˜¯ğ‘‚((ğ‘™ğ‘œğ‘”ğ‘›)2)ã€‚

    ```cpp
    int query1(int L,int R){
        int ans = 0;
        while(L<=R)	{
            ans = max(ans,a[R]);
            R--;
            while(R-L>=lowbit(R)){
                ans = max(ans,tree[R]);
                R-=lowbit(R);
            }
        }
        return ans;
    }
    ```

???+note "å‚è€ƒä»£ç "

    ```cpp
    #include<bits/stdc++.h>
    using namespace std;
    const int maxn=2e5+10; 
    int n,m,a[maxn],tree[maxn]; 
    int lowbit(int x){return x&(-x);}
    void update1(int x,int value){;}    //ä»£ç åœ¨å‰é¢
    int query1(int L,int R){;}          //ä»£ç åœ¨å‰é¢
    int main(){
        while(~scanf("%d%d",&n,&m))	{
            memset(tree,0,sizeof(tree));
            for(int i=1; i<=n; i++){
                scanf("%d",&a[i]);
                update1(i,a[i]);
            }
            while(m--){
                char s[5];int A,B;
                scanf("%s%d%d",s,&A,&B);
                if(s[0]=='Q')
                    printf("%d\n",query1(A,B));
                else{
                    a[A]=B;
                    update1(A,B);
                }
            }
        }
        return 0;
    }
    ```

## ç¦»çº¿å¤„ç†

???+note "[No Pain No Game](https://vjudge.net/problem/HDU-4630)"
    **é¢˜ç›®æè¿°ï¼š** ç»™å‡ºä¸€ä¸ªåºåˆ—ï¼Œè¿™ä¸ªåºåˆ—æ˜¯1~nè¿™nä¸ªæ•°å­—çš„ä¸€ä¸ªå…¨æ’åˆ—ã€‚ç»™å‡ºä¸€ä¸ªåŒºé—´\[L, R\]ï¼Œæ±‚åŒºé—´å†…ä»»æ„ä¸¤ä¸ªæ•°çš„GCDï¼ˆæœ€å¤§å…¬çº¦æ•°ï¼‰çš„æœ€å¤§å€¼ã€‚
    
    **è¾“å…¥ï¼š** ç¬¬ä¸€è¡ŒåŒ…æ‹¬ä¸€ä¸ªæ•°Tï¼Œåé¢æœ‰Tä¸ªæµ‹è¯•ã€‚æ¯ä¸ªæµ‹è¯•çš„ç¬¬ä¸€è¡Œæ˜¯æ•°å­—nï¼Œ`1<=n<=50000`ï¼Œç¬¬äºŒè¡ŒåŒ…æ‹¬nä¸ªæ•°ï¼Œæ˜¯1~nè¿™nä¸ªæ•°å­—çš„ä¸€ä¸ªå…¨æ’åˆ—ã€‚ç¬¬ä¸‰è¡ŒåŒ…æ‹¬æ•°å­—Qï¼Œ`1<=Q<=50000`ï¼Œè¡¨ç¤ºQä¸ªè¯¢é—®ã€‚åé¢æœ‰Qè¡Œï¼Œæ¯è¡Œæœ‰2ä¸ªæ•´æ•°`Lï¼ŒRï¼Œ1<=L<=R<=n`ï¼Œè¡¨ç¤ºä¸€ä¸ªè¯¢é—®ã€‚
    
    **è¾“å‡ºï¼š** æ¯ä¸ªè¯¢é—®çš„ç»“æœæ‰“å°ä¸€è¡Œã€‚

???+note "è§£é¢˜æ€è·¯"
    åœ¨åŒºé—´\[L, R\]å†…ï¼Œå…ˆæ±‚å‡ºåŒºé—´å†…æ‰€æœ‰æ•°çš„å› å­ï¼Œå‡ºç°2æ¬¡çš„å› å­æ˜¯å…¬çº¦æ•°ï¼Œæœ€å¤§çš„é‚£ä¸ªå°±æ˜¯ç­”æ¡ˆã€‚
    
    æœ‰Qä¸ªåŒºé—´è¯¢é—®ï¼Œè€ŒQå¾ˆå¤§ï¼Œæ‰€ä»¥æ¯æ¬¡æŸ¥è¯¢çš„å¤æ‚åº¦éœ€è¦è¾¾åˆ°ğ‘‚(ğ‘™ğ‘œğ‘”ğ‘›)æ‰è¡Œã€‚ä½†æ˜¯å¦‚æœå¯¹æ¯ä¸ªè¯¢é—®éƒ½å•ç‹¬è®¡ç®—è¿™ä¸ªåŒºé—´å†…çš„æœ€å¤§å…¬çº¦æ•°ï¼Œæœ€å¿«ä¹Ÿæ˜¯ğ‘‚(ğ‘›)çš„ï¼ŒQä¸ªè¯¢é—®å°±æ˜¯ğ‘‚(ğ‘›2)ï¼Œè¶…æ—¶ã€‚
    
    æ­¤æ—¶éœ€è¦ç”¨ç¦»çº¿å¤„ç†ï¼Œå³å…ˆè¯»å–æ‰€æœ‰çš„è¯¢é—®ï¼Œç„¶åç»Ÿä¸€å¤„ç†ï¼Œè®¡ç®—ç»“æŸåä¸€èµ·è¾“å‡ºã€‚
    
    å‰é¢çš„æ ‡å‡†æ ‘çŠ¶æ•°ç»„çš„ä»£ç ï¼Œåªèƒ½æ±‚åŒºé—´å’Œã€‚èƒ½å¦æ”¹æˆæ±‚åŒºé—´æœ€å€¼ï¼ŸæŠŠupdate()ã€sum()ç®€å•åœ°æ”¹å†™æˆï¼š

    ```cpp
    void update2(int x,int d){    
        while(x <= n){
            tree[x] = max(tree[x],d);  //æ”¹æˆï¼šæ›´æ–°æœ€å¤§å€¼
            x += lowbit(x);
        }
    }
    int query2(int x){              
        int ans = 0;
        while(x > 0){
            ans = max(ans,tree[x]);   //æ”¹æˆï¼šæ±‚æœ€å¤§å€¼
            x -= lowbit(x);
        }
        return ans;
    }
    ```

    å¯¹ç…§â€œæ ‘çŠ¶æ•°ç»„åŸç†å›¾â€ï¼Œæ‰§è¡Œğ‘¢ğ‘ğ‘‘ğ‘ğ‘¡ğ‘’2(ğ‘¥,ğ‘‘)çš„ç»“æœï¼Œæ˜¯åœ¨\[ğ‘¥,ğ‘›\]åŒºé—´å†…ï¼ŒæŠŠğ‘¥çš„çˆ¶ç»“ç‚¹ï¼ˆå³ğ‘¥+ğ‘™ğ‘œğ‘¤ğ‘ğ‘–ğ‘¡(ğ‘¥),ä»¥åŠçˆ¶ç»“ç‚¹çš„çˆ¶ç»“ç‚¹ï¼‰çš„ğ‘¡ğ‘Ÿğ‘’ğ‘’\[\]å€¼è®¾ç½®ä¸ºğ‘ğ‘¥çš„æœ€å¤§å€¼ï¼›æ‰§è¡Œğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦2(ğ‘¥)ï¼Œè¿”å›çš„æ˜¯ğ‘1 ğ‘ğ‘¥çš„æœ€å¤§å€¼ã€‚
    
    ä¸Šè¿°ä»£ç å¹¶ä¸èƒ½ç”¨äºä¸Šä¸€å°ç»“çš„â€œæ±‚åŒºé—´\[L, R\]æœ€å€¼â€é—®é¢˜ã€‚å› ä¸ºæœ€å€¼æ²¡æœ‰å‰ç¼€å’Œçš„é‚£ç§çº¿æ€§å…³ç³»ï¼Œ\[L, R\]çš„æœ€å€¼ä¸\[1, L-1\]ã€\[1, R\]çš„æœ€å€¼å¹¶æ²¡æœ‰å…³ç³»ã€‚ä½†æ˜¯åœ¨æœ¬é¢˜ä¸­å¾ˆæœ‰ç”¨ã€‚
    
    é¦–å…ˆå°†æ‰€æœ‰çš„è¯¢é—®\[L, R\]æŒ‰å·¦ç«¯ç‚¹Lä»å¤§åˆ°å°æ’åºã€‚ä»æœ€å¤§çš„L1å¼€å§‹è®¡ç®—ï¼Œç”¨ğ‘¢ğ‘ğ‘‘ğ‘ğ‘¡ğ‘’2()å¾€çˆ¶ç»“ç‚¹æ–¹å‘æ›´æ–°æœ€å¤§å€¼ï¼Œå¹¶ç”¨ğ‘ğ‘¢ğ‘’ğ‘Ÿğ‘¦2(ğ‘…1)è¿”å›åŒºé—´\[L1, R1\]çš„æœ€å¤§å€¼ï¼Œç”±äºæ­¤æ—¶æ¯”L1å°çš„é‚£äº›è¯¢é—®è¿˜æ²¡æœ‰å¼€å§‹ä¿®æ”¹æ ‘çŠ¶æ•°ç»„ï¼Œä¹Ÿå°±ä¸å½±å“\[L1, R1\]çš„è®¡ç®—ã€‚ä¸‹ä¸€æ­¥å†ä»ç¬¬äºŒå¤§çš„L2å¼€å§‹è®¡ç®—ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œå…ˆè®¡ç®—çš„åŒºé—´ï¼Œèƒ½ç”¨äºåè®¡ç®—çš„åŒºé—´ï¼Œä»è€Œæé«˜äº†æ•ˆç‡ã€‚

## åŒºé—´åŠ åŒºé—´å’Œ

å‰ç½®çŸ¥è¯†ï¼š[å‰ç¼€å’Œ & å·®åˆ†](../../basic/prefix-sum/)ã€‚

è¯¥é—®é¢˜å¯ä»¥ä½¿ç”¨ä¸¤ä¸ªæ ‘çŠ¶æ•°ç»„ç»´æŠ¤å·®åˆ†æ•°ç»„è§£å†³ã€‚

è€ƒè™‘åºåˆ— $a$ çš„å·®åˆ†æ•°ç»„ $d$ï¼Œå…¶ä¸­ $d[i] = a[i] - a[i - 1]$ã€‚ç”±äºå·®åˆ†æ•°ç»„çš„å‰ç¼€å’Œå°±æ˜¯åŸæ•°ç»„ï¼Œæ‰€ä»¥ $a_i=\sum_{j=1}^i d_j$ã€‚

ä¸€æ ·åœ°ï¼Œæˆ‘ä»¬è€ƒè™‘å°†æŸ¥è¯¢åŒºé—´å’Œé€šè¿‡å·®åˆ†è½¬åŒ–ä¸ºæŸ¥è¯¢å‰ç¼€å’Œã€‚é‚£ä¹ˆè€ƒè™‘æŸ¥è¯¢ $a[1 \ldots r]$ çš„å’Œï¼Œå³ $\sum_{i=1}^{r} a_i$ï¼Œè¿›è¡Œæ¨å¯¼ï¼š

$$
\begin{aligned}
&\sum_{i=1}^{r} a_i\\=&\sum_{i=1}^r\sum_{j=1}^i d_j
\end{aligned}
$$

è§‚å¯Ÿè¿™ä¸ªå¼å­ï¼Œä¸éš¾å‘ç°æ¯ä¸ª $d_j$ æ€»å…±è¢«åŠ äº† $r - j + 1$ æ¬¡ã€‚æ¥ç€æ¨å¯¼ï¼š

$$
\begin{aligned}
&\sum_{i=1}^r\sum_{j=1}^i d_j\\=&\sum_{i=1}^r d_i\times(r-i+1)
\\=&\sum_{i=1}^r d_i\times (r+1)-\sum_{i=1}^r d_i\times i
\end{aligned}
$$

$\sum_{i=1}^r d_i$ å¹¶ä¸èƒ½æ¨å‡º $\sum_{i=1}^r d_i \times i$ çš„å€¼ï¼Œæ‰€ä»¥è¦ç”¨ä¸¤ä¸ªæ ‘çŠ¶æ•°ç»„åˆ†åˆ«ç»´æŠ¤ $d_i$ å’Œ $d_i \times i$ çš„å’Œä¿¡æ¯ã€‚

é‚£ä¹ˆæ€ä¹ˆåšåŒºé—´åŠ å‘¢ï¼Ÿè€ƒè™‘ç»™åŸæ•°ç»„ $a[l \ldots r]$ åŒºé—´åŠ  $x$ ç»™ $d$ å¸¦æ¥çš„å½±å“ã€‚

å› ä¸ºå·®åˆ†æ˜¯ $d[i] = a[i] - a[i - 1]$ï¼Œ

-   $a[l]$ å¤šäº† $v$ è€Œ $a[l - 1]$ ä¸å˜ï¼Œæ‰€ä»¥ $d[l]$ çš„å€¼å¤šäº† $v$ã€‚
-   $a[r + 1]$ ä¸å˜è€Œ $a[r]$ å¤šäº† $v$ï¼Œæ‰€ä»¥ $d[r + 1]$ çš„å€¼å°‘äº† $v$ã€‚
-   å¯¹äºä¸ç­‰äº $l$ ä¸”ä¸ç­‰äº $r+1$ çš„ä»»æ„ $i$ï¼Œ$a[i]$ å’Œ $a[i - 1]$ è¦ä¹ˆéƒ½æ²¡å‘ç”Ÿå˜åŒ–ï¼Œè¦ä¹ˆéƒ½åŠ äº† $v$ï¼Œ$a[i] + v - (a[i - 1] + v)$ è¿˜æ˜¯ $a[i] - a[i - 1]$ï¼Œæ‰€ä»¥å…¶å®ƒçš„ $d[i]$ å‡ä¸å˜ã€‚

é‚£å°±ä¸éš¾æƒ³åˆ°ç»´æŠ¤æ–¹å¼äº†ï¼šå¯¹äºç»´æŠ¤ $d_i$ çš„æ ‘çŠ¶æ•°ç»„ï¼Œå¯¹ $l$ å•ç‚¹åŠ  $v$ï¼Œ$r + 1$ å•ç‚¹åŠ  $-v$ï¼›å¯¹äºç»´æŠ¤ $d_i \times i$ çš„æ ‘çŠ¶æ•°ç»„ï¼Œå¯¹ $l$ å•ç‚¹åŠ  $v \times l$ï¼Œ$r + 1$ å•ç‚¹åŠ  $-v \times (r + 1)$ã€‚

è€Œæ›´å¼±çš„é—®é¢˜ï¼Œã€ŒåŒºé—´åŠ æ±‚å•ç‚¹å€¼ã€ï¼Œåªéœ€ç”¨æ ‘çŠ¶æ•°ç»„ç»´æŠ¤ä¸€ä¸ªå·®åˆ†æ•°ç»„ $d_i$ã€‚è¯¢é—® $a[x]$ çš„å•ç‚¹å€¼ï¼Œç›´æ¥æ±‚ $d[1 \ldots x]$ çš„å’Œå³å¯ã€‚

è¿™é‡Œç›´æ¥ç»™å‡ºã€ŒåŒºé—´åŠ åŒºé—´å’Œã€çš„ä»£ç ï¼š

???+ note "å®ç°"
    === "C++"
    
        ```cpp
        int t1[MAXN], t2[MAXN], n;
    
        int lowbit(int x) { return x & (-x); }
    
        void add(int k, int v) {
          int v1 = k * v;
          while (k <= n) {
            t1[k] += v, t2[k] += v1;
            // æ³¨æ„ä¸èƒ½å†™æˆ t2[k] += k * vï¼Œå› ä¸º k çš„å€¼å·²ç»ä¸æ˜¯åŸæ•°ç»„çš„ä¸‹æ ‡äº†
            k += lowbit(k);
          }
        }
    
        int getsum(int *t, int k) {
          int ret = 0;
          while (k) {
            ret += t[k];
            k -= lowbit(k);
          }
          return ret;
        }
    
        void add1(int l, int r, int v) {
          add(l, v), add(r + 1, -v);  // å°†åŒºé—´åŠ å·®åˆ†ä¸ºä¸¤ä¸ªå‰ç¼€åŠ 
        }
    
        long long getsum1(int l, int r) {
          return (r + 1ll) * getsum(t1, r) - 1ll * l * getsum(t1, l - 1) -
                (getsum(t2, r) - getsum(t2, l - 1));
        }
        ```
    
    === "Python"
    
        ```python
        t1 = [0] * MAXN, t2 = [0] * MAXN; n = 0
    
        def lowbit(x):
            return x & (-x)
    
        def add(k, v):
            v1 = k * v
            while k <= n:
                t1[k] = t1[k] + v; t2[k] = t2[k] + v1
                k = k + lowbit(k)
    
        def getsum(t, k):
            ret = 0
            while k:
                ret = ret + t[k]
                k = k - lowbit(k)
            return ret
    
        def add1(l, r, v):
            add(l, v)
            add(r + 1, -v)
    
        def getsum1(l, r):
            return (r) * getsum(t1, r) - l * getsum(t1, l - 1) - \
                  (getsum(t2, r) - getsum(t2, l - 1))
        ```

æ ¹æ®è¿™ä¸ªåŸç†ï¼Œåº”è¯¥å¯ä»¥å®ç°ã€ŒåŒºé—´ä¹˜åŒºé—´ç§¯ã€ï¼Œã€ŒåŒºé—´å¼‚æˆ–ä¸€ä¸ªæ•°ï¼Œæ±‚åŒºé—´å¼‚æˆ–å€¼ã€ç­‰ï¼Œåªè¦æ»¡è¶³ç»´æŠ¤çš„ä¿¡æ¯å’ŒåŒºé—´æ“ä½œæ˜¯åŒç§è¿ç®—å³å¯ï¼Œæ„Ÿå…´è¶£çš„è¯»è€…å¯ä»¥è‡ªå·±å°è¯•ã€‚

## äºŒç»´æ ‘çŠ¶æ•°ç»„

### å•ç‚¹ä¿®æ”¹ï¼Œå­çŸ©é˜µæŸ¥è¯¢

äºŒç»´æ ‘çŠ¶æ•°ç»„ï¼Œä¹Ÿè¢«ç§°ä½œæ ‘çŠ¶æ•°ç»„å¥—æ ‘çŠ¶æ•°ç»„ï¼Œç”¨æ¥ç»´æŠ¤äºŒç»´æ•°ç»„ä¸Šçš„å•ç‚¹ä¿®æ”¹å’Œå‰ç¼€ä¿¡æ¯é—®é¢˜ã€‚

ä¸ä¸€ç»´æ ‘çŠ¶æ•°ç»„ç±»ä¼¼ï¼Œæˆ‘ä»¬ç”¨ $c(x, y)$ è¡¨ç¤º $a(x - \operatorname{lowbit}(x) + 1, y - \operatorname{lowbit}(y) + 1) \ldots a(x, y)$ çš„çŸ©é˜µæ€»ä¿¡æ¯ï¼Œå³ä¸€ä¸ªä»¥ $a(x, y)$ ä¸ºå³ä¸‹è§’ï¼Œé«˜ $\operatorname{lowbit}(x)$ï¼Œå®½ $\operatorname{lowbit}(y)$ çš„çŸ©é˜µçš„æ€»ä¿¡æ¯ã€‚

å¯¹äºå•ç‚¹ä¿®æ”¹ï¼Œè®¾ï¼š

$$
f(x, i) = \begin{cases}x &i = 0\\f(x, i - 1) + \operatorname{lowbit}(f(x, i - 1)) & i > 0\\\end{cases}
$$

å³ $f(x, i)$ ä¸º $x$ åœ¨æ ‘çŠ¶æ•°ç»„æ ‘å½¢æ€ä¸Šçš„ç¬¬ $i$ çº§ç¥–å…ˆï¼ˆç¬¬ $0$ çº§ç¥–å…ˆæ˜¯è‡ªå·±ï¼‰ã€‚

åˆ™åªæœ‰ $c(f(x, i), f(y, j))$ ä¸­çš„å…ƒç´ ç®¡è¾– $a(x, y)$ï¼Œä¿®æ”¹ $a(x, y)$ æ—¶åªéœ€ä¿®æ”¹æ‰€æœ‰ $c(f(x, i), f(y, j))$ï¼Œå…¶ä¸­ $f(x, i) \le n$ï¼Œ$f(y, j) \le m$ã€‚

??? note "æ­£ç¡®æ€§è¯æ˜"
    $c(p, q)$ ç®¡è¾– $a(x, y)$ï¼Œæ±‚ $p$ å’Œ $q$ çš„å–å€¼èŒƒå›´ã€‚
    
    è€ƒè™‘ä¸€ä¸ªå¤§å°ä¸º $n$ çš„ä¸€ç»´æ ‘çŠ¶æ•°ç»„ $c_1$ï¼ˆå¯¹åº”åŸæ•°ç»„ $a_1$ï¼‰å’Œä¸€ä¸ªå¤§å°ä¸º $m$ çš„ä¸€ç»´æ ‘çŠ¶æ•°ç»„ $c_2$ï¼ˆå¯¹åº”åŸæ•°ç»„ $a_2$ï¼‰ã€‚
    
    åˆ™å‘½é¢˜ç­‰ä»·ä¸ºï¼š$c_1(p)$ ç®¡è¾– $a_1[x]$ ä¸” $c_2(q)$ ç®¡è¾– $a_2[y]$ çš„æ¡ä»¶ã€‚
    
    ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ ‘çŠ¶æ•°ç»„æ ‘å½¢æ€ä¸Šï¼Œ$p$ æ˜¯ $x$ åŠå…¶ç¥–å…ˆä¸­çš„ä¸€ä¸ªç‚¹ï¼Œ$q$ æ˜¯ $y$ åŠå…¶ç¥–å…ˆä¸­çš„ä¸€ä¸ªç‚¹ã€‚
    
    æ‰€ä»¥ $p = f(x, i)$ï¼Œ$q = f(y, j)$ã€‚

å¯¹äºæŸ¥è¯¢ï¼Œæˆ‘ä»¬è®¾ï¼š

$$
g(x, i) = \begin{cases}x &i = 0\\g(x, i - 1) - \operatorname{lowbit}(g(x, i - 1)) & i, g(x, i - 1) > 0\\0&\text{otherwise.}\end{cases}
$$

åˆ™åˆå¹¶æ‰€æœ‰ $c(g(x, i), g(y, j))$ï¼Œå…¶ä¸­ $g(x, i), g(y, j) > 0$ã€‚

??? note "æ­£ç¡®æ€§è¯æ˜"
    è®¾ $\circ$ è¡¨ç¤ºåˆå¹¶ä¸¤ä¸ªä¿¡æ¯çš„è¿ç®—ç¬¦ï¼ˆæ¯”å¦‚ï¼Œå¦‚æœä¿¡æ¯æ˜¯åŒºé—´å’Œï¼Œåˆ™ $\circ = +$ï¼‰ã€‚
    
    è€ƒè™‘ä¸€ä¸ªä¸€ç»´æ ‘çŠ¶æ•°ç»„ $c_1$ï¼Œ$c_1[g(x, 0)] \circ c_1[g(x, 1)] \circ c_1[g(x, 2)] \circ \cdots$ æ°å¥½è¡¨ç¤ºåŸæ•°ç»„ä¸Š $[1 \ldots x]$ è¿™æ®µåŒºé—´ä¿¡æ¯ã€‚
    
    ç±»ä¼¼åœ°ï¼Œè®¾ $t(x) = c(x, g(y, 0)) \circ c(x, g(y, 1)) \circ c(x, g(y, 2)) \circ \cdots$ï¼Œåˆ™ $t(x)$ æ°å¥½è¡¨ç¤º $a(x - \operatorname{lowbit}(x) + 1, 1) \ldots a(x, y)$ è¿™ä¸ªçŸ©é˜µä¿¡æ¯ã€‚
    
    åˆç±»ä¼¼åœ°ï¼Œå°±æœ‰ $t(g(x, 0)) \circ t(g(x, 1)) \circ t(g(x, 2)) \circ \cdots$ è¡¨ç¤º $a(1, 1) \ldots a(x, y)$ è¿™ä¸ªçŸ©é˜µä¿¡æ¯ã€‚
    
    å…¶å®è¿™é‡Œ $t(x)$ è¿™ä¸ªå‡½æ•°å¦‚æœçœ‹æˆä¸€ä¸ªæ ‘çŠ¶æ•°ç»„ï¼Œç›¸å½“äºä¸€ä¸ªæ ‘çŠ¶æ•°ç»„å¥—äº†ä¸€ä¸ªæ ‘çŠ¶æ•°ç»„ï¼Œè¿™ä¹Ÿå°±æ˜¯ã€Œæ ‘çŠ¶æ•°ç»„å¥—æ ‘çŠ¶æ•°ç»„ã€è¿™ä¸ªåå­—çš„æ¥æºã€‚

ä¸‹é¢ç»™å‡ºå•ç‚¹åŠ ã€æŸ¥è¯¢å­çŸ©é˜µå’Œçš„ä»£ç ã€‚

???+ note "å®ç°"
    === "å•ç‚¹åŠ "
    
        ```cpp
        void add(int x, int y, int v) {
            for (int i = x; i <= n ;i += lowbit(i)) {
                for (int j = y; j <= m; j += lowbit(j)) {
                    // æ³¨æ„è¿™é‡Œå¿…é¡»å¾—å»ºå¾ªç¯å˜é‡ï¼Œä¸èƒ½åƒä¸€ç»´æ•°ç»„ä¸€æ ·ç›´æ¥ while (x <= n) äº†
                    c[i][j] += v;
                }
            }
        }
        ```
    
    === "æŸ¥è¯¢å­çŸ©é˜µå’Œ"
    
        ```cpp
        int sum(int x, int y) {
          int res = 0;
          for (int i = x; i > 0; i -= lowbit(i)) {
              for (int j = y; j > 0; j -= lowbit(j)) {
                  res += c[i][j];
              }
          }
          return res;
        }
    
        int ask(int x1, int y1, int x2, int y2) {
            // æŸ¥è¯¢å­çŸ©é˜µå’Œ
            return sum(x2, y2) - sum(x2, y1 - 1) - sum(x1 - 1, y2) + sum(x1 - 1, y1 - 1);
        }
        ```

### å­çŸ©é˜µåŠ ï¼Œæ±‚å­çŸ©é˜µå’Œ

å‰ç½®çŸ¥è¯†ï¼š[å‰ç¼€å’Œ & å·®åˆ†](../../basic/prefix-sum/) å’Œæœ¬é¡µé¢ [åŒºé—´åŠ åŒºé—´å’Œ](./#åŒºé—´åŠ åŒºé—´å’Œ) ä¸€èŠ‚ã€‚

å’Œä¸€ç»´æ ‘çŠ¶æ•°ç»„çš„ã€ŒåŒºé—´åŠ åŒºé—´å’Œã€é—®é¢˜ç±»ä¼¼ï¼Œè€ƒè™‘ç»´æŠ¤å·®åˆ†æ•°ç»„ã€‚

äºŒç»´æ•°ç»„ä¸Šçš„å·®åˆ†æ•°ç»„æ˜¯è¿™æ ·çš„ï¼š

$$
d(i, j) = a(i, j) - a(i - 1, j) - a(i, j - 1) + a(i - 1, j - 1)ã€‚
$$

??? note "ä¸ºä»€ä¹ˆè¿™ä¹ˆå®šä¹‰ï¼Ÿ"
    è¿™æ˜¯å› ä¸ºï¼Œç†æƒ³è§„å®šçŠ¶æ€ä¸‹ï¼Œåœ¨å·®åˆ†çŸ©é˜µä¸ŠåšäºŒç»´å‰ç¼€å’Œåº”è¯¥å¾—åˆ°åŸçŸ©é˜µï¼Œå› ä¸ºè¿™æ˜¯ä¸€å¯¹é€†è¿ç®—ã€‚
    
    äºŒç»´å‰ç¼€å’Œçš„å…¬å¼æ˜¯è¿™æ ·çš„ï¼š
    
    $s(i, j) = s(i - 1, j) + s(i, j - 1) - s(i - 1, j - 1) + a(i, j)$ã€‚
    
    æ‰€ä»¥ï¼Œè®¾ $a$ æ˜¯åŸæ•°ç»„ï¼Œ$d$ æ˜¯å·®åˆ†æ•°ç»„ï¼Œæœ‰ï¼š
    
    $a(i, j) = a(i - 1, j) + a(i, j - 1) - a(i - 1, j - 1) + d(i, j)$
    
    ç§»é¡¹å°±å¾—åˆ°äºŒç»´å·®åˆ†çš„å…¬å¼äº†ã€‚
    
    $d(i, j) = a(i, j) - a(i - 1, j) - a(i, j - 1) + a(i - 1, j - 1)$ã€‚

è¿™æ ·ä»¥æ¥ï¼Œå¯¹å·¦ä¸Šè§’ $(x_1, y_1)$ï¼Œå³ä¸‹è§’ $(x_2, y_2)$ çš„å­çŸ©é˜µåŒºé—´åŠ  $v$ï¼Œç›¸å½“äºåœ¨å·®åˆ†æ•°ç»„ä¸Šï¼Œå¯¹ $d(x_1, y_1)$ å’Œ $d(x_2 + 1, y_2 + 1)$ åˆ†åˆ«å•ç‚¹åŠ  $v$ï¼Œå¯¹ $d(x_2 + 1, y_1)$ å’Œ $d(x_1, y_2 + 1)$ åˆ†åˆ«å•ç‚¹åŠ  $-v$ã€‚

è‡³äºåŸå› ï¼ŒæŠŠè¿™å››ä¸ª $d$ åˆ†åˆ«ç”¨å®šä¹‰å¼è¡¨ç¤ºå‡ºæ¥ï¼Œåˆ†æä¸€ä¸‹æ¯é¡¹çš„å˜åŒ–å³å¯ã€‚

ä¸¾ä¸ªä¾‹å­å§ï¼Œåˆå§‹å·®åˆ†æ•°ç»„ä¸º $0$ï¼Œç»™ $a(2, 2) \ldots a(3, 4)$ å­çŸ©é˜µåŠ  $v$ åå·®åˆ†æ•°ç»„ä¼šå˜ä¸ºï¼š

$$
\begin{pmatrix}0&0&0&0&0\\0&v&0&0&-v\\0&0&0&0&0\\0&-v&0&0&v\end{pmatrix}
$$

ï¼ˆå…¶ä¸­ $a(2, 2) \ldots a(3, 4)$ è¿™ä¸ªå­çŸ©é˜µæ°å¥½æ˜¯ä¸Šé¢ä½äºä¸­å¿ƒçš„ $2 \times 3$ å¤§å°çš„çŸ©é˜µã€‚ï¼‰

å› æ­¤ï¼Œå­çŸ©é˜µåŠ çš„åšæ³•æ˜¯ï¼šè½¬åŒ–ä¸ºå·®åˆ†æ•°ç»„ä¸Šçš„å››ä¸ªå•ç‚¹åŠ æ“ä½œã€‚

ç°åœ¨è€ƒè™‘æŸ¥è¯¢å­çŸ©é˜µå’Œï¼š

å¯¹äºç‚¹ $(x, y)$ï¼Œå®ƒçš„äºŒç»´å‰ç¼€å’Œå¯ä»¥è¡¨ç¤ºä¸ºï¼š

$$
\sum_{i = 1}^x\sum_{j = 1}^y\sum_{h = 1}^i\sum_{k = 1}^j d(h, k)
$$

åŸå› å°±æ˜¯å·®åˆ†çš„å‰ç¼€å’Œçš„å‰ç¼€å’Œå°±æ˜¯åŸæœ¬çš„å‰ç¼€å’Œã€‚

å’Œä¸€ç»´æ ‘çŠ¶æ•°ç»„çš„ã€ŒåŒºé—´åŠ åŒºé—´å’Œã€é—®é¢˜ç±»ä¼¼ï¼Œç»Ÿè®¡ $d(h, k)$ çš„å‡ºç°æ¬¡æ•°ï¼Œä¸º $(x - h + 1) \times (y - k + 1)$ã€‚

ç„¶åæ¥ç€æ¨å¯¼ï¼š

$$
\begin{aligned}
&\sum_{i = 1}^x\sum_{j = 1}^y\sum_{h = 1}^i\sum_{k = 1}^j d(h, k)
\\=&\sum_{i = 1}^x\sum_{j = 1}^y d(i, j) \times (x - i + 1) \times (y - j + 1)
\\=&\sum_{i = 1}^x\sum_{j = 1}^y d(i, j) \times (xy + x + y + 1) - d(i, j) \times i \times (y + 1) - d(i, j) \times j \times (x + 1) + d(i, j) \times i \times j
\end{aligned}
$$

æ‰€ä»¥æˆ‘ä»¬éœ€ç»´æŠ¤å››ä¸ªæ ‘çŠ¶æ•°ç»„ï¼Œåˆ†åˆ«ç»´æŠ¤ $d(i, j)$ï¼Œ$d(i, j) \times i$ï¼Œ$d(i, j) \times j$ï¼Œ$d(i, j) \times i \times j$ çš„å’Œä¿¡æ¯ã€‚

å½“ç„¶äº†ï¼Œå’Œä¸€ç»´åŒç†ï¼Œå¦‚æœåªéœ€è¦å­çŸ©é˜µåŠ æ±‚å•ç‚¹å€¼ï¼Œç»´æŠ¤ä¸€ä¸ªå·®åˆ†æ•°ç»„ç„¶åè¯¢é—®å‰ç¼€å’Œå°±è¶³å¤Ÿäº†ã€‚

ä¸‹é¢ç»™å‡ºä»£ç ï¼š

???+ note "å®ç°"
    ```cpp
    typedef long long ll;
    ll t1[N][N], t2[N][N], t3[N][N], t4[N][N];
    
    void add(ll x, ll y, ll z) {
      for (int X = x; X <= n; X += lowbit(X))
        for (int Y = y; Y <= m; Y += lowbit(Y)) {
          t1[X][Y] += z;
          t2[X][Y] += z * x;  // æ³¨æ„æ˜¯ z * x è€Œä¸æ˜¯ z * Xï¼Œåé¢åŒç†
          t3[X][Y] += z * y;
          t4[X][Y] += z * x * y;
        }
    }
    
    void range_add(ll xa, ll ya, ll xb, ll yb,
                   ll z) {  //(xa, ya) åˆ° (xb, yb) å­çŸ©é˜µ
      add(xa, ya, z);
      add(xa, yb + 1, -z);
      add(xb + 1, ya, -z);
      add(xb + 1, yb + 1, z);
    }
    
    ll ask(ll x, ll y) {
      ll res = 0;
      for (int i = x; i; i -= lowbit(i))
        for (int j = y; j; j -= lowbit(j))
          res += (x + 1) * (y + 1) * t1[i][j] - (y + 1) * t2[i][j] -
                 (x + 1) * t3[i][j] + t4[i][j];
      return res;
    }
    
    ll range_ask(ll xa, ll ya, ll xb, ll yb) {
      return ask(xb, yb) - ask(xb, ya - 1) - ask(xa - 1, yb) + ask(xa - 1, ya - 1);
    }
    ```

## æƒå€¼æ ‘çŠ¶æ•°ç»„åŠåº”ç”¨

æˆ‘ä»¬çŸ¥é“ï¼Œæ™®é€šæ ‘çŠ¶æ•°ç»„ç›´æ¥åœ¨åŸåºåˆ—çš„åŸºç¡€ä¸Šæ„å»ºï¼Œ$c_6$ è¡¨ç¤ºçš„å°±æ˜¯ $a[5 \ldots 6]$ çš„åŒºé—´ä¿¡æ¯ã€‚

ç„¶è€Œäº‹å®ä¸Šï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨åŸåºåˆ—çš„æƒå€¼æ•°ç»„ä¸Šæ„å»ºæ ‘çŠ¶æ•°ç»„ï¼Œè¿™å°±æ˜¯æƒå€¼æ ‘çŠ¶æ•°ç»„ã€‚

??? note "ä»€ä¹ˆæ˜¯æƒå€¼æ•°ç»„ï¼Ÿ"
    ä¸€ä¸ªåºåˆ— $a$ çš„æƒå€¼æ•°ç»„ $b$ï¼Œæ»¡è¶³ $b[x]$ çš„å€¼ä¸º $x$ åœ¨ $a$ ä¸­çš„å‡ºç°æ¬¡æ•°ã€‚
    
    ä¾‹å¦‚ï¼š$a = (1, 3, 4, 3, 4)$ çš„æƒå€¼æ•°ç»„ä¸º $b = (1, 0, 2, 2)$ã€‚
    
    å¾ˆæ˜æ˜¾ï¼Œ$b$ çš„å¤§å°å’Œ $a$ çš„å€¼åŸŸæœ‰å…³ã€‚
    
    è‹¥åŸæ•°åˆ—å€¼åŸŸè¿‡å¤§ï¼Œä¸”é‡è¦çš„ä¸æ˜¯å…·ä½“å€¼è€Œæ˜¯å€¼ä¸å€¼ä¹‹é—´çš„ç›¸å¯¹å¤§å°å…³ç³»ï¼Œå¸¸ [ç¦»æ•£åŒ–](../../misc/discrete/) åŸæ•°ç»„åå†å»ºç«‹æƒå€¼æ•°ç»„ã€‚
    
    å¦å¤–ï¼Œæƒå€¼æ•°ç»„æ˜¯åŸæ•°ç»„æ— åºæ€§çš„ä¸€ç§è¡¨ç¤ºï¼šå®ƒé‡ç‚¹æè¿°æ•°ç»„çš„å…ƒç´ å†…å®¹ï¼Œå¿½ç•¥äº†æ•°ç»„çš„é¡ºåºï¼Œè‹¥ä¸¤æ•°ç»„åªæ˜¯é¡ºåºä¸åŒï¼Œæ‰€å«å†…å®¹ä¸€è‡´ï¼Œåˆ™å®ƒä»¬çš„æƒå€¼æ•°ç»„ç›¸åŒã€‚
    
    å› æ­¤ï¼Œå¯¹äºç»™å®šæ•°ç»„çš„é¡ºåºä¸å½±å“ç­”æ¡ˆçš„é—®é¢˜ï¼Œåœ¨æƒå€¼æ•°ç»„çš„åŸºç¡€ä¸Šæ€è€ƒä¸€èˆ¬æ›´ç›´è§‚ï¼Œæ¯”å¦‚ [\[NOIP2021\] æ•°åˆ—](https://www.luogu.com.cn/problem/P7961)ã€‚

è¿ç”¨æƒå€¼æ ‘çŠ¶æ•°ç»„ï¼Œæˆ‘ä»¬å¯ä»¥è§£å†³ä¸€äº›ç»å…¸é—®é¢˜ã€‚

### å•ç‚¹ä¿®æ”¹ï¼ŒæŸ¥è¯¢å…¨å±€ç¬¬ $k$ å°

åœ¨æ­¤å¤„åªè®¨è®ºç¬¬ $k$ å°ï¼Œç¬¬ $k$ å¤§é—®é¢˜å¯ä»¥é€šè¿‡ç®€å•è®¡ç®—è½¬åŒ–ä¸ºç¬¬ $k$ å°é—®é¢˜ã€‚

è¯¥é—®é¢˜å¯ç¦»æ•£åŒ–ï¼Œå¦‚æœåŸåºåˆ— $a$ å€¼åŸŸè¿‡å¤§ï¼Œç¦»æ•£åŒ–åå†å»ºç«‹æƒå€¼æ•°ç»„ $b$ã€‚æ³¨æ„ï¼Œè¿˜è¦æŠŠå•ç‚¹ä¿®æ”¹ä¸­çš„æ¶‰åŠåˆ°çš„å€¼ä¹Ÿä¸€èµ·ç¦»æ•£åŒ–ï¼Œä¸èƒ½åªç¦»æ•£åŒ–åŸæ•°ç»„ $a$ ä¸­çš„å…ƒç´ ã€‚

å¯¹äºå•ç‚¹ä¿®æ”¹ï¼Œåªéœ€å°†å¯¹åŸæ•°åˆ—çš„å•ç‚¹ä¿®æ”¹è½¬åŒ–ä¸ºå¯¹æƒå€¼æ•°ç»„çš„å•ç‚¹ä¿®æ”¹å³å¯ã€‚å…·ä½“æ¥è¯´ï¼ŒåŸæ•°ç»„ $a[x]$ ä» $y$ ä¿®æ”¹ä¸º $z$ï¼Œè½¬åŒ–ä¸ºå¯¹æƒå€¼æ•°ç»„ $b$ çš„å•ç‚¹ä¿®æ”¹å°±æ˜¯ $b[y]$ å•ç‚¹å‡ $1$ï¼Œ$b[z]$ å•ç‚¹åŠ  $1$ã€‚

å¯¹äºæŸ¥è¯¢ç¬¬ $k$ å°ï¼Œè€ƒè™‘äºŒåˆ† $x$ï¼ŒæŸ¥è¯¢æƒå€¼æ•°ç»„ä¸­ $[1, x]$ çš„å‰ç¼€å’Œï¼Œæ‰¾åˆ° $x_0$ ä½¿å¾— $[1, x_0]$ çš„å‰ç¼€å’Œ $< k$ è€Œ $[1, x_0 + 1]$ çš„å‰ç¼€å’Œ $\ge k$ï¼Œåˆ™ç¬¬ $k$ å¤§çš„æ•°æ˜¯ $x_0 + 1$ï¼ˆæ³¨ï¼šè¿™é‡Œè®¤ä¸º $[1, 0]$ çš„å‰ç¼€å’Œæ˜¯ $0$ï¼‰ã€‚

è¿™æ ·åšæ—¶é—´å¤æ‚åº¦æ˜¯ $\Theta(\log^2n)$ çš„ã€‚

è€ƒè™‘ç”¨å€å¢æ›¿ä»£äºŒåˆ†ã€‚

è®¾ $x = 0$ï¼Œ$\mathrm{sum} = 0$ï¼Œæšä¸¾ $i$ ä» $\log_2n$ é™ä¸º $0$ï¼š

-   æŸ¥è¯¢æƒå€¼æ•°ç»„ä¸­ $[x + 1 \ldots x + 2^i]$ çš„åŒºé—´å’Œ $t$ã€‚
-   å¦‚æœ $\mathrm{sum} + t < k$ï¼Œæ‰©å±•æˆåŠŸï¼Œ$x \gets x + 2^i$ï¼Œ$\mathrm{sum} \gets \mathrm{sum} + t$ï¼›å¦åˆ™æ‰©å±•å¤±è´¥ï¼Œä¸æ“ä½œã€‚

è¿™æ ·å¾—åˆ°çš„ $x$ æ˜¯æ»¡è¶³ $[1 \ldots x]$ å‰ç¼€å’Œ $< k$ çš„æœ€å¤§å€¼ï¼Œæ‰€ä»¥æœ€ç»ˆ $x + 1$ å°±æ˜¯ç­”æ¡ˆã€‚

çœ‹èµ·æ¥è¿™ç§æ–¹æ³•æ—¶é—´æ•ˆç‡æ²¡æœ‰ä»»ä½•æ”¹å–„ï¼Œä½†äº‹å®ä¸Šï¼ŒæŸ¥è¯¢ $[x + 1 \ldots x + 2^i]$ çš„åŒºé—´å’Œåªéœ€è®¿é—® $c[x + 2^i]$ çš„å€¼å³å¯ã€‚

åŸå› å¾ˆç®€å•ï¼Œè€ƒè™‘ $\operatorname{lowbit}(x + 2^i)$ï¼Œå®ƒä¸€å®šæ˜¯ $2^i$ï¼Œå› ä¸º $x$ ä¹‹å‰åªç´¯åŠ è¿‡ $2^j$ æ»¡è¶³ $j > i$ã€‚å› æ­¤ $c[x + 2^i]$ è¡¨ç¤ºçš„åŒºé—´å°±æ˜¯ $[x + 1 \ldots x + 2^i]$ã€‚

å¦‚æ­¤ä»¥æ¥ï¼Œæ—¶é—´å¤æ‚åº¦é™ä½ä¸º $\Theta(\log n)$ã€‚

???+ note "å®ç°"
    === "C++"
    
        ```cpp
        // æƒå€¼æ ‘çŠ¶æ•°ç»„æŸ¥è¯¢ç¬¬ k å°
        int kth(int k) {
          int sum = 0, x = 0;
          for (int i = log2(n); ~i; --i) {
            x += 1 << i;                      // å°è¯•æ‰©å±•
            if (x >= n || sum + t[x] >= k)  // å¦‚æœæ‰©å±•å¤±è´¥
              x -= 1 << i;
            else
              sum += t[x];
          }
          return x + 1;
        }
        ```
    
    === "Python"
    
        ```python
        # æƒå€¼æ ‘çŠ¶æ•°ç»„æŸ¥è¯¢ç¬¬ k å°
        def kth(k):
            sum = 0; x = 0
            i = log2(n)
            while ~i:
                x = x + (1 << i) # å°è¯•æ‰©å±•
                if x >= n or sum + t[x] >= k: # å¦‚æœæ‰©å±•å¤±è´¥
                    x = x - (1 << i)
                else:
                    sum = sum + t[x]
            return x + 1
        ```

### å…¨å±€é€†åºå¯¹ï¼ˆå…¨å±€äºŒç»´ååºï¼‰

å…¨å±€é€†åºå¯¹ä¹Ÿå¯ä»¥ç”¨æƒå€¼æ ‘çŠ¶æ•°ç»„å·§å¦™è§£å†³ã€‚é—®é¢˜æ˜¯è¿™æ ·çš„ï¼šç»™å®šé•¿åº¦ä¸º $n$ çš„åºåˆ— $a$ï¼Œæ±‚ $a$ ä¸­æ»¡è¶³ $i < j$ ä¸” $a[i] > a[j]$ çš„æ•°å¯¹ $(i, j)$ çš„æ•°é‡ã€‚

è¯¥é—®é¢˜å¯ç¦»æ•£åŒ–ï¼Œå¦‚æœåŸåºåˆ— $a$ å€¼åŸŸè¿‡å¤§ï¼Œç¦»æ•£åŒ–åå†å»ºç«‹æƒå€¼æ•°ç»„ $b$ã€‚

æˆ‘ä»¬è€ƒè™‘ä» $n$ åˆ° $1$ å€’åºæšä¸¾ $i$ï¼Œä½œä¸ºé€†åºå¯¹ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•ï¼Œç„¶åè®¡ç®—æœ‰å¤šå°‘ä¸ª $j > i$ æ»¡è¶³ $a[j] < a[i]$ï¼Œæœ€åç´¯è®¡ç­”æ¡ˆå³å¯ã€‚

äº‹å®ä¸Šï¼Œæˆ‘ä»¬åªéœ€è¦è¿™æ ·åšï¼ˆè®¾å½“å‰ $a[i] = x$ï¼‰ï¼š

-   æŸ¥è¯¢ $b[1 \ldots x - 1]$ çš„å‰ç¼€å’Œï¼Œå³ä¸ºå·¦ç«¯ç‚¹ä¸º $a[i]$ çš„é€†åºå¯¹æ•°é‡ã€‚
-   $b[x]$ è‡ªå¢ $1$ï¼›

åŸå› ååˆ†è‡ªç„¶ï¼šå‡ºç°åœ¨ $b[1 \ldots x-1]$ ä¸­çš„å…ƒç´ ä¸€å®šæ¯”å½“å‰çš„ $x = a[i]$ å°ï¼Œè€Œ $i$ çš„å€’åºæšä¸¾ï¼Œè‡ªç„¶ä½¿å¾—è¿™äº›å·²åœ¨æƒå€¼æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œåœ¨åŸæ•°ç»„ä¸Šçš„ç´¢å¼• $j$ å¤§äºå½“å‰éå†åˆ°çš„ç´¢å¼• $i$ã€‚

ç”¨ä¾‹å­è¯´æ˜ï¼Œ$a = (4, 3, 1, 2, 1)$ã€‚

$i$ æŒ‰ç…§ $5 \to 1$ æ‰«ï¼š

-   $a[5] = 1$ï¼ŒæŸ¥è¯¢ $b[1 \ldots 0]$ å‰ç¼€å’Œï¼Œä¸º $0$ï¼Œ$b[1]$ è‡ªå¢ $1$ï¼Œ$b = (1, 0, 0, 0)$ã€‚
-   $a[4] = 2$ï¼ŒæŸ¥è¯¢ $b[1 \ldots 1]$ å‰ç¼€å’Œï¼Œä¸º $1$ï¼Œ$b[2]$ è‡ªå¢ $1$ï¼Œ$b = (1, 1, 0, 0)$ã€‚
-   $a[3] = 1$ï¼ŒæŸ¥è¯¢ $b[1 \ldots 0]$ å‰ç¼€å’Œï¼Œä¸º $0$ï¼Œ$b[1]$ è‡ªå¢ $1$ï¼Œ$b = (2, 1, 0, 0)$ã€‚
-   $a[2] = 3$ï¼ŒæŸ¥è¯¢ $b[1 \ldots 2]$ å‰ç¼€å’Œï¼Œä¸º $3$ï¼Œ$b[3]$ è‡ªå¢ $1$ï¼Œ$b = (2, 1, 1, 0)$ã€‚
-   $a[1] = 4$ï¼ŒæŸ¥è¯¢ $b[1 \ldots 3]$ å‰ç¼€å’Œï¼Œä¸º $4$ï¼Œ$b[4]$ è‡ªå¢ $1$ï¼Œ$b = (2, 1, 1, 1)$ã€‚

æ‰€ä»¥æœ€ç»ˆç­”æ¡ˆä¸º $0 + 1 + 0 + 3 + 4 = 8$ã€‚

æ³¨æ„åˆ°ï¼Œéå† $i$ åçš„æŸ¥è¯¢ $b[1 \ldots x - 1]$ å’Œè‡ªå¢ $b[x]$ çš„ä¸¤ä¸ªæ­¥éª¤å¯ä»¥é¢ å€’ï¼Œå˜æˆå…ˆè‡ªå¢ $b[x]$ å†æŸ¥è¯¢ $b[1 \ldots x - 1]$ï¼Œä¸å½±å“ç­”æ¡ˆã€‚ä¸¤ä¸ªè§’åº¦æ¥è§£é‡Šï¼š

-   å¯¹ $b[x]$ çš„ä¿®æ”¹ä¸å½±å“å¯¹ $b[1 \ldots x - 1]$ çš„æŸ¥è¯¢ã€‚
-   é¢ å€’åï¼Œå®è´¨æ˜¯åœ¨æŸ¥è¯¢ $i \le j$ ä¸” $a[i] > a[j]$ çš„æ•°å¯¹æ•°é‡ï¼Œè€Œ $i = j$ æ—¶ä¸å­˜åœ¨ $a[i] > a[j]$ï¼Œæ‰€ä»¥ $i \le j$ ç›¸å½“äº $i < j$ï¼Œæ‰€ä»¥è¿™ä¸åŸæ¥çš„é€†åºå¯¹é—®é¢˜æ˜¯ç­‰ä»·çš„ã€‚

å¦‚æœæŸ¥è¯¢éä¸¥æ ¼é€†åºå¯¹ï¼ˆ$i < j$ ä¸” $a[i] \ge a[j]$ï¼‰çš„æ•°é‡ï¼Œé‚£å°±è¦æ”¹ä¸ºæŸ¥è¯¢ $b[1 \ldots x]$ çš„å’Œï¼Œè¿™æ—¶å°±ä¸èƒ½é¢ å€’ä¸¤æ­¥äº†ï¼Œè¿˜æ˜¯ä¸¤ä¸ªè§’åº¦æ¥è§£é‡Šï¼š

-   å¯¹ $b[x]$ çš„ä¿®æ”¹ **å½±å“** å¯¹ $b[1 \ldots x]$ çš„æŸ¥è¯¢ã€‚
-   é¢ å€’åï¼Œå®è´¨æ˜¯åœ¨æŸ¥è¯¢ $i \le j$ ä¸” $a[i] \ge a[j]$ çš„æ•°å¯¹æ•°é‡ï¼Œè€Œ $i = j$ æ—¶æ’æœ‰ $a[i] \ge a[j]$ï¼Œæ‰€ä»¥ $i \le j$  **ä¸ç›¸å½“äº**  $i < j$ï¼Œä¸åŸé—®é¢˜ **ä¸ç­‰ä»·**ã€‚

å¦‚æœæŸ¥è¯¢ $i \le j$ ä¸” $a[i] \ge a[j]$ çš„æ•°å¯¹æ•°é‡ï¼Œé‚£è¿™ä¸¤æ­¥å°±éœ€è¦é¢ å€’äº†ã€‚

å¦å¤–ï¼Œå¯¹äºåŸé€†åºå¯¹é—®é¢˜ï¼Œè¿˜æœ‰ä¸€ç§åšæ³•æ˜¯æ­£ç€æšä¸¾ $j$ï¼ŒæŸ¥è¯¢æœ‰å¤šå°‘ $i < j$ æ»¡è¶³ $a[i] > a[j]$ã€‚åšæ³•å¦‚ä¸‹ï¼ˆè®¾ $x = a[j]$ï¼‰ï¼š

-   æŸ¥è¯¢ $b[x + 1 \ldots V]$ï¼ˆ$V$ æ˜¯ $b$ çš„å¤§å°ï¼Œå³ $a$ çš„å€¼åŸŸï¼ˆæˆ–ç¦»æ•£åŒ–åçš„å€¼åŸŸï¼‰ï¼‰çš„åŒºé—´å’Œã€‚
-   å°† $b[x]$ è‡ªå¢ $1$ã€‚

åŸå› ï¼šå‡ºç°åœ¨ $b[x + 1 \ldots V]$ ä¸­çš„å…ƒç´ ä¸€å®šæ¯”å½“å‰çš„ $x = a[j]$ å¤§ï¼Œè€Œ $j$ çš„æ­£åºæšä¸¾ï¼Œè‡ªç„¶ä½¿å¾—è¿™äº›å·²åœ¨æƒå€¼æ•°ç»„ä¸­çš„å…ƒç´ ï¼Œåœ¨åŸæ•°ç»„ä¸Šçš„ç´¢å¼• $i$ å°äºå½“å‰éå†åˆ°çš„ç´¢å¼• $j$ã€‚

## æ ‘çŠ¶æ•°ç»„ç»´æŠ¤ä¸å¯å·®åˆ†ä¿¡æ¯

æ¯”å¦‚ç»´æŠ¤åŒºé—´æœ€å€¼ç­‰ã€‚

æ³¨æ„ï¼Œè¿™ç§æ–¹æ³•è™½ç„¶ç é‡å°ï¼Œä½†å•ç‚¹ä¿®æ”¹å’ŒåŒºé—´æŸ¥è¯¢çš„æ—¶é—´å¤æ‚åº¦å‡ä¸º $\Theta(\log^2n)$ï¼Œæ¯”ä½¿ç”¨çº¿æ®µæ ‘çš„æ—¶é—´å¤æ‚åº¦ $\Theta(\log n)$ åŠ£ã€‚

### åŒºé—´æŸ¥è¯¢

æˆ‘ä»¬è¿˜æ˜¯åŸºäºä¹‹å‰çš„æ€è·¯ï¼Œä» $r$ æ²¿ç€ $\operatorname{lowbit}$ ä¸€ç›´å‘å‰è·³ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸èƒ½è·³åˆ° $l$ çš„å·¦è¾¹ã€‚

å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬è·³åˆ°äº† $c[x]$ï¼Œå…ˆåˆ¤æ–­ä¸‹ä¸€æ¬¡è¦è·³åˆ°çš„ $x - \operatorname{lowbit}(x)$ æ˜¯å¦å°äº $l$ï¼š

-   å¦‚æœå°äº $l$ï¼Œæˆ‘ä»¬ç›´æ¥æŠŠ **$\boldsymbol{a[x]}$ å•ç‚¹** åˆå¹¶åˆ°æ€»ä¿¡æ¯é‡Œï¼Œç„¶åè·³åˆ° $c[x - 1]$ã€‚
-   å¦‚æœå¤§äºç­‰äº $l$ï¼Œè¯´æ˜æ²¡è¶Šç•Œï¼Œæ­£å¸¸åˆå¹¶ $c[x]$ï¼Œç„¶åè·³åˆ° $c[x - \operatorname{lowbit}(x)]$ å³å¯ã€‚

ä¸‹é¢ä»¥æŸ¥è¯¢åŒºé—´æœ€å¤§å€¼ä¸ºä¾‹ï¼Œç»™å‡ºä»£ç ï¼š

???+ note "å®ç°"
    ```cpp
    int getmax(int l, int r) {
      int ans = 0;
      while (r >= l) {
        ans = max(ans, a[r]);
        --r;
        for (; r - lowbit(r) >= l; r -= lowbit(r)) {
          // æ³¨æ„ï¼Œå¾ªç¯æ¡ä»¶ä¸è¦å†™æˆ r - lowbit(r) + 1 >= l
          // å¦åˆ™ l = 1 æ—¶ï¼Œr è·³åˆ° 0 ä¼šæ­»å¾ªç¯
          ans = max(ans, C[r]);
        }
      }
      return ans;
    }
    ```

å¯ä»¥è¯æ˜ï¼Œä¸Šè¿°ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦æ˜¯ $\Theta(\log^2n)$ã€‚

??? note "æ—¶é—´å¤æ‚åº¦è¯æ˜"
    è€ƒè™‘ $r$ å’Œ $l$ ä¸åŒçš„æœ€é«˜ä½ï¼Œä¸€å®šæœ‰ $r$ åœ¨è¿™ä¸€ä½ä¸Šä¸º $1$ï¼Œ$l$ åœ¨è¿™ä¸€ä½ä¸Šä¸º $0$ï¼ˆå› ä¸º $r \ge l$ï¼‰ã€‚
    
    å¦‚æœ $r$ åœ¨è¿™ä¸€ä½çš„åé¢ä»ç„¶æœ‰ $1$ï¼Œä¸€å®šæœ‰ $r - \operatorname{lowbit}(r) \ge l$ï¼Œæ‰€ä»¥ä¸‹ä¸€æ­¥ä¸€å®šæ˜¯æŠŠ $r$ çš„æœ€ä½ä½ $1$ å¡«ä¸º $0$ï¼›
    
    å¦‚æœ $r$ çš„è¿™ä¸€ä½ $1$ å°±æ˜¯ $r$ çš„æœ€ä½ä½ $1$ï¼Œæ— è®ºæ˜¯ $r \gets r - \operatorname{lowbit}(r)$ è¿˜æ˜¯ $r \gets r - 1$ï¼Œ$r$ çš„è¿™ä¸€ä½ $1$ ä¸€å®šä¼šå˜ä¸º $0$ã€‚
    
    å› æ­¤ï¼Œ$r$ ç»è¿‡è‡³å¤š $\log n$ æ¬¡å˜æ¢åï¼Œ$r$ å’Œ $l$ ä¸åŒçš„æœ€é«˜ä½ä¸€å®šå¯ä»¥ä¸‹é™ä¸€ä½ã€‚æ‰€ä»¥ï¼Œæ€»æ—¶é—´å¤æ‚åº¦æ˜¯ $\Theta(\log^2n)$ã€‚

### å•ç‚¹æ›´æ–°

???+ note "æ³¨"
    è¯·å…ˆç†è§£æ ‘çŠ¶æ•°ç»„æ ‘å½¢æ€çš„ä»¥ä¸‹ä¸¤æ¡æ€§è´¨ï¼Œå†å­¦ä¹ æœ¬èŠ‚ã€‚
    
    -   è®¾ $u = s \times 2^{k + 1} + 2^k$ï¼Œåˆ™å…¶å„¿å­æ•°é‡ä¸º $k = \log_2\operatorname{lowbit}(u)$ï¼Œç¼–å·åˆ†åˆ«ä¸º $u - 2^t(0 \le t < k)$ã€‚
    -   $u$ çš„æ‰€æœ‰å„¿å­å¯¹åº” $c$ çš„ç®¡è¾–åŒºé—´æ°å¥½æ‹¼æ¥æˆ $[l(u), u - 1]$ã€‚
    
    å…³äºè¿™ä¸¤æ¡æ€§è´¨çš„å«ä¹‰åŠè¯æ˜ï¼Œéƒ½å¯ä»¥åœ¨æœ¬é¡µé¢çš„ [æ ‘çŠ¶æ•°ç»„ä¸å…¶æ ‘å½¢æ€çš„æ€§è´¨](./#æ ‘çŠ¶æ•°ç»„ä¸å…¶æ ‘å½¢æ€çš„æ€§è´¨) ä¸€èŠ‚æ‰¾åˆ°ã€‚

æ›´æ–° $a[x]$ åï¼Œæˆ‘ä»¬åªéœ€è¦æ›´æ–°æ»¡è¶³åœ¨æ ‘çŠ¶æ•°ç»„æ ‘å½¢æ€ä¸Šï¼Œæ»¡è¶³ $y$ æ˜¯ $x$ çš„ç¥–å…ˆçš„ $c[y]$ã€‚

å¯¹äºæœ€å€¼ï¼ˆä»¥æœ€å¤§å€¼ä¸ºä¾‹ï¼‰ï¼Œä¸€ç§å¸¸è§çš„é”™è¯¯æƒ³æ³•æ˜¯ï¼Œå¦‚æœ $a[x]$ ä¿®æ”¹æˆ $p$ï¼Œåˆ™å°†æ‰€æœ‰ $c[y]$ æ›´æ–°ä¸º $\max(c[y], p)$ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªåä¾‹ï¼š$(1, 2, 3, 4, 5)$ ä¸­å°† $5$ ä¿®æ”¹æˆ $4$ï¼Œæœ€å¤§å€¼æ˜¯ $4$ï¼Œä½†æŒ‰ç…§ä¸Šé¢çš„ä¿®æ”¹è¿™æ ·ä¼šå¾—åˆ° $5$ã€‚å°† $c[y]$ ç›´æ¥ä¿®æ”¹ä¸º $p$ ä¹Ÿæ˜¯é”™è¯¯çš„ï¼Œä¸€ä¸ªåä¾‹æ˜¯ï¼Œå°†ä¸Šé¢ä¾‹å­ä¸­çš„ $3$ ä¿®æ”¹ä¸º $4$ã€‚

äº‹å®ä¸Šï¼Œå¯¹äºä¸å¯å·®åˆ†ä¿¡æ¯ï¼Œä¸å­˜åœ¨é€šè¿‡ $p$ ç›´æ¥ä¿®æ”¹ $c[y]$ çš„æ–¹å¼ã€‚è¿™æ˜¯å› ä¸ºä¿®æ”¹æœ¬èº«å°±ç›¸å½“äºæ˜¯æŠŠæ—§æ•°ä»åŸåŒºé—´ã€Œç§»é™¤ã€ï¼Œç„¶ååŠ å…¥ä¸€ä¸ªæ–°æ•°ã€‚ã€Œç§»é™¤ã€æ—¶å¯¹åŒºé—´ä¿¡æ¯çš„å½±å“ï¼Œç›¸å½“äºåšã€Œé€†è¿ç®—ã€ï¼Œè€Œä¸å¯å·®åˆ†ä¿¡æ¯ä¸å­˜åœ¨ã€Œé€†è¿ç®—ã€ï¼Œæ‰€ä»¥æ— æ³•ç›´æ¥ä¿®æ”¹ $c[y]$ã€‚

æ¢å¥è¯è¯´ï¼Œå¯¹æ¯ä¸ªå—å½±å“çš„ $c[y]$ï¼Œè¿™ä¸ªåŒºé—´çš„ä¿¡æ¯æˆ‘ä»¬å¿…å®šè¦é‡æ„äº†ã€‚

è€ƒè™‘ $c[y]$ çš„å„¿å­ä»¬ï¼Œå®ƒä»¬çš„ä¿¡æ¯ä¸€å®šæ˜¯æ­£ç¡®çš„ï¼ˆå› ä¸ºæˆ‘ä»¬å…ˆæ›´æ–°å„¿å­å†æ›´æ–°çˆ¶äº²ï¼‰ï¼Œè€Œè¿™äº›å„¿å­åˆæ°å¥½ç»„æˆäº† $[l(y), y - 1]$ è¿™ä¸€æ®µç®¡è¾–åŒºé—´ï¼Œé‚£å†åˆå¹¶ä¸€ä¸ªå•ç‚¹ $a[y]$ å°±å¯ä»¥åˆå¹¶å‡º $[l(y), y]$ï¼Œä¹Ÿå°±æ˜¯ $c[y]$ äº†ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬èƒ½ç”¨è‡³å¤š $\log n$ ä¸ªåŒºé—´é‡æ„åˆå¹¶å‡ºæ¯ä¸ªéœ€è¦ä¿®æ”¹çš„ $c$ã€‚

???+ note "å®ç°"
    ```cpp
    void update(int x, int v) {
      a[x] = v;
      for (int i = x; i <= n; i += lowbit(i)) {
        // æšä¸¾å—å½±å“çš„åŒºé—´
        C[i] = a[i];
        for (int j = 1; j < lowbit(i); j *= 2) {
          C[i] = max(C[i], C[i - j]);
        }
      }
    }
    ```

å®¹æ˜“çœ‹å‡ºä¸Šè¿°ç®—æ³•æ—¶é—´å¤æ‚åº¦ä¸º $\Theta(\log^2n)$ã€‚

### å»ºæ ‘

å¯ä»¥è€ƒè™‘æ‹†æˆ $n$ ä¸ªå•ç‚¹ä¿®æ”¹ï¼Œ$\Theta(n\log^2n)$ å»ºæ ‘ã€‚

ä¹Ÿæœ‰ $\Theta(n)$ çš„å»ºæ ‘æ–¹æ³•ï¼Œè§æœ¬é¡µé¢ [$\Theta(n)$ å»ºæ ‘](./#thetan-å»ºæ ‘) ä¸€èŠ‚çš„æ–¹æ³•ä¸€ã€‚

## Tricks

### $\Theta(n)$ å»ºæ ‘

ä»¥ç»´æŠ¤åŒºé—´å’Œä¸ºä¾‹ã€‚

æ–¹æ³•ä¸€ï¼š

æ¯ä¸€ä¸ªèŠ‚ç‚¹çš„å€¼æ˜¯ç”±æ‰€æœ‰ä¸è‡ªå·±ç›´æ¥ç›¸è¿çš„å„¿å­çš„å€¼æ±‚å’Œå¾—åˆ°çš„ã€‚å› æ­¤å¯ä»¥å€’ç€è€ƒè™‘è´¡çŒ®ï¼Œå³æ¯æ¬¡ç¡®å®šå®Œå„¿å­çš„å€¼åï¼Œç”¨è‡ªå·±çš„å€¼æ›´æ–°è‡ªå·±çš„ç›´æ¥çˆ¶äº²ã€‚

???+ note "å®ç°"
    === "C++"
    
        ```cpp
        // Î˜(n) å»ºæ ‘
        void init() {
          for (int i = 1; i <= n; ++i) {
            t[i] += a[i];
            int j = i + lowbit(i);
            if (j <= n) t[j] += t[i];
          }
        }
        ```
    
    === "Python"
    
        ```python
        # Î˜(n) å»ºæ ‘
        def init():
            for i in range(1, n + 1):
                t[i] = t[i] + a[i]
                j = i + lowbit(i)
                if j <= n:
                    t[j] = t[j] + t[i]
        ```

æ–¹æ³•äºŒï¼š

å‰é¢è®²åˆ° $c[i]$ è¡¨ç¤ºçš„åŒºé—´æ˜¯ $[i-\operatorname{lowbit}(i)+1, i]$ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å…ˆé¢„å¤„ç†ä¸€ä¸ª $\mathrm{sum}$ å‰ç¼€å’Œæ•°ç»„ï¼Œå†è®¡ç®— $c$ æ•°ç»„ã€‚

???+ note "å®ç°"
    === "C++"
    
        ```cpp
        // Î˜(n) å»ºæ ‘
        void init() {
          for (int i = 1; i <= n; ++i) {
            t[i] = sum[i] - sum[i - lowbit(i)];
          }
        }
        ```
    
    === "Python"
    
        ```python
        # Î˜(n) å»ºæ ‘
        def init():
            for i in range(1, n + 1):
                t[i] = sum[i] - sum[i-lowbit(i)]
        ```

### æ—¶é—´æˆ³ä¼˜åŒ–

å¯¹ä»˜å¤šç»„æ•°æ®å¾ˆå¸¸è§çš„æŠ€å·§ã€‚è‹¥æ¯æ¬¡è¾“å…¥æ–°æ•°æ®éƒ½æš´åŠ›æ¸…ç©ºæ ‘çŠ¶æ•°ç»„ï¼Œå°±å¯èƒ½ä¼šé€ æˆè¶…æ—¶ã€‚å› æ­¤ä½¿ç”¨ $\mathrm{tag}$ æ ‡è®°ï¼Œå­˜å‚¨å½“å‰èŠ‚ç‚¹ä¸Šæ¬¡ä½¿ç”¨æ—¶é—´ï¼ˆå³æœ€è¿‘ä¸€æ¬¡æ˜¯è¢«ç¬¬å‡ ç»„æ•°æ®ä½¿ç”¨ï¼‰ã€‚æ¯æ¬¡æ“ä½œæ—¶åˆ¤æ–­è¿™ä¸ªä½ç½® $\mathrm{tag}$ ä¸­çš„æ—¶é—´å’Œå½“å‰æ—¶é—´æ˜¯å¦ç›¸åŒï¼Œå°±å¯ä»¥åˆ¤æ–­è¿™ä¸ªä½ç½®åº”è¯¥æ˜¯ $0$ è¿˜æ˜¯æ•°ç»„å†…çš„å€¼ã€‚

???+ note "å®ç°"
    === "C++"
    
        ```cpp
        // æ—¶é—´æˆ³ä¼˜åŒ–
        int tag[MAXN], t[MAXN], Tag;
    
        void reset() { ++Tag; }
    
        void add(int k, int v) {
          while (k <= n) {
            if (tag[k] != Tag) t[k] = 0;
            t[k] += v, tag[k] = Tag;
            k += lowbit(k);
          }
        }
    
        int getsum(int k) {
          int ret = 0;
          while (k) {
            if (tag[k] == Tag) ret += t[k];
            k -= lowbit(k);
          }
          return ret;
        }
        ```
    
    === "Python"
    
        ```python
        # æ—¶é—´æˆ³ä¼˜åŒ–
        tag = [0] * MAXN; t = [0] * MAXN; Tag = 0
        def reset():
            Tag = Tag + 1
        def add(k, v):
            while k <= n:
                if tag[k] != Tag:
                    t[k] = 0
                t[k] = t[k] + v
                tag[k] = Tag
                k = k + lowbit(k)
        def getsum(k):
            ret = 0
            while k:
                if tag[k] == Tag:
                    ret = ret + t[k]
                k = k - lowbit(k)
            return ret
        ```

## ä¾‹é¢˜

- [æ ‘çŠ¶æ•°ç»„ 1ï¼šå•ç‚¹ä¿®æ”¹ï¼ŒåŒºé—´æŸ¥è¯¢](https://loj.ac/problem/130)
- [æ ‘çŠ¶æ•°ç»„ 2ï¼šåŒºé—´ä¿®æ”¹ï¼Œå•ç‚¹æŸ¥è¯¢](https://loj.ac/problem/131)
- [æ ‘çŠ¶æ•°ç»„ 3ï¼šåŒºé—´ä¿®æ”¹ï¼ŒåŒºé—´æŸ¥è¯¢](https://loj.ac/problem/132)
- [äºŒç»´æ ‘çŠ¶æ•°ç»„ 1ï¼šå•ç‚¹ä¿®æ”¹ï¼ŒåŒºé—´æŸ¥è¯¢](https://loj.ac/problem/133)
- [äºŒç»´æ ‘çŠ¶æ•°ç»„ 2ï¼šåŒºé—´ä¿®æ”¹ï¼Œå•ç‚¹æŸ¥è¯¢](https://loj.ac/problem/134)
- [äºŒç»´æ ‘çŠ¶æ•°ç»„ 3ï¼šåŒºé—´ä¿®æ”¹ï¼ŒåŒºé—´æŸ¥è¯¢](https://loj.ac/problem/135)
- [MooFest](http://poj.org/problem?id=1990)
- [Inner Vertices](http://poj.org/problem?id=3109)
- [Matrix](http://poj.org/problem?id=2155)
- [Who Gets the Most Candies?](http://poj.org/problem?id=2886)
