## å‰ç¼€å’Œ

### å®šä¹‰

å‰ç¼€å’Œå¯ä»¥ç®€å•ç†è§£ä¸ºã€Œæ•°åˆ—çš„å‰ $n$ é¡¹çš„å’Œã€ï¼Œæ˜¯ä¸€ç§é‡è¦çš„é¢„å¤„ç†æ–¹å¼ï¼Œèƒ½å¤§å¤§é™ä½æŸ¥è¯¢çš„æ—¶é—´å¤æ‚åº¦ã€‚[^note1]

C++ æ ‡å‡†åº“ä¸­å®ç°äº†å‰ç¼€å’Œå‡½æ•° [`std::partial_sum`](https://zh.cppreference.com/w/cpp/algorithm/partial_sum)ï¼Œå®šä¹‰äºå¤´æ–‡ä»¶ `<numeric>` ä¸­ã€‚

### ä¾‹é¢˜

!!! ä¾‹é¢˜
    æœ‰ $N$ ä¸ªçš„æ­£æ•´æ•°æ”¾åˆ°æ•°ç»„ $A$ é‡Œï¼Œç°åœ¨è¦æ±‚ä¸€ä¸ªæ–°çš„æ•°ç»„ $B$ï¼Œæ–°æ•°ç»„çš„ç¬¬ $i$ ä¸ªæ•° $B[i]$ æ˜¯åŸæ•°ç»„ $A$ ç¬¬ $0$ åˆ°ç¬¬ $i$ ä¸ªæ•°çš„å’Œã€‚
    
    è¾“å…¥ï¼š
    
    ```text
    5
    1 2 3 4 5
    ```
    
    è¾“å‡ºï¼š
    
    ```text
    1 3 6 10 15
    ```

??? note "è§£é¢˜æ€è·¯"
    é€’æ¨ï¼š`B[0] = A[0]`ï¼Œå¯¹äº $i \ge 1$ åˆ™ `B[i] = B[i-1] + A[i]`ã€‚

??? note "å‚è€ƒä»£ç "
    ```cpp
    --8<-- "docs/basic/code/prefix-sum/prefix-sum_1.cpp"
    ```

### äºŒç»´/å¤šç»´å‰ç¼€å’Œ

å¤šç»´å‰ç¼€å’Œçš„æ™®é€šæ±‚è§£æ–¹æ³•å‡ ä¹éƒ½æ˜¯åŸºäºå®¹æ–¥åŸç†ã€‚

???+note "ç¤ºä¾‹ï¼šä¸€ç»´å‰ç¼€å’Œæ‰©å±•åˆ°äºŒç»´å‰ç¼€å’Œ"
    æ¯”å¦‚æˆ‘ä»¬æœ‰è¿™æ ·ä¸€ä¸ªçŸ©é˜µ $a$ï¼Œå¯ä»¥è§†ä¸ºäºŒç»´æ•°ç»„ï¼š
    
    ```text
    1 2 4 3
    5 1 2 4
    6 3 5 9
    ```
    
    æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªçŸ©é˜µ $\textit{sum}$ ä½¿å¾— $\textit{sum}_{x,y} = \sum\limits_{i=1}^x \sum\limits_{j=1}^y a_{i,j}$ï¼Œ  
    é‚£ä¹ˆè¿™ä¸ªçŸ©é˜µé•¿è¿™æ ·ï¼š
    
    ```text
    1  3  7  10
    6  9  15 22
    12 18 29 45
    ```
    
    ç¬¬ä¸€ä¸ªé—®é¢˜å°±æ˜¯é€’æ¨æ±‚ $\textit{sum}$ çš„è¿‡ç¨‹ï¼Œ$\textit{sum}_{i,j} = \textit{sum}_{i - 1,j} + \textit{sum}_{i,j - 1} - \textit{sum}_{i - 1,j - 1} + a_{i,j}$ã€‚
    
    å› ä¸ºåŒæ—¶åŠ äº† $\textit{sum}_{i - 1,j}$ å’Œ $\textit{sum}_{i,j - 1}$ï¼Œæ•…é‡å¤äº† $\textit{sum}_{i - 1,j - 1}$ï¼Œå‡å»ã€‚
    
    ç¬¬äºŒä¸ªé—®é¢˜å°±æ˜¯å¦‚ä½•åº”ç”¨ï¼Œè­¬å¦‚æ±‚ $(x_1,y_1) - (x_2,y_2)$ å­çŸ©é˜µçš„å’Œã€‚
    
    é‚£ä¹ˆï¼Œæ ¹æ®ç±»ä¼¼çš„æ€è€ƒè¿‡ç¨‹ï¼Œæ˜“å¾—ç­”æ¡ˆä¸º $\textit{sum}_{x_2,y_2} - \textit{sum}_{x_1 - 1,y_2} - sum_{x_2,y_1 - 1} + sum_{x_1 - 1,y_1 - 1}$ã€‚

#### ä¾‹é¢˜

???+note "[æ´›è°· P1387 æœ€å¤§æ­£æ–¹å½¢](https://www.luogu.com.cn/problem/P1387)"
    åœ¨ä¸€ä¸ª $n\times m$ çš„åªåŒ…å« $0$ å’Œ $1$ çš„çŸ©é˜µé‡Œæ‰¾å‡ºä¸€ä¸ªä¸åŒ…å« $0$ çš„æœ€å¤§æ­£æ–¹å½¢ï¼Œè¾“å‡ºè¾¹é•¿ã€‚

??? tip
    è§£æ³•1ï¼šåŠ¨æ€è§„åˆ’
    
    $f[i][j]$è¡¨ç¤ºä»¥èŠ‚ç‚¹i,jä¸ºå³ä¸‹è§’ï¼Œå¯æ„æˆçš„æœ€å¤§æ­£æ–¹å½¢çš„è¾¹é•¿ã€‚
    
    $if (a[i][j]==1) f[i][j]=min(min(f[i][j-1],f[i-1][j]),f[i-1][j-1])+1;$

    è§£æ³•2ï¼šå‰ç¼€å’Œ+äºŒåˆ†
    
    å…ˆæšä¸¾æ­£æ–¹å½¢å·¦ä¸Šè§’ï¼ˆiï¼Œjï¼‰ï¼Œç„¶åæšä¸¾è¾¹é•¿lï¼Œåˆ¤æ–­æ­£æ–¹å½¢å†…çš„å…ƒç´ å’Œæ˜¯å¦ä¸ºæ­£æ–¹å½¢é¢ç§¯ï¼ˆå…ƒç´ ä¸æ˜¯0å°±æ˜¯1å˜›ï¼‰ï¼Œå¦‚æœæ˜¯åˆ™ans=maxï¼ˆlï¼Œansï¼‰ã€‚å¾—åˆ°ä¸€ä¸ª$O(nml^3)$;

    è€ƒè™‘ä¼˜åŒ–ï¼š

    æ±‚çŸ©é˜µå†…å…ƒç´ å’Œå½“ç„¶å¯ä»¥ä½¿ç”¨äºŒç»´å‰ç¼€å’Œå•¦ã€‚ ä¹Ÿå°±æ˜¯ï¼šsumä¸ºå‰ç¼€å’Œæ•°ç»„ï¼Œaä¸ºçŸ©é˜µå…ƒç´ ã€‚é¢„å¤„ç†ï¼š$sum[i][j]=sum[i][j-1]+sum[i-1][j]-sum[i-1][j-1]+a[i][j];$ æŒ‰iï¼Œjé¡ºç€æ¨ä¸€éå°±è¡Œäº†ã€‚æ±‚ï¼ˆlx,lyï¼‰åˆ°ï¼ˆrx,ry)è¿™ä¸€çŸ©é˜µä¸­çš„å…ƒç´ å’Œï¼š$sum[rx][ry]-sum[rx][ly-1]-sum[lx-1][ry]+sum[lx-1][ly-1];$ ç„¶åå°±å¯ä»¥æŠŠ$O(nml^3)$ ä¼˜åŒ–åˆ° $O(nml)$ã€‚ç„¶åå°±å¯ä»¥è¿‡å•¦

    æ³¨æ„åˆ°è‹¥ä¸€ä¸ªæ­£æ–¹å½¢ä¸­å…ƒç´ å’Œä¸ä¸ºæ­£æ–¹å½¢é¢ç§¯çš„è¯ï¼Œé‚£ä¹ˆå†æšä¸¾è¾¹é•¿ï¼ˆå½“ç„¶æ˜¯æŒ‰è¾¹é•¿ä»å°åˆ°å¤§æšä¸¾å•¦ï¼‰æ˜¾ç„¶æ²¡æœ‰æ„ä¹‰ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥breakã€‚ï¼ˆæ³¨æ„åˆ°æ­£æ–¹å½¢é¢ç§¯ä¸è¾¹é•¿æˆå‡½æ•°å…³ç³»ï¼Œå³$S(l)=l^2$ï¼ŒS(l)å…·æœ‰ä¸¥æ ¼å•è°ƒæ€§ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥äºŒåˆ†lå•¦ï¼Œå¤æ‚åº¦å¯ä»¥è¾¾åˆ°$O(nm \log (\min(n,m)))$ ã€‚

    è¾¹é•¿æŒ‰ä»å°åˆ°å¤§æšä¸¾é‡åˆ°ä¸åˆæ³•æƒ…å†µç›´æ¥breakï¼ˆå½“ç„¶æ˜¯åœ¨æšä¸¾æ—¶æ‰èƒ½ç”¨å•¦ï¼‰ã€‚

??? note "å‚è€ƒä»£ç "
    === "åŠ¨æ€è§„åˆ’"

        ```cpp
        #include <iostream>
        #include <cstdio>
        using namespace std;
        int a[101][101],n,m,f[101][101],ans;
        int main()
        {
            scanf("%d%d",&n,&m);//è¯»å…¥
            for (int i=1;i<=n;++i)
                for (int j=1;j<=m;++j)
                {
                    scanf("%d",&a[i][j]);
                    //å› ä¸ºåªéœ€ç”¨åˆ°iï¼Œjä¸Šæ–¹ï¼Œå·¦æ–¹ï¼Œå·¦ä¸Šæ–¹çš„ä¿¡æ¯ï¼Œè¯»å…¥åŒæ­¥å¤„ç†
                    if (a[i][j]==1) f[i][j]=min(min(f[i][j-1],f[i-1][j]),f[i-1][j-1])+1;
                    ans=max(ans,f[i][j]);//åŒæ­¥æ›´æ–°ç­”æ¡ˆ
                }
            printf("%d",ans);
        }
        ```

    === "å‰ç¼€å’Œ+äºŒåˆ†"

        ```cpp
        #include <bits/stdc++.h>
        using namespace std;
        int n, m, ans = 0, x, f[205][205];
        int main() {
            scanf("%d%d", &n, &m);
            for (int i=0; i<n; ++i)
                for (int j=0; j<m; ++j) {
                    scanf("%d", &x);
                    f[i][j]= f[i-1][j]+f[i][j-1]-f[i-1][j-1]+x;
                }
            for (int i=0; i<n; ++i)
                for (int j=0; j<m; ++j) {
                    int l = 0, r = min(n,m);
                    while (l<=r) {
                        int mid = (l+r)>>1;
                        if (i+mid>n || j+mid>m || f[i+mid][j+mid]-f[i+mid][j]-f[i][j+mid]+f[i][j] < mid*mid) r = mid-1;
                            else l = mid+1;
                    }
                    if (f[i+r][j+r]-f[i+r][j]-f[i][j+r]+f[i][j] == r*r) ans = max(ans, r);
                }
            cout << ans;
            return 0;
        }
        ```

    === "OI-Wiki"

        ```cpp
        --8<-- "docs/basic/code/prefix-sum/prefix-sum_2.cpp"
        ```

### åŸºäº DP è®¡ç®—é«˜ç»´å‰ç¼€å’Œ

åŸºäºå®¹æ–¥åŸç†æ¥è®¡ç®—é«˜ç»´å‰ç¼€å’Œçš„æ–¹æ³•ï¼Œå…¶ä¼˜ç‚¹åœ¨äºå½¢å¼è¾ƒä¸ºç®€å•ï¼Œæ— éœ€ç‰¹åˆ«è®°å¿†ï¼Œä½†å½“ç»´æ•°å‡é«˜æ—¶ï¼Œå…¶å¤æ‚åº¦è¾ƒé«˜ã€‚è¿™é‡Œä»‹ç»ä¸€ç§åŸºäº [DP](../dp/basic.md) è®¡ç®—é«˜ç»´å‰ç¼€å’Œçš„æ–¹æ³•ã€‚è¯¥æ–¹æ³•å³é€šå¸¸è¯­å¢ƒä¸­æ‰€ç§°çš„ **é«˜ç»´å‰ç¼€å’Œ**ã€‚

è®¾é«˜ç»´ç©ºé—´ $U$ å…±æœ‰ $D$ ç»´ï¼Œéœ€è¦å¯¹ $f[\cdot]$ æ±‚é«˜ç»´å‰ç¼€å’Œ $\text{sum}[\cdot]$ã€‚ä»¤ $\text{sum}[i][\text{state}]$ è¡¨ç¤ºåŒ $\text{state}$ å $D - i$ ç»´ç›¸åŒçš„æ‰€æœ‰ç‚¹å¯¹äº $\text{state}$ ç‚¹é«˜ç»´å‰ç¼€å’Œçš„è´¡çŒ®ã€‚ç”±å®šä¹‰å¯çŸ¥ $\text{sum}[0][\text{state}] = f[\text{state}]$ï¼Œä»¥åŠ $\text{sum}[\text{state}] = \text{sum}[D][\text{state}]$ã€‚

å…¶é€’æ¨å…³ç³»ä¸º $\text{sum}[i][\text{state}] = \text{sum}[i - 1][\text{state}] + \text{sum}[i][\text{state}']$ï¼Œå…¶ä¸­ $\text{state}'$ ä¸ºç¬¬ $i$ ç»´æ°å¥½æ¯” $\text{state}$ å°‘ $1$ çš„ç‚¹ã€‚è¯¥æ–¹æ³•çš„å¤æ‚åº¦ä¸º $O(D \times |U|)$ï¼Œå…¶ä¸­ $|U|$ ä¸ºé«˜ç»´ç©ºé—´ $U$ çš„å¤§å°ã€‚

ä¸€ç§å®ç°çš„ä¼ªä»£ç å¦‚ä¸‹ï¼š

    for state
      sum[state] = f[state];
    for(i = 0;i <= D;i += 1)
      for ä»¥å­—å…¸åºä»å°åˆ°å¤§æšä¸¾ state
        sum[state] += sum[state'];

### æ ‘ä¸Šå‰ç¼€å’Œ

è®¾ $\textit{sum}_i$ è¡¨ç¤ºç»“ç‚¹ $i$ åˆ°æ ¹èŠ‚ç‚¹çš„æƒå€¼æ€»å’Œã€‚  
ç„¶åï¼š

- è‹¥æ˜¯ç‚¹æƒï¼Œ$x,y$ è·¯å¾„ä¸Šçš„å’Œä¸º $\textit{sum}_x + \textit{sum}_y - \textit{sum}_\textit{lca} - \textit{sum}_{\textit{fa}_\textit{lca}}$ã€‚
-   è‹¥æ˜¯è¾¹æƒï¼Œ$x,y$ è·¯å¾„ä¸Šçš„å’Œä¸º $\textit{sum}_x + \textit{sum}_y - 2\cdot\textit{sum}_{lca}$ã€‚

    LCA çš„æ±‚æ³•å‚è§ [æœ€è¿‘å…¬å…±ç¥–å…ˆ](../graph/lca.md)ã€‚

## å·®åˆ†

### è§£é‡Š

å·®åˆ†æ˜¯ä¸€ç§å’Œå‰ç¼€å’Œç›¸å¯¹çš„ç­–ç•¥ï¼Œå¯ä»¥å½“åšæ˜¯æ±‚å’Œçš„é€†è¿ç®—ã€‚

è¿™ç§ç­–ç•¥çš„å®šä¹‰æ˜¯ä»¤ $b_i=\begin{cases}a_i-a_{i-1}\,&i \in[2,n] \\ a_1\,&i=1\end{cases}$

å·®åˆ†æ˜¯ä¸€ç§å¤„ç†æ•°æ®çš„å·§å¦™è€Œç®€å•çš„æ–¹æ³•ï¼Œå®ƒåº”ç”¨äºåŒºé—´çš„ä¿®æ”¹å’Œè¯¢é—®é—®é¢˜ã€‚æŠŠç»™å®šçš„æ•°æ®å…ƒç´ é›†Aåˆ†æˆå¾ˆå¤šåŒºé—´ï¼Œå¯¹è¿™äº›åŒºé—´åšå¾ˆå¤šæ¬¡æ“ä½œï¼Œæ¯æ¬¡æ“ä½œæ˜¯å¯¹æŸä¸ªåŒºé—´å†…çš„æ‰€æœ‰å…ƒç´ åšç›¸åŒçš„åŠ å‡æ“ä½œï¼Œè‹¥ä¸€ä¸ªä¸ªåœ°ä¿®æ”¹è¿™ä¸ªåŒºé—´å†…çš„æ¯ä¸ªå…ƒç´ ï¼Œéå¸¸è€—æ—¶ã€‚å¼•å…¥â€œå·®åˆ†æ•°ç»„â€Dï¼Œå½“ä¿®æ”¹æŸä¸ªåŒºé—´æ—¶ï¼Œåªéœ€è¦ä¿®æ”¹è¿™ä¸ªåŒºé—´çš„â€œç«¯ç‚¹â€ï¼Œå°±èƒ½è®°å½•æ•´ä¸ªåŒºé—´çš„ä¿®æ”¹ï¼Œè€Œå¯¹ç«¯ç‚¹çš„ä¿®æ”¹éå¸¸å®¹æ˜“ï¼Œæ˜¯ğ‘‚(1)å¤æ‚åº¦çš„ã€‚å½“æ‰€æœ‰çš„ä¿®æ”¹æ“ä½œç»“æŸåï¼Œå†åˆ©ç”¨å·®åˆ†æ•°ç»„ï¼Œè®¡ç®—å‡ºæ–°çš„Aã€‚

æ•°æ®Aå¯ä»¥æ˜¯ä¸€ç»´çš„çº¿æ€§æ•°ç»„ğ‘\[\]ã€äºŒç»´çŸ©é˜µğ‘\[\]\[\]ã€ä¸‰ç»´ç«‹ä½“ğ‘\[\]\[\]\[\]ã€‚ç›¸åº”åœ°ï¼Œå®šä¹‰å·®åˆ†æ•°ç»„ğ·\[\]ã€ğ·\[\]\[\]ã€ğ·\[\]\[\]\[\]ã€‚ä¸€ç»´å·®åˆ†å¾ˆå®¹æ˜“ç†è§£ï¼ŒäºŒç»´å’Œä¸‰ç»´éœ€è¦ä¸€ç‚¹æƒ³è±¡åŠ›ã€‚

- $a_i$ çš„å€¼æ˜¯ $b_i$ çš„å‰ç¼€å’Œï¼Œå³ $a_n=\sum\limits_{i=1}^nb_i$
- è®¡ç®— $a_i$ çš„å‰ç¼€å’Œ $sum=\sum\limits_{i=1}^na_i=\sum\limits_{i=1}^n\sum\limits_{j=1}^{i}b_j=\sum\limits_{i}^n(n-i+1)b_i$

å®ƒå¯ä»¥ç»´æŠ¤å¤šæ¬¡å¯¹åºåˆ—çš„ä¸€ä¸ªåŒºé—´åŠ ä¸Šä¸€ä¸ªæ•°ï¼Œå¹¶åœ¨æœ€åè¯¢é—®æŸä¸€ä½çš„æ•°æˆ–æ˜¯å¤šæ¬¡è¯¢é—®æŸä¸€ä½çš„æ•°ã€‚æ³¨æ„ä¿®æ”¹æ“ä½œä¸€å®šè¦åœ¨æŸ¥è¯¢æ“ä½œä¹‹å‰ã€‚

### ä¸€ç»´å·®åˆ†

è®¨è®ºè¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼š

1. ç»™å®šä¸€ä¸ªé•¿åº¦ä¸ºnçš„ä¸€ç»´æ•°ç»„ğ‘\[\]ï¼Œæ•°ç»„å†…æ¯ä¸ªå…ƒç´ æœ‰åˆå§‹å€¼ã€‚
2. ä¿®æ”¹æ“ä½œï¼šåšmæ¬¡åŒºé—´ä¿®æ”¹ï¼Œæ¯æ¬¡ä¿®æ”¹å¯¹åŒºé—´å†…æ‰€æœ‰å…ƒç´ åšç›¸åŒçš„åŠ å‡æ“ä½œã€‚ä¾‹å¦‚ç¬¬ğ‘–æ¬¡ä¿®æ”¹ï¼ŒæŠŠåŒºé—´\[ğ¿ğ‘–,ğ‘…ğ‘–\]å†…æ‰€æœ‰å…ƒç´ åŠ ä¸Šğ‘‘ğ‘–ã€‚
3. è¯¢é—®æ“ä½œï¼šè¯¢é—®ä¸€ä¸ªå…ƒç´ çš„æ–°å€¼æ˜¯å¤šå°‘ã€‚

å¦‚æœç®€å•åœ°ç”¨æš´åŠ›æ³•ç¼–ç ï¼Œé‚£ä¹ˆæ¯æ¬¡ä¿®æ”¹çš„å¤æ‚åº¦æ˜¯ğ‘‚(ğ‘›)çš„ï¼Œmæ¬¡ä¿®æ”¹å…±ğ‘‚(ğ‘šğ‘›)ï¼Œæ€»å¤æ‚åº¦ğ‘‚(ğ‘šğ‘›)ï¼Œæ•ˆç‡å¾ˆå·®ã€‚åˆ©ç”¨å·®åˆ†æ³•ï¼Œå¯ä»¥æŠŠå¤æ‚åº¦å‡å°‘åˆ°ğ‘‚(ğ‘š+ğ‘›)ã€‚

åœ¨å·®åˆ†æ³•ä¸­ï¼Œç”¨åˆ°äº†ä¸¤ä¸ªæ•°ç»„ï¼šåŸæ•°ç»„ğ‘\[\]ã€å·®åˆ†æ•°ç»„ğ·\[\]ã€‚

å·®åˆ†æ•°ç»„D\[\]çš„å®šä¹‰æ˜¯ğ·\[ğ‘˜\]=ğ‘\[ğ‘˜\]âˆ’ğ‘\[ğ‘˜âˆ’1\]ï¼Œå³åŸæ•°ç»„ğ‘\[\]çš„ç›¸é‚»å…ƒç´ çš„å·®ã€‚ä»å®šä¹‰å¯ä»¥æ¨å‡ºğ‘\[ğ‘˜\]=ğ·\[1\]+ğ·\[2\]+...+ğ·\[ğ‘˜\]ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œğ‘\[\]æ˜¯ğ·\[\]çš„å‰ç¼€å’Œã€‚è¿™ä¸ªå…¬å¼æ­ç¤ºäº†ğ‘\[\]å’Œğ·\[\]çš„å…³ç³»ï¼Œâ€œå·®åˆ†æ˜¯å‰ç¼€å’Œçš„é€†è¿ç®—â€ï¼Œå®ƒæŠŠæ±‚ğ‘\[ğ‘˜\]è½¬åŒ–ä¸ºæ±‚Dçš„å‰ç¼€å’Œã€‚ä¸ºåŠ æ·±å¯¹å‰ç¼€å’Œçš„ç†è§£ï¼Œå¯ä»¥æŠŠæ¯ä¸ªğ·\[\]çœ‹æˆä¸€æ¡ç›´çº¿ä¸Šçš„å°çº¿æ®µï¼Œå®ƒçš„ä¸¤ç«¯æ˜¯ç›¸é‚»çš„ğ‘\[\]ï¼›è¿™äº›å°çº¿æ®µç›¸åŠ ï¼Œå°±å¾—åˆ°äº†ä»èµ·ç‚¹å¼€å§‹çš„é•¿çº¿æ®µğ‘\[\]ã€‚

æ³¨æ„ï¼Œğ‘\[\]å’Œğ·\[\]çš„å€¼éƒ½å¯èƒ½ä¸ºè´Ÿï¼Œä¸‹é¢å›¾ä¸­æ‰€æœ‰çš„ğ·\[\]éƒ½æ˜¯é•¿åº¦ä¸ºæ­£çš„çº¿æ®µï¼Œåªæ˜¯ä¸ºäº†æ–¹ä¾¿å›¾ç¤ºã€‚

![](./images/prefix-1.png)

å›¾: æŠŠæ¯ä¸ªD\[\]çœ‹æˆå°çº¿æ®µï¼ŒæŠŠæ¯ä¸ªa\[\]çœ‹æˆä»a\[1\]å¼€å§‹çš„å°çº¿æ®µçš„å’Œ

å¦‚ä½•ç”¨å·®åˆ†æ•°ç»„è®°å½•åŒºé—´ä¿®æ”¹ï¼Ÿä¸ºä»€ä¹ˆåˆ©ç”¨å·®åˆ†æ•°ç»„èƒ½æå‡ä¿®æ”¹çš„æ•ˆç‡å‘¢ï¼Ÿ

æŠŠåŒºé—´\[ğ¿,ğ‘…\]å†…æ¯ä¸ªå…ƒç´ åŠ ä¸Šğ‘‘ï¼Œå¯¹åº”çš„ğ·\[\]åšä»¥ä¸‹æ“ä½œï¼š

ï¼ˆ1ï¼‰æŠŠğ·\[ğ¿\]åŠ ä¸Šğ‘‘ï¼š

     D[L] += d

ï¼ˆ2ï¼‰æŠŠğ·\[ğ‘…+1\]å‡å»ğ‘‘ï¼š

     D[R+1] -= d

æ¯æ¬¡æ“ä½œåªéœ€è¦ä¿®æ”¹åŒºé—´\[ğ¿,ğ‘…\]çš„ä¸¤ä¸ªç«¯ç‚¹çš„ğ·\[\]å€¼ï¼Œå¤æ‚åº¦æ˜¯ğ‘‚(1)çš„ã€‚ç»è¿‡è¿™ç§æ“ä½œåï¼ŒåŸæ¥ç›´æ¥åœ¨ğ‘\[\]ä¸Šåšçš„å¤æ‚åº¦ä¸ºğ‘‚(ğ‘›)çš„åŒºé—´ä¿®æ”¹æ“ä½œï¼Œå°±å˜æˆäº†åœ¨ğ·\[\]ä¸Šåšçš„å¤æ‚åº¦ä¸ºğ‘‚(1)çš„ç«¯ç‚¹æ“ä½œã€‚

åˆ©ç”¨ğ·\[\]ï¼Œèƒ½ç²¾ç¡®åœ°å®ç°åªä¿®æ”¹åŒºé—´å†…å…ƒç´ çš„ç›®çš„ï¼Œè€Œä¸ä¼šä¿®æ”¹åŒºé—´å¤–çš„ğ‘\[\]å€¼ã€‚å› ä¸ºå‰ç¼€å’Œğ‘\[ğ‘¥\]=ğ·\[1\]+ğ·\[2\]+...+ğ·\[ğ‘¥\]ï¼Œæœ‰ï¼š

1. 1â‰¤ğ‘¥<ğ¿ï¼Œå‰ç¼€å’Œğ‘\[ğ‘¥\]ä¸å˜ï¼›
2. ğ¿â‰¤ğ‘¥â‰¤ğ‘…ï¼Œå‰ç¼€å’Œğ‘\[ğ‘¥\]å¢åŠ äº†ğ‘‘ï¼›
3. ğ‘…<ğ‘¥â‰¤ğ‘ï¼Œå‰ç¼€å’Œğ‘\[ğ‘¥\]ä¸å˜ï¼Œå› ä¸ºè¢«ğ·\[ğ‘…+1\]ä¸­å‡å»çš„ğ‘‘æŠµæ¶ˆäº†ã€‚

å®ŒæˆåŒºé—´ä¿®æ”¹å¹¶å¾—åˆ°ğ·\[\]åï¼Œæœ€åç”¨ğ·\[\]è®¡ç®—ğ‘\[\]ï¼Œå¤æ‚åº¦æ˜¯ğ‘‚(ğ‘›)çš„ã€‚mæ¬¡åŒºé—´ä¿®æ”¹å’Œ1æ¬¡æŸ¥è¯¢ï¼Œæ€»å¤æ‚åº¦ä¸ºğ‘‚(ğ‘š+ğ‘›)ï¼Œæ¯”æš´åŠ›æ³•çš„ğ‘‚(ğ‘šğ‘›)å¥½å¤šäº†ã€‚

???+note "ç¤ºä¾‹"
    è­¬å¦‚ä½¿ $[l,r]$ ä¸­çš„æ¯ä¸ªæ•°åŠ ä¸Šä¸€ä¸ª $k$ï¼Œå³
    
    $$
    b_l \leftarrow b_l + k,b_{r + 1} \leftarrow b_{r + 1} - k
    $$
    
    å…¶ä¸­ $b_l+k=a_l+k-a_{l-1}$ï¼Œ$b_{r+1}-k=a_{r+1}-(a_r+k)$
    
    æœ€ååšä¸€éå‰ç¼€å’Œå°±å¥½äº†ã€‚

C++ æ ‡å‡†åº“ä¸­å®ç°äº†å·®åˆ†å‡½æ•° [`std::adjacent_difference`](https://zh.cppreference.com/w/cpp/algorithm/adjacent_difference)ï¼Œå®šä¹‰äºå¤´æ–‡ä»¶ `<numeric>` ä¸­ã€‚


???+note "[Color the ball](http://acm.hdu.edu.cn/showproblem.php?pid=1556)"
    **é—®é¢˜æè¿°ï¼š** Nä¸ªæ°”çƒæ’æˆä¸€æ’ï¼Œä»å·¦åˆ°å³ä¾æ¬¡ç¼–å·ä¸º1, 2, 3 .... Nã€‚æ¯æ¬¡ç»™å®š2ä¸ªæ•´æ•°L, R(L<= R)ï¼Œleleä»æ°”çƒLå¼€å§‹åˆ°æ°”çƒRä¾æ¬¡ç»™æ¯ä¸ªæ°”çƒæ¶‚ä¸€æ¬¡é¢œè‰²ã€‚ä½†æ˜¯Næ¬¡ä»¥åleleå·²ç»å¿˜è®°äº†ç¬¬Iä¸ªæ°”çƒå·²ç»æ¶‚è¿‡å‡ æ¬¡é¢œè‰²äº†ï¼Œä½ èƒ½å¸®ä»–ç®—å‡ºæ¯ä¸ªæ°”çƒè¢«æ¶‚è¿‡å‡ æ¬¡é¢œè‰²å—ï¼Ÿ
    
    **è¾“å…¥ï¼š** æ¯ä¸ªæµ‹è¯•å®ä¾‹ç¬¬ä¸€è¡Œä¸ºä¸€ä¸ªæ•´æ•°Nï¼Œ(N <= 100000)ã€‚æ¥ä¸‹æ¥çš„Nè¡Œï¼Œæ¯è¡ŒåŒ…æ‹¬2ä¸ªæ•´æ•°L, R(1 <= L<= R<= N)ã€‚å½“N = 0ï¼Œè¾“å…¥ç»“æŸã€‚
    
    **è¾“å‡ºï¼š**æ¯ä¸ªæµ‹è¯•å®ä¾‹è¾“å‡ºä¸€è¡Œï¼ŒåŒ…æ‹¬Nä¸ªæ•´æ•°ï¼Œç¬¬Iä¸ªæ•°ä»£è¡¨ç¬¬Iä¸ªæ°”çƒæ€»å…±è¢«æ¶‚è‰²çš„æ¬¡æ•°ã€‚

???+note "è§£é¢˜æ€è·¯"
    è¿™ä¸ªä¾‹é¢˜æ˜¯ç®€å•å·®åˆ†æ³•çš„ç›´æ¥åº”ç”¨ï¼Œä¸‹é¢ç»™å‡ºä»£ç ã€‚ä»£ç ç¬¬13ã€14è¡Œæ˜¯åŒºé—´ä¿®æ”¹ï¼Œç¬¬17è¡Œçš„a\[i\]=a\[iâˆ’1\]+D\[i\]ï¼Œå³åˆ©ç”¨D\[\]æ±‚å¾—äº†æœ€åçš„a\[\]ã€‚è¿™ä¸ªå¼å­å°±æ˜¯a\[i\]âˆ’a\[iâˆ’1\]=D\[i\]ï¼Œå®ƒæ˜¯å·®åˆ†æ•°ç»„çš„å®šä¹‰ã€‚
    
    æ³¨æ„a\[\]çš„è®¡ç®—æ–¹æ³•ã€‚a\[i\]=a\[iâˆ’1\]+D\[i\]æ˜¯ä¸€ä¸ªé€’æ¨å…¬å¼ï¼Œé€šè¿‡å®ƒèƒ½åœ¨ä¸€ä¸ªiå¾ªç¯ä¸­æ±‚å¾—æ‰€æœ‰çš„a\[\]ã€‚å¦‚æœä¸ç”¨é€’æ¨ï¼Œè€Œæ˜¯ç›´æ¥ç”¨å‰ç¼€å’Œa\[k\]=D\[1\]+D\[2\]+...+D\[k\] æ¥æ±‚æ‰€æœ‰çš„a\[\]ï¼Œå°±éœ€è¦ç”¨ä¸¤ä¸ªå¾ªç¯iã€kã€‚

???+note "å‚è€ƒä»£ç "

    ```cpp
    #include<bits/stdc++.h>
    using namespace std;
    const int Maxn = 100010;
    int a[Maxn],D[Maxn];               //aæ˜¯æ°”çƒï¼ŒDæ˜¯å·®åˆ†æ•°ç»„
    int main(){
        int n;
        while(~scanf("%d",&n)) { 
            memset(a,0,sizeof(a)); memset(D,0,sizeof(D));
            for(int i=1;i<=n;i++){
                int L,R; scanf("%d%d",&L,&R);
                D[L]++;                 //åŒºé—´ä¿®æ”¹ï¼Œè¿™é‡Œd=1
                D[R+1]--;
            }
    //å°æŠ€å·§ï¼š17è¡Œåˆ°20è¡Œï¼ŒæŠŠa[]æ”¹æˆD[]ä¹Ÿè¡Œ
            for(int i=1;i<=n;i++){              //æ±‚åŸæ•°ç»„
                a[i] = a[i-1] + D[i];           //å·®åˆ†ã€‚æ±‚å‰ç¼€å’Œa[]ï¼Œa[i]å°±æ˜¯æ°”çƒiçš„å€¼
                if(i!=n)  printf("%d ", a[i]);  //é€ä¸ªæ‰“å°ç»“æœ
                else      printf("%d\n",a[i]);
            }        
        }
        return 0;
    }
    ```

    ä¸Šé¢çš„ä»£ç ç”¨äº†ä¸€ä¸ªå°æŠ€å·§ï¼Œå¯ä»¥çœæ‰ğ‘\[\]ï¼Œä»è€ŒèŠ‚çœç©ºé—´ã€‚åœ¨17è¡Œåæ±‚åŸæ•°ç»„ğ‘\[\]çš„æ—¶å€™ï¼Œåœ¨æ¨å¯¼å¼å­ğ‘\[ğ‘–\]=ğ‘\[ğ‘–âˆ’1\]+ğ·\[ğ‘–\]æ—¶ï¼ŒæŠŠå·²ç»ä½¿ç”¨è¿‡çš„è¾ƒå°çš„ğ·\[\]ç›´æ¥å½“æˆğ‘\[\]å³å¯ã€‚æŠŠç¬¬17~20è¡Œçš„ğ‘\[\]æ”¹ä¸ºğ·\[\]ï¼Œä¹Ÿèƒ½é€šè¿‡ã€‚è¿™ä¸ªæŠ€å·§åœ¨åé¢çš„äºŒç»´å·®åˆ†ã€ä¸‰ç»´å·®åˆ†ä¸­ä¹Ÿèƒ½ç”¨ï¼ŒèŠ‚çœä¸€å€çš„ç©ºé—´ã€‚

è¯»è€…å·²ç»æ³¨æ„åˆ°ï¼Œåˆ©ç”¨å·®åˆ†æ•°ç»„ğ·\[\]å¯ä»¥æŠŠğ‘‚(ğ‘›)çš„åŒºé—´ä¿®æ”¹ï¼Œå˜æˆğ‘‚(1)çš„ç«¯ç‚¹ä¿®æ”¹ï¼Œä»è€Œæé«˜äº†ä¿®æ”¹æ“ä½œçš„æ•ˆç‡ã€‚

ä½†æ˜¯ï¼Œä¸€æ¬¡æŸ¥è¯¢æ“ä½œï¼Œå³æŸ¥è¯¢æŸä¸ªğ‘\[ğ‘–\]ï¼Œéœ€è¦ç”¨ğ·\[\]è®¡ç®—æ•´ä¸ªåŸæ•°ç»„ğ‘\[\]ï¼Œè®¡ç®—é‡æ˜¯ğ‘‚(ğ‘›)çš„ï¼Œå³ä¸€æ¬¡æŸ¥è¯¢çš„å¤æ‚åº¦æ˜¯ğ‘‚(ğ‘›)çš„ã€‚åœ¨ä¸Šé¢çš„ä¾‹é¢˜ä¸­ï¼Œå¦‚æœæŸ¥è¯¢ä¸æ˜¯å‘ç”Ÿäº†ä¸€æ¬¡ï¼Œè€Œæ˜¯è¿™æ ·ï¼šæœ‰mæ¬¡ä¿®æ”¹ï¼Œæœ‰kæ¬¡æŸ¥è¯¢ï¼Œä¸”ä¿®æ”¹å’ŒæŸ¥è¯¢çš„é¡ºåºæ˜¯éšæœºçš„ã€‚æ­¤æ—¶æ€»å¤æ‚åº¦æ˜¯ï¼šmæ¬¡ä¿®æ”¹å¤æ‚åº¦ğ‘‚(ğ‘š)ï¼Œkæ¬¡æŸ¥è¯¢å¤æ‚åº¦ğ‘‚(ğ‘˜ğ‘›)ï¼Œæ€»å¤æ‚åº¦ğ‘‚(ğ‘š+ğ‘˜ğ‘›)ã€‚è¿˜ä¸å¦‚ç›´æ¥ç”¨æš´åŠ›æ³•ï¼Œæ€»å¤æ‚åº¦ğ‘‚(ğ‘šğ‘›+ğ‘˜)ã€‚

è¿™ç§é¢˜å‹æ˜¯â€œåŒºé—´ä¿®æ”¹+å•ç‚¹æŸ¥è¯¢â€ï¼Œç”¨å·®åˆ†æ•°ç»„å¾€å¾€ä¸å¤Ÿç”¨ã€‚å› ä¸ºå·®åˆ†æ•°ç»„å¯¹â€œåŒºé—´ä¿®æ”¹â€å¾ˆé«˜æ•ˆï¼Œä½†æ˜¯å¯¹â€œå•ç‚¹æŸ¥è¯¢â€å¹¶ä¸é«˜æ•ˆã€‚æ­¤æ—¶éœ€è¦ç”¨æ ‘çŠ¶æ•°ç»„å’Œçº¿æ®µæ ‘æ¥æ±‚è§£ï¼Œåœ¨æ ‘çŠ¶æ•°ç»„ä¸“é¢˜ä¸­ï¼Œé‡æ–°è®²è§£äº†hdu 1556è¿™é“ä¾‹é¢˜ã€‚

æ ‘çŠ¶æ•°ç»„å¸¸å¸¸ç»“åˆå·®åˆ†æ•°ç»„æ¥è§£å†³æ›´å¤æ‚çš„é—®é¢˜ï¼Œå·®åˆ†æ•°ç»„ä¹Ÿå¸¸ç”¨äºâ€œæ ‘ä¸Šå·®åˆ†â€ï¼Œ

### äºŒç»´å·®åˆ†

ä»ä¸€ç»´å·®åˆ†å®¹æ˜“æ‰©å±•åˆ°äºŒç»´å·®åˆ†ã€‚ä¸€ç»´æ˜¯çº¿æ€§æ•°ç»„ï¼Œä¸€ä¸ªåŒºé—´\[L,R\]æœ‰ä¸¤ä¸ªç«¯ç‚¹ï¼›äºŒç»´æ˜¯çŸ©é˜µï¼Œä¸€ä¸ªåŒºé—´ç”±å››ä¸ªç«¯ç‚¹å›´æˆã€‚

???+note "[åœ°æ¯¯](https://www.luogu.com.cn/problem/P3397)"
    **é—®é¢˜æè¿°ï¼š** åœ¨ nÃ—n çš„æ ¼å­ä¸Šæœ‰mä¸ªåœ°æ¯¯ã€‚ç»™å‡ºè¿™äº›åœ°æ¯¯çš„ä¿¡æ¯ï¼Œé—®æ¯ä¸ªç‚¹è¢«å¤šå°‘ä¸ªåœ°æ¯¯è¦†ç›–ã€‚
    
    **è¾“å…¥ï¼š** ç¬¬ä¸€è¡Œæ˜¯ä¸¤ä¸ªæ­£æ•´æ•°nï¼Œmã€‚æ¥ä¸‹æ¥mè¡Œï¼Œæ¯è¡Œ2ä¸ªåæ ‡(x1, y1)å’Œ(x2, y2)ï¼Œä»£è¡¨ä¸€å—åœ°æ¯¯ï¼Œå·¦ä¸Šè§’æ˜¯(x1, y1)ï¼Œå³ä¸‹è§’æ˜¯(x2, y2)ã€‚
    
    **è¾“å‡ºï¼š** è¾“å‡ºnè¡Œï¼Œæ¯è¡Œnä¸ªæ­£æ•´æ•°ã€‚ç¬¬iè¡Œç¬¬jåˆ—çš„æ­£æ•´æ•°è¡¨ç¤º(i, j)è¿™ä¸ªæ ¼å¼è¢«å¤šå°‘åœ°æ¯¯è¦†ç›–ã€‚

???+note "è§£é¢˜æ€è·¯"
    è¿™ä¸€é¢˜æ˜¯hdu 1556çš„äºŒç»´æ‰©å±•ï¼Œå…¶ä¿®æ”¹æ“ä½œå’ŒæŸ¥è¯¢æ“ä½œå®Œå…¨ä¸€æ ·ã€‚
    
    å­˜å‚¨çŸ©é˜µéœ€è¦å¾ˆå¤§çš„ç©ºé—´ã€‚å¦‚æœé¢˜ç›®æœ‰ç©ºé—´é™åˆ¶ï¼Œä¾‹å¦‚100Mï¼Œé‚£ä¹ˆäºŒç»´å·®åˆ†èƒ½å¤„ç†å¤šå¤§çš„nï¼Ÿå®šä¹‰ä¸¤ä¸ªäºŒç»´çŸ©é˜µğ‘\[\]\[\]å’Œğ·\[\]\[\]ï¼Œè®¾çŸ©é˜µçš„æ¯ä¸ªå…ƒç´ æ˜¯2å­—èŠ‚çš„ğ‘–ğ‘›ğ‘¡å‹ï¼Œå¯ä»¥è®¡ç®—å‡ºæœ€å¤§çš„n = 5000ã€‚ä¸è¿‡ï¼Œä¹Ÿå¯ä»¥ä¸å®šä¹‰ğ‘\[\]\[\]ï¼Œè€Œæ˜¯åƒä¸€ç»´æƒ…å†µä¸‹ä¸€æ ·ï¼Œç›´æ¥ç”¨ğ·\[\]\[\]æ¥è¡¨ç¤ºğ‘\[\]\[\]ï¼Œè¿™æ ·èƒ½å‰©ä¸‹ä¸€åŠçš„ç©ºé—´ã€‚
    
    åœ¨ç”¨å·®åˆ†ä¹‹å‰ï¼Œå…ˆè€ƒè™‘èƒ½ä¸èƒ½ç”¨æš´åŠ›æ³•ã€‚æ¯æ¬¡ä¿®æ”¹å¤æ‚åº¦æ˜¯ğ‘‚(ğ‘›^2 )ï¼Œå…±mæ¬¡ï¼Œæ€»å¤æ‚åº¦ğ‘‚(ğ‘šÃ—ğ‘›^2 )ï¼Œè¶…æ—¶ã€‚
    
    äºŒç»´å·®åˆ†çš„å¤æ‚åº¦æ˜¯å¤šå°‘ï¼Ÿä¸€ç»´å·®åˆ†çš„ä¸€æ¬¡ä¿®æ”¹æ˜¯ğ‘‚(1)çš„ï¼ŒäºŒç»´å·®åˆ†çš„ä¿®æ”¹ä¼°è®¡ä¹Ÿæ˜¯ğ‘‚(1)çš„ï¼›ä¸€ç»´å·®åˆ†çš„ä¸€æ¬¡æŸ¥è¯¢æ˜¯ğ‘‚(ğ‘›)çš„ï¼ŒäºŒç»´å·®åˆ†æ˜¯ğ‘‚(ğ‘›^2 ))çš„ï¼Œæ‰€ä»¥äºŒç»´å·®åˆ†çš„æ€»å¤æ‚åº¦æ˜¯ğ‘‚(ğ‘š+ğ‘›^2 )ã€‚ç”±äºè®¡ç®—ä¸€æ¬¡äºŒç»´çŸ©é˜µçš„å€¼éœ€è¦ğ‘‚(ğ‘›^2 )æ¬¡è®¡ç®—ï¼Œæ‰€ä»¥äºŒç»´å·®åˆ†å·²ç»è¾¾åˆ°äº†æœ€å¥½çš„å¤æ‚åº¦ã€‚
    
    ä¸‹é¢ä»ä¸€ç»´å·®åˆ†æ¨å¹¿åˆ°äºŒç»´å·®åˆ†ã€‚
    
    ï¼ˆ1ï¼‰å‰ç¼€å’Œã€‚
    
    åœ¨ä¸€ç»´å·®åˆ†ä¸­ï¼ŒåŸæ•°ç»„ğ‘\[\]æ˜¯ä»ç¬¬1ä¸ªğ·\[1\]å¼€å§‹çš„å·®åˆ†æ•°ç»„ğ·\[\]çš„å‰ç¼€å’Œï¼šğ‘\[ğ‘˜\]=ğ·\[1\]+ğ·\[2\]+...+ğ·\[ğ‘˜\]ã€‚
    
    åœ¨äºŒç»´å·®åˆ†ä¸­ï¼Œğ‘\[\]\[\]æ˜¯å·®åˆ†æ•°ç»„ğ·\[\]\[\]çš„å‰ç¼€å’Œï¼Œå³ç”±åŸç‚¹åæ ‡(1,1)å’Œåæ ‡(i,j)å›´æˆçš„çŸ©é˜µä¸­ï¼Œæ‰€æœ‰çš„ğ·\[\]\[\]ç›¸åŠ ç­‰äºğ‘\[ğ‘–\]\[ğ‘—\]ã€‚ä¸ºåŠ æ·±å¯¹å‰ç¼€å’Œçš„ç†è§£ï¼Œå¯ä»¥æŠŠæ¯ä¸ªğ·\[\]\[\]çœ‹æˆä¸€ä¸ªå°æ ¼ï¼›åœ¨åæ ‡(1,1)å’Œ(ğ‘–,ğ‘—)æ‰€å›´æˆçš„èŒƒå›´å†…ï¼Œæ‰€æœ‰å°æ ¼å­åŠ èµ·æ¥çš„æ€»é¢ç§¯ï¼Œç­‰äºğ‘\[ğ‘–\]\[ğ‘—\]ã€‚ä¸‹é¢çš„å›¾ä¸­ï¼Œæ¯ä¸ªæ ¼å­çš„é¢ç§¯æ˜¯ä¸€ä¸ªğ·\[\]\[\]ï¼Œä¾‹å¦‚é˜´å½±æ ¼å­æ˜¯ğ·\[ğ‘–\]\[ğ‘—\]ï¼Œå®ƒç”±4ä¸ªåæ ‡ç‚¹å®šä¹‰ï¼š(ğ‘–âˆ’1,ğ‘—)ã€(ğ‘–,ğ‘—)ã€(ğ‘–âˆ’1,ğ‘—âˆ’1)ã€(ğ‘–,ğ‘—âˆ’1)ã€‚åæ ‡ç‚¹(i,j)çš„å€¼æ˜¯ğ‘\[ğ‘–\]\[ğ‘—\]ï¼Œå®ƒç­‰äºåæ ‡(1,1)å’Œ(ğ‘–,ğ‘—)æ‰€å›´æˆçš„æ‰€æœ‰æ ¼å­çš„æ€»é¢ç§¯ã€‚å›¾ä¸­æ•…æ„æŠŠå°æ ¼å­ç”»å¾—é•¿å®½ä¸åŒï¼Œæ˜¯ä¸ºäº†ä½“ç°å®ƒä»¬çš„é¢ç§¯ä¸åŒã€‚

    ![](./images/prefix-2.png)

    æŠŠæ¯ä¸ªa\[\]\[\]çœ‹æˆæ€»é¢ç§¯ï¼ŒæŠŠæ¯ä¸ªD\[\]\[\]çœ‹æˆå°æ ¼å­çš„é¢ç§¯ 

    æ³¨æ„åœ¨ä¸€äº›é¢˜ç›®ä¸­ï¼Œğ·\[\]\[\]å¯ä»¥ä¸ºè´Ÿã€‚å›¾ä¸­æŠŠğ·\[\]\[\]ç”¨â€œé¢ç§¯â€æ¥æ¼”ç¤ºï¼Œè€Œé¢ç§¯éƒ½æ˜¯æ­£çš„ï¼Œè¿™ä¸ªå›¾ç¤ºåªæ˜¯ä¸ºäº†åŠ æ·±å¯¹å‰ç¼€å’Œçš„ç†è§£ã€‚
    
    ï¼ˆ2ï¼‰å·®åˆ†çš„å®šä¹‰ã€‚åœ¨ä¸€ç»´æƒ…å†µä¸‹ï¼Œğ·\[ğ‘–\]=ğ‘\[ğ‘–\]âˆ’ğ‘\[ğ‘–âˆ’1\]ã€‚åœ¨äºŒç»´æƒ…å†µä¸‹ï¼Œå·®åˆ†å˜æˆäº†ç›¸é‚»çš„ğ‘\[\]\[\]çš„â€œé¢ç§¯å·®â€ï¼Œè®¡ç®—å…¬å¼æ˜¯ï¼šğ·\[ğ‘–\]\[ğ‘—\]=ğ‘\[ğ‘–\]\[ğ‘—\]â€“ğ‘\[ğ‘–âˆ’1\]\[ğ‘—\]â€“ğ‘\[ğ‘–\]\[ğ‘—âˆ’1\]+ğ‘\[ğ‘–âˆ’1\]\[ğ‘—âˆ’1\]ã€‚è¿™ä¸ªå…¬å¼å¯ä»¥é€šè¿‡ä¸Šé¢çš„å›¾æ¥è§‚å¯Ÿã€‚é˜´å½±æ–¹æ ¼è¡¨ç¤ºğ·\[ğ‘–\]\[ğ‘—\]çš„å€¼ï¼Œå®ƒçš„é¢ç§¯è¿™æ ·æ±‚ï¼šå¤§é¢ç§¯ğ‘\[ğ‘–\]\[ğ‘—\]å‡å»ä¸¤ä¸ªå°é¢ç§¯ğ‘\[ğ‘–âˆ’1\]\[ğ‘—\]ã€ğ‘\[ğ‘–\]\[ğ‘—âˆ’1\]ï¼Œç”±äºä¸¤ä¸ªå°é¢ç§¯çš„å…¬å…±é¢ç§¯ğ‘\[ğ‘–âˆ’1\]\[ğ‘—âˆ’1\]è¢«å‡äº†2æ¬¡ï¼Œæ‰€ä»¥éœ€è¦åŠ å›æ¥1æ¬¡ã€‚
    
    ï¼ˆ3ï¼‰åŒºé—´ä¿®æ”¹ã€‚åœ¨ä¸€ç»´æƒ…å†µä¸‹ï¼ŒåšåŒºé—´ä¿®æ”¹åªéœ€è¦ä¿®æ”¹åŒºé—´çš„ä¸¤ä¸ªç«¯ç‚¹çš„ğ·\[\]å€¼ã€‚åœ¨äºŒç»´æƒ…å†µä¸‹ï¼Œä¸€ä¸ªåŒºé—´æ˜¯ä¸€ä¸ªå°çŸ©é˜µï¼Œæœ‰4ä¸ªç«¯ç‚¹ï¼Œåªéœ€è¦ä¿®æ”¹è¿™4ä¸ªç«¯ç‚¹çš„ğ·\[\]\[\]å€¼ã€‚ä¾‹å¦‚åæ ‡ç‚¹(ğ‘¥1,ğ‘¦1) ~ (ğ‘¥2,ğ‘¦2)å®šä¹‰çš„åŒºé—´ï¼Œå¯¹åº”4ä¸ªç«¯ç‚¹çš„ğ·\[\]\[\]ï¼š

    ```cpp
    D[x1][y1]     += d;     //äºŒç»´åŒºé—´çš„èµ·ç‚¹
    D[x1][y2+1]   -= d;     //æŠŠxçœ‹æˆå¸¸æ•°ï¼Œyä»y1åˆ°y2+1
    D[x2+1][y1]   -= d;     //æŠŠyçœ‹æˆå¸¸æ•°ï¼Œxä»x1åˆ°x2+1
    D[x2+1][y2+1] += d;     //ç”±äºå‰ä¸¤å¼æŠŠdå‡äº†2æ¬¡ï¼Œå¤šå‡äº†1æ¬¡ï¼Œè¿™é‡ŒåŠ 1æ¬¡å›æ¥
    ```
    
    ä¸‹å›¾æ˜¯åŒºé—´ä¿®æ”¹çš„å›¾ç¤ºã€‚2ä¸ªé»‘è‰²ç‚¹å›´æˆçš„çŸ©å½¢æ˜¯é¢˜ç›®ç»™å‡ºçš„åŒºé—´ä¿®æ”¹èŒƒå›´ã€‚åªéœ€è¦æ”¹å˜4ä¸ªğ·\[\]\[\]å€¼ï¼Œå³æ”¹å˜å›¾ä¸­çš„4ä¸ªé˜´å½±å—çš„é¢ç§¯ã€‚è¯»è€…å¯ä»¥ç”¨è¿™ä¸ªå›¾ï¼Œè§‚å¯Ÿæ¯ä¸ªåæ ‡ç‚¹çš„ğ‘\[\]\[\]å€¼çš„å˜åŒ–æƒ…å†µã€‚ä¾‹å¦‚ç¬¦å·â€œâˆ†â€æ ‡è®°çš„åæ ‡(ğ‘¥2+1,ğ‘¦2)ï¼Œå®ƒåœ¨ä¿®æ”¹çš„åŒºé—´ä¹‹å¤–ï¼›ğ‘\[ğ‘¥2+1\]\[ğ‘¦2\]çš„å€¼æ˜¯ä»(1,1)åˆ°(ğ‘¥2+1,ğ‘¦2)çš„æ€»é¢ç§¯ï¼Œåœ¨è¿™ä¸ªèŒƒå›´å†…ï¼Œğ·\[ğ‘¥1\]\[ğ‘¦1\]+ğ‘‘ï¼Œğ·\[ğ‘¥2+1\]\[ğ‘¦1\]âˆ’ğ‘‘ï¼Œä¸¤ä¸ªğ‘‘æŠµæ¶ˆï¼Œğ‘\[ğ‘¥2+1\]\[ğ‘¦2\]ä¿æŒä¸å˜ã€‚

    ![](./images/prefix-3.png)
    
    äºŒç»´å·®åˆ†çš„åŒºé—´ä¿®æ”¹ 

???+note "å‚è€ƒä»£ç "
    ä¸‹é¢ç»™å‡ºæ´›è°·P3397çš„ä¸¤ç§å®ç°ã€‚
    
    1ï¼‰ç”¨å·®åˆ†æ•°ç»„çš„é€’æ¨å…¬å¼æ±‚å‰ç¼€å’Œ
    
    å‰ç¼€å’Œğ‘\[\]\[\]çš„è®¡ç®—ç”¨åˆ°äº†é€’æ¨å…¬å¼ï¼š
    
    ğ‘\[ğ‘–\]\[ğ‘—\]=ğ·\[ğ‘–\]\[ğ‘—\]+ğ‘\[ğ‘–âˆ’1\]\[ğ‘—\]+ğ‘\[ğ‘–\]\[ğ‘—âˆ’1\]âˆ’ğ‘\[ğ‘–âˆ’1\]\[ğ‘—âˆ’1\];
    
    16è¡Œåˆ°23è¡Œç”¨ğ·\[\]\[\]æ¨å‡ºğ‘\[\]\[\]å¹¶æ‰“å°å‡ºæ¥ã€‚
    
    ä¸ºäº†èŠ‚çº¦ç©ºé—´ï¼Œå¯ä»¥ä¸å®šä¹‰ğ‘\[\]\[\]ï¼Œè€Œæ˜¯æŠŠç”¨è¿‡çš„ğ·\[\]\[\]çœ‹æˆğ‘\[\]\[\]ã€‚è¿™ä¸ªå°æŠ€å·§åœ¨ä¸€ç»´å·®åˆ†ä¸­ä»‹ç»è¿‡ã€‚

    ```cpp
    #include<bits/stdc++.h>
    using namespace std;
    int D[5000][5000];     //å·®åˆ†æ•°ç»„
    //int a[5000][5000];   //åŸæ•°ç»„ï¼Œä¸å®šä¹‰ä¹Ÿè¡Œ
    int main(){
        int n,m;
        scanf("%d%d",&n,&m);
        while(m--){
            int x1,y1,x2,y2;
            scanf("%d%d%d%d",&x1,&y1,&x2,&y2);
            D[x1][y1]     += 1;        //è®¡ç®—å·®åˆ†æ•°ç»„
            D[x2+1][y1]   -= 1;
            D[x1][y2+1]   -= 1;
            D[x2+1][y2+1] += 1;
        }
        for(int i=1;i<=n;++i){   //æ ¹æ®å·®åˆ†æ•°ç»„è®¡ç®—åŸçŸ©é˜µçš„å€¼ï¼ˆæƒ³è±¡æˆæ±‚å°æ ¼å­çš„é¢ç§¯å’Œï¼‰
            for(int j=1;j<=n;++j){      //æŠŠç”¨è¿‡çš„D[][]çœ‹æˆa[][]ï¼Œå°±ä¸ç”¨å†å®šä¹‰a[][]äº†
                //a[i][j] = D[i][j] + a[i-1][j] + a[i][j-1] - a[i-1][j-1];
                //printf("%d ",a[i][j]);  //è¿™ä¸¤è¡Œå’Œä¸‹é¢ä¸¤è¡Œçš„æ•ˆæœä¸€æ ·
                D[i][j] += D[i-1][j]+D[i][j-1]-D[i-1][j-1];
                printf("%d ",D[i][j]);
            }
            printf("\n");//æ¢è¡Œ
        }
        return 0;
    }
    ```

    2)ç›´æ¥è®¡ç®—å‰ç¼€å’Œ
    
    å…¶å®ä¸ç”¨é€’æ¨å…¬å¼ï¼Œè€Œæ˜¯ç›´æ¥æ±‚å‰ç¼€å’Œä¹Ÿè¡Œã€‚æ ¹æ®å›¾2ï¼Œå‰ç¼€å’Œæ˜¯æ€»é¢ç§¯ï¼Œåˆ†åˆ«ä»xæ–¹å‘å’Œyæ–¹å‘ï¼Œç”¨ä¸¤æ¬¡å¾ªç¯è®¡ç®—ï¼Œå¹¶ç›´æ¥ç”¨D\[\]\[\]è®°å½•ç»“æœï¼Œæœ€åç®—å‡ºçš„D\[\]\[\]å°±æ˜¯a\[\]\[\]ã€‚

    ![](./images/prefix-4.png)

    åœ¨D\[\]\[\]ä¸Šè®¡ç®—å‰ç¼€å’Œ 
    
    ä»¥é˜´å½±å¤„çš„ğ·\[2\]\[2\]ä¸ºä¾‹ï¼Œå®ƒæœ€åçš„å€¼ä»£è¡¨ğ‘\[2\]\[2\]ï¼Œæ˜¯4ä¸ªå°æ ¼å­çš„æ€»é¢ç§¯ï¼š
    
    ğ·\[1\]\[1\]+ğ·\[1\]\[2\]+ğ·\[2\]\[1\]+ğ·\[2\]\[2\]
    
    è®¡ç®—è¿‡ç¨‹æ˜¯ï¼š
    
    ï¼ˆ1ï¼‰å…ˆç´¯åŠ è®¡ç®—ğ‘¦æ–¹å‘ï¼Œå¾—ï¼š
    
    ğ·\[1\]\[2\]=ğ·\[1\]\[1\]+ğ·\[1\]\[2\]ã€ğ·\[2\]\[2\]=ğ·\[2\]\[1\]+ğ·\[2\]\[2\]
    
    ï¼ˆ2ï¼‰å†ç´¯åŠ è®¡ç®—ğ‘¥æ–¹å‘ï¼Œå¾—ï¼š
    
    ğ·\[2\]\[1\]=ğ·\[1\]\[1\]+ğ·\[2\]\[1\]ã€ğ·\[2\]\[2\]=ğ·\[1\]\[2\]+ğ·\[2\]\[2\]=ğ·\[1\]\[1\]+ğ·\[1\]\[2\]+ğ·\[2\]\[1\]+ğ·\[2\]\[2\]
    
    å®é™…ä¸Šï¼Œåœ¨è¿™ä¸ªè®¡ç®—è¿‡ç¨‹ä¸­ï¼Œğ·\[1\]\[1\]ã€ğ·\[1\]\[2\]ã€ğ·\[2\]\[1\]ã€ğ·\[2\]\[2\]éƒ½æ›´æ–°äº†ï¼Œè®¡ç®—ç»“æœä»£è¡¨äº†ğ‘\[1\]\[1\]ã€ğ‘\[1\]\[2\]ã€ğ‘\[2\]\[1\]ã€ğ‘\[2\]\[2\]ã€‚
    
    æŠŠæ–¹æ³•1ä»£ç çš„16-24è¡Œæ›¿æ¢ä¸ºä¸‹é¢çš„ä»£ç ï¼Œæœ€åå¾—åˆ°çš„ğ·\[\]\[\]å°±æ˜¯æ‰€æœ‰çš„å‰ç¼€å’Œï¼Œå³æœ€æ–°çš„ğ‘\[\]\[\]ã€‚è¯·å¯¹ç…§å›¾2ç†è§£ä»£ç ã€‚

    ```cpp
    for(int i=1; i<=n; ++i)           
        for(int j=1; j<n; ++j)        //æ³¨æ„è¿™é‡Œæ˜¯j<n
            D[i][j+1] += D[i][j];     //æŠŠiçœ‹æˆå®šå€¼ï¼Œå…ˆç´¯åŠ è®¡ç®—jæ–¹å‘
    for(int j=1; j<=n; ++j)
        for(int i=1; i<n; ++i)        //æ³¨æ„è¿™é‡Œæ˜¯i<n
            D[i+1][j] += D[i][j];     //æŠŠjçœ‹æˆå®šå€¼ï¼Œå†ç´¯åŠ è®¡ç®—iæ–¹å‘
    for(int i=1; i<=n; ++i) {         //æ‰“å°
        for(int j=1; j<=n; ++j)
             printf("%d ",D[i][j]);
        printf("\n");                 //æ¢è¡Œ
    }
    ```

    å¯¹æ¯”è¿™ä¸¤ç§ä»£ç ï¼š
    
    1. è¿™ä¸¤ç§ä»£ç çš„å¤æ‚åº¦æ˜¯ä¸€æ ·çš„ã€‚ä»è®¡ç®—é‡ä¸Šçœ‹ï¼Œæ²¡æœ‰ä¼˜åŠ£ä¹‹åˆ†ã€‚
    2. ä»£ç 2ä¸å¦‚ä»£ç 1æ¸…æ™°ç®€æ´ï¼Œæ‰€ä»¥ä»£ç 2è¿™ç§å†™æ³•ä¸€èˆ¬ä¹Ÿç”¨ä¸ç€ã€‚
    3. ä»£ç 2ä¹Ÿæœ‰ä¼˜ç‚¹ï¼Œå®ƒä¸éœ€è¦ç”¨åˆ°é€’æ¨å…¬å¼ï¼Œè€Œæ˜¯ç›´æ¥æ±‚å‰ç¼€å’Œã€‚
    
    è¿™é‡Œç»™å‡ºä»£ç 2è¿™ç§æ–¹æ³•ï¼Œæ˜¯ä¸ºäº†åœ¨ä¸‹ä¸€å°èŠ‚çš„ä¸‰ç»´å·®åˆ†ä¸­ä½¿ç”¨å®ƒã€‚ç”±äºåœ¨ä¸‰ç»´æƒ…å†µä¸‹ï¼Œå·®åˆ†æ•°ç»„çš„ğ·\[\]\[\]\[\]å’ŒåŸæ•°ç»„ğ‘\[\]\[\]\[\]çš„é€’æ¨å…¬å¼å¾ˆéš¾å†™å‡ºæ¥ï¼Œæ‰€ä»¥ç”¨ä»£ç 2è¿™ç§æ–¹æ³•æ›´å®¹æ˜“ç¼–ç ã€‚
    
### ä¸‰ç»´å·®åˆ†

ä¸‰ç»´å·®åˆ†çš„æ¨¡æ¿ä»£ç æ¯”è¾ƒå°‘è§ã€‚

ä¸‰ç»´å·®åˆ†æ¯”è¾ƒå¤æ‚ï¼Œè¯·ç»“åˆæœ¬èŠ‚ä¸­çš„å‡ ä½•å›¾è¿›è¡Œç†è§£ã€‚

ä¸ä¸€ç»´å·®åˆ†ã€äºŒç»´å·®åˆ†çš„æ€è·¯ç±»ä¼¼ï¼Œä¸‹é¢ç»™å‡ºä¸‰ç»´å·®åˆ†çš„æœ‰å…³ç‰¹æ€§ã€‚

ï¼ˆ1ï¼‰å…ƒç´ çš„å€¼ç”¨ä¸‰ç»´æ•°ç»„ğ‘\[\]\[\]\[\]æ¥å®šä¹‰ï¼Œå·®åˆ†æ•°ç»„ğ·\[\]\[\]\[\]ä¹Ÿæ˜¯ä¸‰ç»´çš„ã€‚æŠŠä¸‰ç»´å·®åˆ†æƒ³è±¡æˆåœ¨ç«‹ä½“ç©ºé—´ä¸Šçš„æ“ä½œã€‚ä¸€ç»´çš„åŒºé—´æ˜¯ä¸€ä¸ªçº¿æ®µï¼ŒäºŒç»´æ˜¯çŸ©å½¢ï¼Œé‚£ä¹ˆä¸‰ç»´å°±æ˜¯ç«‹ä½“å—ã€‚ä¸€ä¸ªå°ç«‹ä½“å—æœ‰8ä¸ªé¡¶ç‚¹ï¼Œæ‰€ä»¥ä¸‰ç»´çš„åŒºé—´ä¿®æ”¹ï¼Œéœ€è¦ä¿®æ”¹8ä¸ªğ·\[\]\[\]\[\]å€¼ã€‚

ï¼ˆ2ï¼‰å‰ç¼€å’Œã€‚

åœ¨äºŒç»´å·®åˆ†ä¸­ï¼Œğ‘\[\]\[\]æ˜¯å·®åˆ†æ•°ç»„ğ·\[\]\[\]çš„å‰ç¼€å’Œï¼Œå³ç”±åŸç‚¹åæ ‡(1,1)å’Œåæ ‡(i,j)å›´æˆçš„çŸ©é˜µä¸­ï¼Œæ‰€æœ‰çš„ğ·\[\]\[\]ï¼ˆçœ‹æˆå°æ ¼å­ï¼‰ç›¸åŠ ç­‰äºğ‘\[ğ‘–\]\[ğ‘—\]ï¼ˆçœ‹æˆæ€»é¢ç§¯ï¼‰ã€‚

åœ¨ä¸‰ç»´å·®åˆ†ä¸­ï¼Œğ‘\[\]\[\]\[\]æ˜¯å·®åˆ†æ•°ç»„ğ·\[\]\[\]\[\]çš„å‰ç¼€å’Œã€‚å³ç”±åŸç‚¹åæ ‡(1,1,1)å’Œåæ ‡(ğ‘–,ğ‘—,ğ‘˜)æ‰€æ ‡è®°çš„èŒƒå›´ä¸­ï¼Œæ‰€æœ‰çš„ğ·\[\]\[\]\[\]ç›¸åŠ ç­‰äºğ‘\[ğ‘–\]\[ğ‘—\]\[ğ‘˜\]ã€‚æŠŠæ¯ä¸ªğ·\[\]\[\]\[\]çœ‹æˆä¸€ä¸ªå°ç«‹æ–¹ä½“ï¼›åœ¨åæ ‡(1,1,1)å’Œ(ğ‘–,ğ‘—,ğ‘˜)æ‰€å›´æˆçš„ç©ºé—´ä¸­ï¼Œæ‰€æœ‰å°ç«‹ä½“å—åŠ èµ·æ¥çš„æ€»ä½“ç§¯ï¼Œç­‰äºğ‘\[ğ‘–\]\[ğ‘—\]\[ğ‘˜\]ã€‚æ¯ä¸ªå°ç«‹æ–¹ä½“ç”±8ä¸ªåæ ‡ç‚¹å®šä¹‰ï¼Œè§ä¸‹é¢å›¾ä¸­çš„åæ ‡ç‚¹ã€‚åæ ‡ç‚¹(ğ‘–,ğ‘—,ğ‘˜)çš„å€¼æ˜¯ğ‘\[ğ‘–\]\[ğ‘—\]\[ğ‘˜\]ï¼›ğ·\[ğ‘–\]\[ğ‘—\]\[ğ‘˜\]çš„å€¼æ˜¯å›¾ä¸­å°ç«‹æ–¹ä½“çš„ä½“ç§¯ã€‚

![](./images/prefix-5.png)

ç«‹ä½“çš„åæ ‡ 

ï¼ˆ3ï¼‰å·®åˆ†çš„å®šä¹‰ã€‚åœ¨ä¸‰ç»´æƒ…å†µä¸‹ï¼Œå·®åˆ†å˜æˆäº†ç›¸é‚»çš„ğ‘\[\]\[\]\[\]çš„â€œä½“ç§¯å·®â€ã€‚å¦‚ä½•å†™å‡ºå·®åˆ†çš„é€’æ¨è®¡ç®—å…¬å¼ï¼Ÿ

ä¸€ç»´å·®åˆ†å’ŒäºŒç»´å·®åˆ†çš„é€’æ¨è®¡ç®—å…¬å¼å¾ˆå¥½å†™ã€‚

ä¸‰ç»´å·®åˆ†ï¼Œğ·\[ğ‘–\]\[ğ‘—\]\[ğ‘˜\]çš„å‡ ä½•æ„ä¹‰æ˜¯å›¾ä¸­å°ç«‹æ–¹ä½“çš„ä½“ç§¯ï¼Œå®ƒå¯ä»¥é€šè¿‡è¿™ä¸ªå°ç«‹æ–¹ä½“çš„8ä¸ªé¡¶ç‚¹çš„å€¼æ¨å‡ºæ¥ã€‚æ€è·¯ä¸äºŒç»´æƒ…å†µä¸‹ç±»ä¼¼ï¼ŒäºŒç»´çš„ğ·\[\]\[\]æ˜¯é€šè¿‡å°çŸ©å½¢çš„å››ä¸ªé¡¶ç‚¹çš„ğ‘\[\]\[\]å€¼æ¥è®¡ç®—çš„ã€‚ä¸è¿‡ï¼Œä¸‰ç»´æƒ…å†µä¸‹ï¼Œé€’æ¨è®¡ç®—å…¬å¼å¾ˆéš¾å†™ï¼Œ8ä¸ªé¡¶ç‚¹æœ‰8ä¸ªğ‘\[\]\[\]\[\]ï¼ŒæŠŠè„‘è¢‹ç»•æ™•äº†ä¹Ÿä¸å®¹æ˜“å†™å¯¹ã€‚

ä¸Šä¸€å°èŠ‚çš„äºŒç»´å·®åˆ†ä¸­ï¼Œæ›¾ç”¨è¿‡å¦ä¸€ç§æ–¹æ³•ï¼Œç›´æ¥å¯¹Dæ•°ç»„æ±‚å‰ç¼€å’Œã€‚åœ¨ä¸‰ç»´æƒ…å†µä¸‹ä¹Ÿå¯ä»¥ç”¨è¿™ç§æ–¹æ³•æ±‚å‰ç¼€å’Œï¼Œå¾—åˆ°æ‰€æœ‰çš„ğ‘\[\]\[\]\[\]çš„æœ€æ–°å€¼ã€‚

ï¼ˆ4ï¼‰åŒºé—´ä¿®æ”¹ã€‚åœ¨ä¸‰ç»´æƒ…å†µä¸‹ï¼Œä¸€ä¸ªåŒºé—´æ˜¯ä¸€ä¸ªç«‹æ–¹ä½“ï¼Œæœ‰8ä¸ªé¡¶ç‚¹ï¼Œåªéœ€è¦ä¿®æ”¹è¿™8ä¸ªé¡¶ç‚¹çš„ğ·\[\]\[\]\[\]å€¼ã€‚ä¾‹å¦‚åæ ‡ç‚¹(ğ‘¥1,ğ‘¦1,ğ‘§1) ~(ğ‘¥2,ğ‘¦2,ğ‘§2)å®šä¹‰çš„åŒºé—´ï¼Œå¯¹åº”8ä¸ªğ·\[\]\[\]\[\]ï¼Œè¯·å¯¹ç…§ä¸Šé¢çš„å›¾æ¥æƒ³è±¡å®ƒä»¬çš„ä½ç½®ã€‚

```cpp
D[x1][y1][z1]       += d;   //å‰é¢ï¼šå·¦ä¸‹é¡¶ç‚¹ï¼Œå³åŒºé—´çš„èµ·å§‹ç‚¹
D[x2+1][y1][z1]     -= d;   //å‰é¢ï¼šå³ä¸‹é¡¶ç‚¹çš„å³è¾¹ä¸€ä¸ªç‚¹
D[x1][y1][z2+1]     -= d;   //å‰é¢ï¼šå·¦ä¸Šé¡¶ç‚¹çš„ä¸Šé¢ä¸€ä¸ªç‚¹
D[x2+1][y1][z2+1]   += d;   //å‰é¢ï¼šå³ä¸Šé¡¶ç‚¹çš„æ–œå³ä¸Šæ–¹ä¸€ä¸ªç‚¹
D[x1][y2+1][z1]     -= d;   //åé¢ï¼šå·¦ä¸‹é¡¶ç‚¹çš„åé¢ä¸€ä¸ªç‚¹
D[x2+1][y2+1][z1]   += d;   //åé¢ï¼šå³ä¸‹é¡¶ç‚¹çš„æ–œå³åæ–¹ä¸€ä¸ªç‚¹
D[x1][y2+1][z2+1]   += d;   //åé¢ï¼šå·¦ä¸Šé¡¶ç‚¹çš„æ–œåä¸Šæ–¹ä¸€ä¸ªç‚¹
D[x2+1][y2+1][z2+1] -= d;   //åé¢ï¼šå³ä¸Šé¡¶ç‚¹çš„æ–œå³ä¸Šåæ–¹ä¸€ä¸ªç‚¹ï¼Œå³åŒºé—´ç»ˆç‚¹çš„åä¸€ä¸ªç‚¹
```

ä¸‹é¢ç»™å‡ºä¸€ä¸ªä¸‰ç»´å·®åˆ†çš„ä¾‹é¢˜ã€‚

???+note "[ä¸‰ä½“æ”»å‡»](https://www.lanqiao.cn/problems/180/learning/)"
    **é—®é¢˜æè¿°ï¼š** ä¸‰ä½“äººå°†å¯¹åœ°çƒå‘èµ·æ”»å‡»ã€‚ä¸ºäº†æŠµå¾¡æ”»å‡»ï¼Œåœ°çƒäººæ´¾å‡ºäº†n = A Ã— B Ã— C è‰˜æˆ˜èˆ°ï¼Œåœ¨å¤ªç©ºä¸­æ’æˆä¸€ä¸ª A å±‚ B è¡Œ C åˆ—çš„ç«‹æ–¹ä½“ã€‚å…¶ä¸­ï¼Œç¬¬ i å±‚ç¬¬ j è¡Œç¬¬ k åˆ—çš„æˆ˜èˆ°(è®°ä¸ºæˆ˜èˆ° (i,â€†j,â€†k))çš„ç”Ÿå‘½å€¼ä¸º s(i,â€†j,â€†k)ã€‚
    
    ä¸‰ä½“äººå°†ä¼šå¯¹åœ°çƒå‘èµ· m è½®â€œç«‹æ–¹ä½“æ”»å‡»â€ï¼Œæ¯æ¬¡æ”»å‡»ä¼šå¯¹ä¸€ä¸ªå°ç«‹æ–¹ä½“ä¸­çš„æ‰€æœ‰æˆ˜èˆ°éƒ½é€ æˆç›¸åŒçš„ä¼¤å®³ã€‚å…·ä½“åœ°ï¼Œç¬¬ t è½®æ”»å‡»ç”¨ 7 ä¸ªå‚æ•° x1, x2,â€†y1,â€†y2,â€†z1,â€†z2,â€†d æè¿°ï¼›
    
    æ‰€æœ‰æ»¡è¶³$iâˆˆ[x1,â€†x2], jâˆˆ[y1,â€†y2], kâˆˆ[z1,â€†z2]$ çš„æˆ˜èˆ° (i,â€†j,â€†k) ä¼šå—åˆ° d çš„ä¼¤å®³ã€‚å¦‚æœä¸€ä¸ªæˆ˜èˆ°ç´¯è®¡å—åˆ°çš„æ€»ä¼¤å®³è¶…è¿‡å…¶é˜²å¾¡åŠ›ï¼Œé‚£ä¹ˆè¿™ä¸ªæˆ˜èˆ°ä¼šçˆ†ç‚¸ã€‚
    
    åœ°çƒæŒ‡æŒ¥å®˜å¸Œæœ›ä½ èƒ½å‘Šè¯‰ä»–ï¼Œç¬¬ä¸€è‰˜çˆ†ç‚¸çš„æˆ˜èˆ°æ˜¯åœ¨å“ªä¸€è½®æ”»å‡»åçˆ†ç‚¸çš„ã€‚
    
    **è¾“å…¥ï¼š** ç¬¬ä¸€è¡ŒåŒ…æ‹¬ 4 ä¸ªæ­£æ•´æ•° A,â€†B,â€†C,â€†mï¼›
    
    ç¬¬äºŒè¡ŒåŒ…å« A Ã— B Ã— C ä¸ªæ•´æ•°ï¼Œå…¶ä¸­ç¬¬ ((i âˆ’ 1)Ã—B + (j âˆ’ 1)) Ã— C + (k âˆ’ 1)+1 ä¸ªæ•°ä¸º s(i,â€†j,â€†k)ï¼›
    
    ç¬¬ 3 åˆ°ç¬¬ m + 2 è¡Œä¸­ï¼Œç¬¬ (t âˆ’ 2) è¡ŒåŒ…å« 7 ä¸ªæ­£æ•´æ•° x1, x2,â€†y1,â€†y2,â€†z1,â€†z2,â€†dã€‚
    
    A Ã— B Ã— Câ€„â‰¤â€„10^6 ,â€†mâ€„â‰¤â€„10^6 ,â€†0â€„â‰¤â€„s(i,â€†j,â€†k),â€†dâ€„â‰¤â€„10^9 ã€‚
    
    **è¾“å‡ºï¼š** è¾“å‡ºç¬¬ä¸€ä¸ªçˆ†ç‚¸çš„æˆ˜èˆ°æ˜¯åœ¨å“ªä¸€è½®æ”»å‡»åçˆ†ç‚¸çš„ã€‚ä¿è¯ä¸€å®šå­˜åœ¨è¿™æ ·çš„æˆ˜èˆ°ã€‚

???+note "è§£é¢˜æ€è·¯"
    é¦–å…ˆçœ‹æ•°æ®è§„æ¨¡ï¼Œæœ‰ğ‘›=10^6 ä¸ªç‚¹ï¼Œ ğ‘š=10^6 æ¬¡æ”»å‡»ï¼Œå¦‚æœç”¨æš´åŠ›æ³•ï¼Œç»Ÿè®¡æ¯æ¬¡æ”»å‡»åæ¯ä¸ªç‚¹çš„ç”Ÿå‘½å€¼ï¼Œé‚£ä¹ˆå¤æ‚åº¦æ˜¯ğ‘‚(ğ‘šğ‘›)çš„ï¼Œè¶…æ—¶ã€‚
    
    æœ¬é¢˜é€‚åˆç”¨ä¸‰ç»´å·®åˆ†ï¼Œæ¯æ¬¡æ”»å‡»åªä¿®æ”¹å·®åˆ†æ•°ç»„ğ·\[\]\[\]\[\]ï¼Œä¸€æ¬¡ä¿®æ”¹çš„å¤æ‚åº¦æ˜¯ğ‘‚(1)ï¼Œğ‘šæ¬¡ä¿®æ”¹çš„æ€»å¤æ‚åº¦åªæœ‰ğ‘‚(ğ‘š)ã€‚
    
    ä½†æ˜¯å…‰ç”¨å·®åˆ†æ•°ç»„å¹¶ä¸èƒ½è§£å†³é—®é¢˜ã€‚å› ä¸ºåœ¨å·®åˆ†æ•°ç»„ä¸ŠæŸ¥è¯¢åŒºé—´å†…çš„æ¯ä¸ªå…ƒç´ æ˜¯å¦å°äº0ï¼Œéœ€è¦ç”¨å·®åˆ†æ•°ç»„æ¥è®¡ç®—åŒºé—´å†…æ¯ä¸ªå…ƒç´ çš„å€¼ï¼Œå¤æ‚åº¦æ˜¯ğ‘‚(ğ‘›)çš„ã€‚åˆèµ·æ¥çš„æ€»å¤æ‚åº¦è¿˜æ˜¯O(mn)çš„ï¼Œè·Ÿæš´åŠ›æ³•çš„å¤æ‚åº¦ä¸€æ ·ã€‚
    
    æœ¬é¢˜éœ€è¦ç»“åˆç¬¬äºŒä¸ªç®—æ³•ï¼šäºŒåˆ†æ³•ã€‚ä»ç¬¬1æ¬¡ä¿®æ”¹åˆ°ç¬¬mæ¬¡ä¿®æ”¹ï¼Œè‚¯å®šæœ‰ä¸€æ¬¡ä¿®æ”¹æ˜¯ä¸´ç•Œç‚¹ã€‚åœ¨ä¸´ç•Œç‚¹å‰ï¼Œæ²¡æœ‰è´Ÿå€¼(æˆ˜èˆ°çˆ†ç‚¸)ï¼›åœ¨ä¸´ç•Œç‚¹åï¼Œå‡ºç°äº†è´Ÿå€¼ï¼Œä¸”åé¢ä¸€ç›´æœ‰è´Ÿå€¼ã€‚é‚£ä¹ˆå¯¹mè¿›è¡ŒäºŒåˆ†ï¼Œå°±èƒ½åœ¨ğ‘‚(ğ‘™ğ‘œğ‘”ğ‘š)æ¬¡å†…æ‰¾åˆ°è¿™ä¸ªä¸´ç•Œç‚¹ï¼Œè¿™å°±æ˜¯ç­”æ¡ˆã€‚æ€»å¤æ‚åº¦ğ‘‚(ğ‘›ğ‘™ğ‘œğ‘”ğ‘š)ã€‚
    
    ä¸‹é¢ç»™å‡ºä»£ç ã€‚å…¶ä¸­check()å‡½æ•°åŒ…å«äº†ä¸‰ç»´å·®åˆ†çš„å…¨éƒ¨å†…å®¹ã€‚ä»£ç æœ‰å‡ ä¸ªå…³é”®ç‚¹ï¼š

    ï¼ˆ1ï¼‰æ²¡æœ‰å®šä¹‰ğ‘\[\]\[\]\[\]ï¼Œè€Œæ˜¯ç”¨ğ·\[\]\[\]\[\]æ¥ä»£æ›¿ã€‚
    
    ï¼ˆ2ï¼‰å‹ç»´ã€‚ç›´æ¥å®šä¹‰ä¸‰ç»´å·®åˆ†æ•°ç»„ğ·\[\]\[\]\[\]ä¸å¤ªæ–¹ä¾¿ã€‚è™½ç„¶åæ ‡ç‚¹æ€»æ•°é‡ğ‘›=ğ´Ã—ğµÃ—ğ¶=10^6 æ¯”è¾ƒå°ï¼Œä½†æ˜¯æ¯ä¸€ç»´éƒ½éœ€è¦å®šä¹‰åˆ°10^6 ï¼Œé‚£ä¹ˆæ€»ç©ºé—´å°±æ˜¯10^18 ã€‚ä¸ºé¿å…è¿™ä¸€é—®é¢˜ï¼Œå¯ä»¥æŠŠä¸‰ç»´åæ ‡å‹ç»´æˆä¸€ç»´æ•°ç»„ğ·\[\]ï¼Œæ€»é•¿åº¦ä»ç„¶æ˜¯10^6 çš„ã€‚è¿™ä¸ªæŠ€å·§å¾ˆæœ‰ç”¨ã€‚å®ç°å‡½æ•°æ˜¯num()ï¼Œå®ƒæŠŠä¸‰ç»´åæ ‡(ğ‘¥,ğ‘¦,ğ‘§)å˜æ¢ä¸ºä¸€ç»´åæ ‡â„=(ğ‘¥âˆ’1)âˆ—ğµâˆ—ğ¶+(ğ‘¦âˆ’1)âˆ—ğ¶+(ğ‘§âˆ’1)+1ï¼Œå½“ğ‘¥ã€ğ‘¦ã€ğ‘§çš„å–å€¼èŒƒå›´åˆ†åˆ«æ˜¯1 ~ Aã€1 ~ Bã€1 ~ Cæ—¶ï¼Œâ„çš„èŒƒå›´æ˜¯1 ~ A Ã— B Ã— Cã€‚
    
    å¦‚æœå¸Œæœ›æŒ‰Cè¯­è¨€çš„ä¹ æƒ¯ä»0å¼€å§‹ï¼Œğ‘¥ã€ğ‘¦ã€ğ‘§çš„å–å€¼èŒƒå›´åˆ†åˆ«æ˜¯0 ~ A-1ã€0 ~ B-1ã€0 ~ C-1ï¼ŒhèŒƒå›´æ˜¯0 ~ A Ã— B Ã— C-1ï¼Œå°±æŠŠå¼å­æ”¹ä¸ºï¼šâ„=ğ‘¥âˆ—ğµâˆ—ğ¶+ğ‘¦âˆ—ğ¶+ğ‘§ã€‚
    
    åŒç†ï¼ŒäºŒç»´åæ ‡(ğ‘¥,ğ‘¦)ä¹Ÿå¯ä»¥å‹ç»´æˆä¸€ç»´â„=(ğ‘¥âˆ’1)âˆ—ğµ+(ğ‘¦âˆ’1)+1h=(xâˆ’1)âˆ—B+(yâˆ’1)+1ï¼Œå½“ğ‘¥ã€ğ‘¦çš„å–å€¼èŒƒå›´åˆ†åˆ«æ˜¯1 ~ Aã€1 ~ Bæ—¶ï¼Œâ„çš„èŒƒå›´æ˜¯1 ~ A Ã— Bã€‚
    
    ï¼ˆ3ï¼‰check()ä¸­19-26è¡Œï¼Œåœ¨ğ·\[\]ä¸Šè®°å½•åŒºé—´ä¿®æ”¹ã€‚
    
    ï¼ˆ4ï¼‰check()ä¸­29-40è¡Œçš„3ä¸ªforå¾ªç¯è®¡ç®—å‰ç¼€å’Œï¼ŒåŸç†è§äºŒç»´å·®åˆ†çš„ä»£ç 2ã€‚å®ƒåˆ†åˆ«ä»xã€yã€zä¸‰ä¸ªæ–¹å‘ç´¯åŠ å°ç«‹æ–¹ä½“çš„ä½“ç§¯ï¼Œè®¡ç®—å‡ºæ‰€æœ‰çš„å‰ç¼€å’Œã€‚

???+note "å‚è€ƒä»£ç "

    ```cpp
    #include<stdio.h>
    int A,B,C,n,m;
    const int Maxn = 1000005;
    int s[Maxn];   //å­˜å‚¨èˆ°é˜Ÿç”Ÿå‘½å€¼
    int D[Maxn];   //ä¸‰ç»´å·®åˆ†æ•°ç»„ï¼ˆå‹ç»´ï¼‰ï¼›åŒæ—¶ä¹Ÿç”¨æ¥è®¡ç®—æ¯ä¸ªç‚¹çš„æ”»å‡»å€¼
    int x2[Maxn], y2[Maxn], z2[Maxn]; //å­˜å‚¨åŒºé—´ä¿®æ”¹çš„èŒƒå›´ï¼Œå³æ”»å‡»çš„èŒƒå›´
    int x1[Maxn], y1[Maxn], z1[Maxn]; 
    int d[Maxn];                    //è®°å½•ä¼¤å®³ï¼Œå°±æ˜¯åŒºé—´ä¿®æ”¹
    int num(int x,int y,int z) {  
    //å°æŠ€å·§ï¼šå‹ç»´ï¼ŒæŠŠä¸‰ç»´åæ ‡[(x,y,z)è½¬ä¸ºä¸€ç»´çš„((x-1)*B+(y-1))*C+(z-1)+1
        if (x>A || y>B || z>C) return 0;
        return ((x-1)*B+(y-1))*C+(z-1)+1;
    }
    bool check(int x){              //åšxæ¬¡åŒºé—´ä¿®æ”¹ã€‚å³æ£€æŸ¥ç»è¿‡xæ¬¡æ”»å‡»åæ˜¯å¦æœ‰æˆ˜èˆ°çˆ†ç‚¸
        for (int i=1; i<=n; i++)  D[i]=0;  //å·®åˆ†æ•°ç»„çš„åˆå€¼ï¼Œæœ¬é¢˜æ˜¯0
        for (int i=1; i<=x; i++) {         //ç”¨ä¸‰ç»´å·®åˆ†æ•°ç»„è®°å½•åŒºé—´ä¿®æ”¹ï¼šæœ‰8ä¸ªåŒºé—´ç«¯ç‚¹
            D[num(x1[i],  y1[i],  z1[i])]   += d[i];
            D[num(x2[i]+1,y1[i],  z1[i])]   -= d[i];
            D[num(x1[i],  y1[i],  z2[i]+1)] -= d[i];
            D[num(x2[i]+1,y1[i],  z2[i]+1)] += d[i];
            D[num(x1[i],  y2[i]+1,z1[i])]   -= d[i];
            D[num(x2[i]+1,y2[i]+1,z1[i])]   += d[i];
            D[num(x1[i],  y2[i]+1,z2[i]+1)] += d[i];
            D[num(x2[i]+1,y2[i]+1,z2[i]+1)] -= d[i];
        }
        //ä¸‹é¢ä»xã€yã€zä¸‰ä¸ªæ–¹å‘è®¡ç®—å‰ç¼€å’Œ
        for (int i=1; i<=A; i++)
            for (int j=1; j<=B; j++)
                for (int k=1; k<C; k++)        //æŠŠxã€yçœ‹æˆå®šå€¼ï¼Œç´¯åŠ zæ–¹å‘
                    D[num(i,j,k+1)] += D[num(i,j,k)];
        for (int i=1; i<=A; i++)
            for (int k=1; k<=C; k++)
                for (int j=1; j<B; j++)        //æŠŠxã€zçœ‹æˆå®šå€¼ï¼Œç´¯åŠ yæ–¹å‘
                    D[num(i,j+1,k)] += D[num(i,j,k)];
        for (int j=1; j<=B; j++)
            for (int k=1; k<=C; k++)
                for (int i=1; i<A; i++)        //æŠŠyã€zçœ‹æˆå®šå€¼ï¼Œç´¯åŠ xæ–¹å‘
                    D[num(i+1,j,k)] += D[num(i,j,k)];
        for (int i=1; i<=n; i++)    //æœ€ååˆ¤æ–­æ˜¯å¦æ”»å‡»å€¼å¤§äºç”Ÿå‘½å€¼
            if (D[i]>s[i])
                return true;
        return false;
    }
    int main() {
        scanf("%d%d%d%d", &A, &B, &C, &m);
        n = A*B*C;
        for (int i=1; i<=n; i++) scanf("%d", &s[i]);  //è¯»ç”Ÿå‘½å€¼
        for (int i=1; i<=m; i++)                      //è¯»æ¯æ¬¡æ”»å‡»çš„èŒƒå›´ï¼Œç”¨åæ ‡è¡¨ç¤º
            scanf("%d%d%d%d%d%d%d",&x1[i],&x2[i],&y1[i],&y2[i],&z1[i],&z2[i],&d[i]);
    int L = 1,R = m;      //ç»å…¸çš„äºŒåˆ†å†™æ³•
        while (L<R) {     //å¯¹mè¿›è¡ŒäºŒåˆ†ï¼Œæ‰¾åˆ°ä¸´ç•Œå€¼ã€‚æ€»å…±åªå¾ªç¯äº†log(m)æ¬¡
            int mid = (L+R)>>1;
            if (check(mid)) R = mid;
            else L = mid+1;
        }
        printf("%d\n", R);  //æ‰“å°ä¸´ç•Œå€¼
        return 0;
    }
    ```
### æ ‘ä¸Šå·®åˆ†

æ ‘ä¸Šå·®åˆ†å¯ä»¥ç†è§£ä¸ºå¯¹æ ‘ä¸Šçš„æŸä¸€æ®µè·¯å¾„è¿›è¡Œå·®åˆ†æ“ä½œï¼Œè¿™é‡Œçš„è·¯å¾„å¯ä»¥ç±»æ¯”ä¸€ç»´æ•°ç»„çš„åŒºé—´è¿›è¡Œç†è§£ã€‚ä¾‹å¦‚åœ¨å¯¹æ ‘ä¸Šçš„ä¸€äº›è·¯å¾„è¿›è¡Œé¢‘ç¹æ“ä½œï¼Œå¹¶ä¸”è¯¢é—®æŸæ¡è¾¹æˆ–è€…æŸä¸ªç‚¹åœ¨ç»è¿‡æ“ä½œåçš„å€¼çš„æ—¶å€™ï¼Œå°±å¯ä»¥è¿ç”¨æ ‘ä¸Šå·®åˆ†æ€æƒ³äº†ã€‚

æ ‘ä¸Šå·®åˆ†é€šå¸¸ä¼šç»“åˆ [æ ‘åŸºç¡€](../graph/tree-basic.md) å’Œ [æœ€è¿‘å…¬å…±ç¥–å…ˆ](../graph/lca.md) æ¥è¿›è¡Œè€ƒå¯Ÿã€‚æ ‘ä¸Šå·®åˆ†åˆåˆ†ä¸º **ç‚¹å·®åˆ†** ä¸ **è¾¹å·®åˆ†**ï¼Œåœ¨å®ç°ä¸Šä¼šç¨æœ‰ä¸åŒã€‚

#### ç‚¹å·®åˆ†

ä¸¾ä¾‹ï¼šå¯¹æ ‘ä¸Šçš„ä¸€äº›è·¯å¾„ $\delta(s_1,t_1), \delta(s_2,t_2), \delta(s_3,t_3)\dots$ è¿›è¡Œè®¿é—®ï¼Œé—®ä¸€æ¡è·¯å¾„ $\delta(s,t)$ ä¸Šçš„ç‚¹è¢«è®¿é—®çš„æ¬¡æ•°ã€‚

å¯¹äºä¸€æ¬¡ $\delta(s,t)$ çš„è®¿é—®ï¼Œéœ€è¦æ‰¾åˆ° $s$ ä¸ $t$ çš„å…¬å…±ç¥–å…ˆï¼Œç„¶åå¯¹è¿™æ¡è·¯å¾„ä¸Šçš„ç‚¹è¿›è¡Œè®¿é—®ï¼ˆç‚¹çš„æƒå€¼åŠ ä¸€ï¼‰ï¼Œè‹¥é‡‡ç”¨ DFS ç®—æ³•å¯¹æ¯ä¸ªç‚¹è¿›è¡Œè®¿é—®ï¼Œç”±äºæœ‰å¤ªå¤šçš„è·¯å¾„éœ€è¦è®¿é—®ï¼Œæ—¶é—´ä¸Šæ‰¿å—ä¸äº†ã€‚è¿™é‡Œè¿›è¡Œå·®åˆ†æ“ä½œï¼š

$$
\begin{aligned}
&d_s\leftarrow d_s+1\\
&d_{lca}\leftarrow d_{\textit{lca}}-1\\
&d_t\leftarrow d_t+1\\
&d_{f(\textit{lca})}\leftarrow d_{f(\textit{lca})}-1\\
\end{aligned}
$$

å…¶ä¸­ $f(x)$ è¡¨ç¤º $x$ çš„çˆ¶äº²èŠ‚ç‚¹ï¼Œ$d_i$ ä¸ºç‚¹æƒ $a_i$ çš„å·®åˆ†æ•°ç»„ã€‚

![](./images/prefix_sum1.png)

å¯ä»¥è®¤ä¸ºå…¬å¼ä¸­çš„å‰ä¸¤æ¡æ˜¯å¯¹è“è‰²æ–¹æ¡†å†…çš„è·¯å¾„è¿›è¡Œæ“ä½œï¼Œåä¸¤æ¡æ˜¯å¯¹çº¢è‰²æ–¹æ¡†å†…çš„è·¯å¾„è¿›è¡Œæ“ä½œã€‚ä¸å¦¨ä»¤ $\textit{lca}$ å·¦ä¾§çš„ç›´ç³»å­èŠ‚ç‚¹ä¸º $\textit{left}$ã€‚é‚£ä¹ˆæœ‰ $d_{\textit{lca}}-1=a_{\textit{lca}}-(a_{\textit{left}}+1)$ï¼Œ$d_{f(\textit{lca})}-1=a_{f(\textit{lca})}-(a_{\textit{lca}}+1)$ã€‚å¯ä»¥å‘ç°å®é™…ä¸Šç‚¹å·®åˆ†çš„æ“ä½œå’Œä¸Šæ–‡ä¸€ç»´æ•°ç»„çš„å·®åˆ†æ“ä½œæ˜¯ç±»ä¼¼çš„ã€‚

#### è¾¹å·®åˆ†

è‹¥æ˜¯å¯¹è·¯å¾„ä¸­çš„è¾¹è¿›è¡Œè®¿é—®ï¼Œå°±éœ€è¦é‡‡ç”¨è¾¹å·®åˆ†ç­–ç•¥äº†ï¼Œä½¿ç”¨ä»¥ä¸‹å…¬å¼ï¼š

$$
\begin{aligned}
&d_s\leftarrow d_s+1\\
&d_t\leftarrow d_t+1\\
&d_{\textit{lca}}\leftarrow d_{\textit{lca}}-2\\
\end{aligned}
$$

![](./images/prefix_sum2.png)

ç”±äºåœ¨è¾¹ä¸Šç›´æ¥è¿›è¡Œå·®åˆ†æ¯”è¾ƒå›°éš¾ï¼Œæ‰€ä»¥å°†æœ¬æ¥åº”å½“ç´¯åŠ åˆ°çº¢è‰²è¾¹ä¸Šçš„å€¼å‘ä¸‹ç§»åŠ¨åˆ°é™„è¿‘çš„ç‚¹é‡Œï¼Œé‚£ä¹ˆæ“ä½œèµ·æ¥ä¹Ÿå°±æ–¹ä¾¿äº†ã€‚å¯¹äºå…¬å¼ï¼Œæœ‰äº†ç‚¹å·®åˆ†çš„ç†è§£åŸºç¡€åä¹Ÿä¸éš¾æ¨å¯¼ï¼ŒåŒæ ·æ˜¯å¯¹ä¸¤æ®µåŒºé—´è¿›è¡Œå·®åˆ†ã€‚

### ä¾‹é¢˜

???+note "[æ´›è°· 3128 æœ€å¤§æµ](https://www.luogu.com.cn/problem/P3128)"
    FJ ç»™ä»–çš„ç‰›æ£šçš„ $N(2 \le N \le 50,000)$ ä¸ªéš”é—´ä¹‹é—´å®‰è£…äº† $N-1$ æ ¹ç®¡é“ï¼Œéš”é—´ç¼–å·ä» $1$ åˆ° $N$ã€‚æ‰€æœ‰éš”é—´éƒ½è¢«ç®¡é“è¿é€šäº†ã€‚
    
    FJ æœ‰ $K(1 \le K \le 100,000)$ æ¡è¿è¾“ç‰›å¥¶çš„è·¯çº¿ï¼Œç¬¬ $i$ æ¡è·¯çº¿ä»éš”é—´ $s_i$ è¿è¾“åˆ°éš”é—´ $t_i$ã€‚ä¸€æ¡è¿è¾“è·¯çº¿ä¼šç»™å®ƒçš„ä¸¤ä¸ªç«¯ç‚¹å¤„çš„éš”é—´ä»¥åŠä¸­é—´é€”å¾„çš„æ‰€æœ‰éš”é—´å¸¦æ¥ä¸€ä¸ªå•ä½çš„è¿è¾“å‹åŠ›ï¼Œä½ éœ€è¦è®¡ç®—å‹åŠ›æœ€å¤§çš„éš”é—´çš„å‹åŠ›æ˜¯å¤šå°‘ã€‚

??? note "è§£é¢˜æ€è·¯"
    éœ€è¦ç»Ÿè®¡æ¯ä¸ªç‚¹ç»è¿‡äº†å¤šå°‘æ¬¡ï¼Œé‚£ä¹ˆå°±ç”¨æ ‘ä¸Šå·®åˆ†å°†æ¯ä¸€æ¬¡çš„è·¯å¾„ä¸Šçš„ç‚¹åŠ ä¸€ï¼Œå¯ä»¥å¾ˆå¿«å¾—åˆ°æ¯ä¸ªç‚¹ç»è¿‡çš„æ¬¡æ•°ã€‚è¿™é‡Œé‡‡ç”¨å€å¢æ³•è®¡ç®— LCAï¼Œæœ€åå¯¹ DFS éå†æ•´æ£µæ ‘ï¼Œåœ¨å›æº¯æ—¶å¯¹å·®åˆ†æ•°ç»„æ±‚å’Œå°±èƒ½æ±‚å¾—ç­”æ¡ˆäº†ã€‚

??? note "å‚è€ƒä»£ç "
    ```cpp
    --8<-- "docs/basic/code/prefix-sum/prefix-sum_3.cpp"
    ```

## ä¹ é¢˜

å‰ç¼€å’Œï¼š

??? note "[æ´›è°· B3612ã€æ·±è¿› 1. ä¾‹ 1ã€‘æ±‚åŒºé—´å’Œ](https://www.luogu.com.cn/problem/B3612)"
    ç»™å®š $n$ ä¸ªæ­£æ•´æ•°ç»„æˆçš„æ•°åˆ— $a_1, a_2, \cdots, a_n$ å’Œ $m$ ä¸ªåŒºé—´ $[l_i,r_i]$ï¼Œåˆ†åˆ«æ±‚è¿™ $m$ ä¸ªåŒºé—´çš„åŒºé—´å’Œã€‚

    ??? tip
        å‰ç¼€å’Œå·®åˆ†æ¨¡æ¿é¢˜ã€‚

        æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ•°åˆ— {$a_n$} çš„å‰ç¼€å’Œä¸º $S_n = \sum_{i=1}^n a_i = a_1 + a_2 + \dots +a_n$ ã€‚

        æœ‰äº†å‰ç¼€å’Œä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å·®åˆ†æ¥è¿›è¡Œé™æ€çš„åŒºé—´æ±‚å’Œã€‚å…·ä½“è€Œè¨€ï¼Œå¯¹äºä¸€ä¸ªåŒºé—´ $[l, r]$ï¼ŒåŒºé—´çš„å’Œ = $S_r - S_{l-1}$

    ??? note "å‚è€ƒä»£ç "

        ```cpp
        #include <iostream>
        #include <cstdio>
        #include <cstring>
        #include <algorithm>
        #include <cmath>
        #include <cctype>
        #include <queue>
        #include <vector>

        using namespace std;

        inline int read()
        {
            int x=0,f=1;char ch=getchar();
            while (!isdigit(ch)){if (ch=='-') f=-1;ch=getchar();}
            while (isdigit(ch)){x=x*10+ch-48;ch=getchar();}
            return x*f;
        }

        int n,m,a[100050],s[100050];

        int main()
        {
            n=read();
            for (int i=1;i<=n;i++)
                s[i]=s[i-1]+(a[i]=read());
            m=read();
            for (int i=1;i<=m;i++)
            {
                int l=read(),r=read();
                cout << s[r]-s[l-1] << endl;
            }
            return 0;
        }
        ```

??? note "[æ´›è°· U69096 å‰ç¼€å’Œçš„é€†](https://www.luogu.com.cn/problem/U69096)"
    æœ‰ N ä¸ªæ­£æ•´æ•°æ”¾åˆ°æ•°ç»„ B é‡Œï¼Œå®ƒæ˜¯æ•°ç»„ A çš„å‰ç¼€å’Œæ•°ç»„ï¼Œæ±‚ A æ•°ç»„ã€‚

    ??? tip
    A å°±æ˜¯ B çš„å·®åˆ†æ•°ç»„ã€‚

??? note "[AT2412 æœ€å¤§ã®å’Œ](https://vjudge.net/problem/AtCoder-joi2007ho_a#author=wuyudi)"
    è¯»å…¥ n ä¸ªæ•´æ•°çš„æ•°åˆ— a1ï¼Œa2ï¼Œâ€¦ï¼Œan å’Œæ­£æ•´æ•° kï¼ˆ1<=k<=nï¼‰ï¼Œè¯·è¾“å‡ºè¿ç»­æ’åˆ—çš„ k ä¸ªæ•´æ•°çš„å’Œçš„æœ€å¤§å€¼

??? note "[ã€ŒUSACO16JANã€å­å…±ä¸ƒ Subsequences Summing to Sevens](https://www.luogu.com.cn/problem/P3131)"
    ç»™ä½ nä¸ªæ•°ï¼Œåˆ†åˆ«æ˜¯$a[1],a[2],...,a[n]$ã€‚æ±‚ä¸€ä¸ªæœ€é•¿çš„åŒºé—´$[x,y]$ï¼Œä½¿å¾—åŒºé—´ä¸­çš„æ•°($a[x],a[x+1],a[x+2],...,a[y-1],a[y]$)çš„å’Œèƒ½è¢«7æ•´é™¤ã€‚è¾“å‡ºåŒºé—´é•¿åº¦ã€‚è‹¥æ²¡æœ‰ç¬¦åˆè¦æ±‚çš„åŒºé—´ï¼Œè¾“å‡º0ã€‚

    ??? tip
        å‰ç¼€å’Œï¼Œ $s[i]$ è¡¨ç¤º $[1,i]$ çš„å’Œï¼Œå½“ $s[r]$ å’Œ $s[lâˆ’1]$ æ¨¡7ç›¸åŒæ—¶ï¼ŒåŒºé—´å°±èƒ½è¢«7æ•´é™¤ï¼Œæ±‚å‡ºå‰ç¼€å’Œæ¯ä¸ªä½™æ•°å¯¹åº”çš„æœ€å°çš„ lâˆ’1 å’Œæœ€å¤§çš„ r ä»è€Œç®—å‡ºæœ€é•¿åŒºé—´é•¿åº¦ï¼Œå¯ä»¥è¾¹è¯»å…¥è¾¹è®°å½•ã€‚ç«¯ç‚¹æ¨¡ 7 ä¸º 0 åˆ° 6 çš„æœ€é•¿åŒºé—´é•¿åº¦çš„æœ€å¤§å€¼å°±æ˜¯ç­”æ¡ˆï¼Œæ³¨æ„åˆ¤æ–­åŒºé—´æ˜¯å¦å­˜åœ¨ ç”¨æ»šåŠ¨æ•°ç»„ï¼Œæ—¶é—´ O(n)ã€‚
    
    ??? note "å‚è€ƒä»£ç "

        ```cpp
        #include<cstdio>
        #include<algorithm>
        using namespace std;
        int n,a,s,l[]={0,-1,-1,-1,-1,-1,-1},r[7],ans; //sæ˜¯å‰ç¼€å’Œï¼Œl[i]å­˜%7ä¸ºiçš„æœ€å°l-1,r[i]å­˜%7ä¸ºiçš„æœ€å¤§r,-1ä»£è¡¨æ²¡æœ‰%7ä¸ºiçš„å‰ç¼€å’Œ,å½“æœ‰ä»»æ„å‰ç¼€å’Œs[x]%7ç­‰äº0æ—¶,æœ€é•¿åŒºé—´é•¿åº¦å°±æ˜¯x
        int main(){
            scanf("%d",&n);
            for(int i=1;i<=n;++i){
                scanf("%d",&a);
                s=(s+a)%7;
                if(l[s]==-1)l[s]=i;
                r[s]=i;
            }
            for(int i=0;i<7;++i)if(l[i]!=-1)ans=max(ans,r[i]-l[i]);
            printf("%d",ans);
        }
        ```

??? note "[ã€ŒUSACO05JANã€Moo Volume S](https://www.luogu.com.cn/problem/P6067)"
    Farmer John çš„å†œåœºä¸Šæœ‰ $N$ å¤´å¥¶ç‰›ï¼ˆ$1 \leq N \leq 10^5$ï¼‰ï¼Œç¬¬ $i$ å¤´å¥¶ç‰›çš„ä½ç½®ä¸º $x_i$ï¼ˆ$0 \leq x_i \leq 10^9$ï¼‰ã€‚

    å¥¶ç‰›å¾ˆå¥è°ˆï¼Œæ¯å¤´å¥¶ç‰›éƒ½å’Œå…¶ä»– $N-1$ å¤´å¥¶ç‰›èŠå¤©ã€‚ç¬¬ $i$ å¤´å¥¶ç‰›å’Œç¬¬ $j$ å¤´å¥¶ç‰›èŠå¤©æ—¶ï¼ŒéŸ³é‡ä¸º $|x_i-x_j|$ã€‚

    è¯·æ‚¨æ±‚å‡ºæ‰€æœ‰å¥¶ç‰›èŠå¤©éŸ³é‡çš„æ€»å’Œã€‚

    ??? tip
        é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥æŠŠé¢˜ç®€åŒ–ä¸€ä¸‹ï¼Œç¬¬ i å¤´ç‰›å’Œ j å¤´ç‰›éŸ³é‡åªéœ€è¦ $âˆ£x_i âˆ’ x_jâˆ£$ï¼Œå› ä¸ºæœ‰ç»å¯¹å€¼ï¼Œ$âˆ£x_i âˆ’ x_jâˆ£$ = $âˆ£x_j âˆ’ x_iâˆ£$ï¼Œæ‰€ä»¥æœ€ååªéœ€ä¹˜ 2 å³å¯ã€‚

        äºæ˜¯ï¼Œæˆ‘ä»¬æšä¸¾ç¬¬ i å¤´å¥¶ç‰›ï¼Œç®—å‡ºå®ƒä¸ç¬¬ 1âˆ½iâˆ’1 å¤´å¥¶ç‰›è°ˆè¯çš„æ€»éŸ³é‡ã€‚

        å’±ä»¬å†çœ‹çœ‹è¿™ä¸ªç®—ç¬¬ i å¤´å¥¶ç‰›æ€»éŸ³é‡çš„å¼å­ã€‚

        $(a_i âˆ’ a_{iâˆ’1})+(a_i âˆ’ a_{iâˆ’2} )+...+(a_i âˆ’ a_1)$

        æˆ‘ä»¬æŠŠæ‹¬å·æ‹†å¼€ï¼ŒæŠŠè¿™ä¸ªå¼å­ç®€åŒ–ã€‚

        $a_i \times (iâˆ’1) âˆ’ a_{iâˆ’1} âˆ’ a_{iâˆ’2} âˆ’ ... âˆ’ a_1$
        â€‹
        â€‹ç”¨å‰ç¼€å’Œå­˜ï¼Œè¿™æ ·æ—¶é—´å¤æ‚åº¦å¹¶ä¸ä¼šçˆ†ã€‚

        æ³¨æ„ï¼šè¿™ç§æ–¹æ³•å¿…é¡»æœ‰åºï¼Œå¦åˆ™ä¸èƒ½å˜æˆæˆ‘ä»¬ç®€åŒ–åçš„å¼å­ã€‚
    
    ??? note "å‚è€ƒä»£ç "

        ```cpp
        #include<iostream>
        #include<cmath>
        #include<algorithm>
        using namespace std;
        long long ans,a[1000005],n,sum[1000005];
        int main(){
            cin>>n;
            for(int i=1;i<=n;i++)
                cin>>a[i];
            sort(a+1,a+1+n);
            for(int i=1;i<=n;i++){
                sum[i]=sum[i-1]+a[i];//å‰ç¼€å’Œ 
            }
            for(int i=n;i>=1;i--){
                ans=ans+labs(sum[i-1]-a[i]*(i-1));//ç®€åŒ–åçš„å¼å­ 
            }
            cout<<ans*2;//æŠŠå°‘è®¡ç®—çš„è¡¥å›æ¥ 
            return 0;
        } 
        ```
* * *

äºŒç»´/å¤šç»´å‰ç¼€å’Œï¼š

??? note "[HDU 6514 Monitor](https://vjudge.net/problem/HDU-6514)"
    ç»™å‡ºä¸€ä¸ªn*mçš„çŸ©é˜µï¼Œå¼€å§‹å…¨éƒ¨åˆå§‹åŒ–ä¸º0ï¼Œç„¶åç»™å‡ºä¸€ç³»åˆ—çš„å°çŸ©é˜µçš„èŒƒå›´ï¼Œå°çŸ©é˜µä¸­çš„æ ¼å­å…¨éƒ¨å˜ä¸º1ï¼Œæœ€åå†ç»™å‡ºä¸€äº›æŸ¥è¯¢ï¼ŒæŸ¥è¯¢çŸ©é˜µèŒƒå›´å†…æ˜¯å¦æ‰€æœ‰çš„æ ¼å­éƒ½æ˜¯1ï¼Œæ˜¯çš„è¯è¾“å‡ºyesï¼Œå¦åˆ™è¾“å‡ºno

    ??? tip
        äºŒç»´å·®åˆ†+äºŒç»´å‰ç¼€å’Œ

    ??? note "å‚è€ƒä»£ç "

        ```cpp
        #include<cstdio>
        #include<iostream>
        using namespace std;
        inline void read(int &x){
            x=0;char c=getchar();
            while(!isdigit(c)){c=getchar();}
            while(isdigit(c)){x=(x<<3)+(x<<1)+(c-48);c=getchar();}
        }
        const int N = 2E7+10;
        
        int s[N];  //å› ä¸º n*m<=1E7,å¯ä»¥å¼€vectoräºŒç»´ï¼Œè¿™é‡Œé€‰æ‹©å¼€ä¸€ç»´æ¨¡æ‹Ÿ
        int n,m,p,q;
        
        int id(int x,int y){return m*x+y;}
        
        void add(int x,int y,int op){s[id(x,y)]+=op;}
        
        int sum(int x1,int y1,int x2,int y2){
            return s[id(x2,y2)]-s[id(x2,y1-1)]-s[id(x1-1,y2)]+s[id(x1-1,y1-1)];
            //äºŒç»´å‰ç¼€å’ŒæŸ¥è¯¢
        }
        int main()
        {
            while(~scanf("%d%d",&n,&m)){
                for(int i=0;i<=(n+1)*(m+1);i++) s[i]=0;
                read(p);
                while(p--){
                    int x1,y1,x2,y2;
                    read(x1),read(y1),read(x2),read(y2);
                    
                    //è¿™å››å¥æ˜¯äºŒç»´å·®åˆ†åŸºæœ¬è¯­å¥ï¼Œå°±ä¸è§£é‡Šäº†
                    add(x1,y1,1);
                    add(x1,y2+1,-1);
                    add(x2+1,y1,-1);
                    add(x2+1,y2+1,1);
                }
                for(int i=1;i<=n;i++){
                    for(int j=1;j<=m;j++){
                        s[id(i,j)]+=s[id(i-1,j)]+s[id(i,j-1)]-s[id(i-1,j-1)];
                        //ç¬¬ä¸€éå‰ç¼€å’Œæ˜¯æ ¹æ®å·®åˆ†çš„æ€§è´¨æ±‚å‡ºæ¯ä¸ªç‚¹è¢«å‡ ä¸ªæ‘„åƒå¤´ç›‘è§†åˆ°ï¼›
                    }
                }
                for(int i=1;i<=n;i++){
                    for(int j=1;j<=m;j++){
                        if(s[id(i,j)]>1) s[id(i,j)]=1;
                        //åªè¦è¢«ç›‘è§†åˆ°ï¼Œç½® 1 ï¼›
                    }
                }
                for(int i=1;i<=n;i++){
                    for(int j=1;j<=m;j++){
                        s[id(i,j)]+=s[id(i-1,j)]+s[id(i,j-1)]-s[id(i-1,j-1)];
                        //ç¬¬äºŒéå‰ç¼€å’Œæ˜¯è¿™ä¸ªç‚¹ä»¥åŠä¹‹å‰æ‰€æœ‰çš„ç‚¹è¢«ç›‘è§†çš„å•ä½çš„æ•°é‡ï¼Œä¹Ÿæ˜¯ä¸Šä¸€æ­¥ç½®1çš„åŸå› ï¼›
                    }
                }
                read(q);
                while(q--){
                    int x1,y1,x2,y2;
                    read(x1),read(y1),read(x2),read(y2);
                    if(sum(x1,y1,x2,y2)==(y2-y1+1)*(x2-x1+1)) puts("YES");
                    else puts("NO");
                }
            }
        }
        ```

??? note "[ã€ŒHNOI2003ã€æ¿€å…‰ç‚¸å¼¹](https://www.luogu.com.cn/problem/P2280)"

    ä¸€ç§æ–°å‹çš„æ¿€å…‰ç‚¸å¼¹ï¼Œå¯ä»¥æ‘§æ¯ä¸€ä¸ªè¾¹é•¿ä¸º $m$ çš„æ­£æ–¹å½¢å†…çš„æ‰€æœ‰ç›®æ ‡ã€‚ç°åœ¨åœ°å›¾ä¸Šæœ‰ $n$ ä¸ªç›®æ ‡ï¼Œç”¨æ•´æ•° $x_i$ , $y_i$ è¡¨ç¤ºç›®æ ‡åœ¨åœ°å›¾ä¸Šçš„ä½ç½®ï¼Œæ¯ä¸ªç›®æ ‡éƒ½æœ‰ä¸€ä¸ªä»·å€¼ $v_i$ .æ¿€å…‰ç‚¸å¼¹çš„æŠ•æ”¾æ˜¯é€šè¿‡å«æ˜Ÿå®šä½çš„ï¼Œä½†å…¶æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œå°±æ˜¯å…¶çˆ†ç ´èŒƒå›´ï¼Œå³é‚£ä¸ªè¾¹é•¿ä¸º $m$ çš„è¾¹å¿…é¡»ä¸ $x$ è½´, $y$ è½´å¹³è¡Œã€‚è‹¥ç›®æ ‡ä½äºçˆ†ç ´æ­£æ–¹å½¢çš„è¾¹ä¸Šï¼Œè¯¥ç›®æ ‡ä¸ä¼šè¢«æ‘§æ¯ã€‚

    ç°åœ¨ä½ çš„ä»»åŠ¡æ˜¯è®¡ç®—ä¸€é¢—ç‚¸å¼¹æœ€å¤šèƒ½ç‚¸æ‰åœ°å›¾ä¸Šæ€»ä»·å€¼ä¸ºå¤šå°‘çš„ç›®æ ‡ã€‚

    ??? tip
        äºŒç»´å‰ç¼€å’Œ
    
    ??? note "å‚è€ƒä»£ç "

        ```cpp
        #include <iostream>
        #include <algorithm>
        using namespace std;

        int n, m, s[5010][5010];
        // å› ä¸ºç©ºé—´è¾ƒä¸ºç´§å¼ ï¼Œè¿™é‡Œåªç”¨äº†ä¸€ä¸ªæ•°ç»„ï¼Œè®¡ç®—å‡ºå‰ç¼€å’ŒååŸæ•°ç»„ç›´æ¥è¢«è¦†ç›–

        int main() {
            cin >> n >> m;
            for (int i = 1; i <= n; i ++) {
                int x, y, v;
                cin >> x >> y >> v;
                s[x + 1][y + 1] += v;	// å°†æ¨ªçºµåæ ‡éƒ½åŠ ä¸€ï¼Œåæ ‡èŒƒå›´å˜æˆ [1, 5001]ï¼Œé¿å…è¶Šç•Œ
            }
            
            int N = 5001; // N ä¸ºåæ ‡èŒƒå›´
            for (int i = 1; i <= N; i ++)
                for (int j = 1; j <= N; j ++)
                    s[i][j] = s[i - 1][j] + s[i][j - 1] - s[i - 1][j - 1] + s[i][j];
            
            int ans = 0;
            for (int i = m; i <= N; i ++)
                for (int j = m; j <= N; j ++) {
                    int num = s[i][j] - s[i - m][j] - s[i][j - m] + s[i - m][j - m];
                    // num ä¸ºä»¥ (i, j) ä¸ºå³ä¸‹è§’çš„è¾¹é•¿ä¸º m çš„æ­£æ–¹å½¢åŒºåŸŸä¸­çš„ç›®æ ‡ä»·å€¼ä¹‹å’Œ
                    ans = max(ans, num);
                    // ç”¨ num æ›´æ–°ç­”æ¡ˆ
                }
            
            cout << ans << endl;
            
            return 0;
        }
        ```

* * *

åŸºäº DP è®¡ç®—é«˜ç»´å‰ç¼€å’Œï¼š

- [CF 165E Compatible Numbers](https://codeforces.com/contest/165/problem/E)
- [CF 383E Vowels](https://codeforces.com/problemset/problem/383/E)
- [ARC 100C Or Plus Max](https://atcoder.jp/contests/arc100/tasks/arc100_c)

* * *

æ ‘ä¸Šå‰ç¼€å’Œï¼š

- [LOJ 10134.Dis](https://loj.ac/problem/10134)
- [LOJ 2491. æ±‚å’Œ](https://loj.ac/problem/2491)

* * *

å·®åˆ†ï¼š

??? note "[Master of GCD](https://vjudge.net/problem/HDU-6273#author=Alanaxixi)"
    å­¦å§æœ‰nä¸ªæ•°å­—åœ¨ä¸€è¡Œï¼Œæœ€å¼€å§‹å®ƒä»¬éƒ½ç­‰äº1ï¼Œå¦å¤–å­¦å§å¯¹è´¨æ•°å¾ˆæœ‰å…´è¶£ï¼Œæ¯æ¬¡å­¦å§ä¼šé€‰æ‹©ä¸€ä¸ªè¿ç»­çš„åºåˆ—$[L,R]$å’Œä¸€ä¸ªè´¨æ•°Xï¼Œå¥¹å°†ä¼šæŠŠLåˆ°RåŒºé—´çš„æ•°éƒ½ä¹˜ä¸ŠXã€‚ä¸ºäº†ç®€åŒ–è¿™ä¸ªé—®é¢˜ï¼ŒXåªä¼šæ˜¯2æˆ–è€…3ã€‚ç»è¿‡mæ¬¡æ“ä½œåï¼Œå­¦å§æƒ³è¦çŸ¥é“è¿™ä¸ªåºåˆ—çš„æœ€å¤§å…¬çº¦æ•°ã€‚

    ??? tip
        è§£æ³•1ï¼šçº¿æ®µæ ‘çš„åŒºé—´æ›´æ–°ï¼Œæ‰¾åˆ°åŒºé—´ä¸­æœ€å°‘çš„2å’Œæœ€å°‘çš„3ï¼Œæ‰€æœ‰ä¹˜ç§¯å³ä¸ºç­”æ¡ˆã€‚

        è§£æ³•2ï¼šå·®åˆ†æ•°ç»„ï¼Œå› ä¸ºè¿™æ•°åˆ—çš„æœ€å¤§å…¬çº¦æ•°å°±æ˜¯è¿™ä¸ªæ•°åˆ—2çš„æœ€å°‘æ¬¡æ•°çš„å¹‚ï¼Œä¹˜ä»¥3çš„æœ€å°‘æ¬¡æ•°çš„å¹‚ï¼Œå°†2å’Œ3åˆ†å¼€è®¨è®ºï¼Œç„¶ååˆ†åˆ«è®°å½•è¿™ä¸ªåŒºé—´å†…æœ€å°‘å‡ºç°äº†å‡ æ¬¡2æˆ–3ï¼›å†åˆ©ç”¨çŸ©é˜µå¿«é€Ÿå¹‚è¿›è¡Œè®¡ç®—ï¼Œæœ€åæŠŠä¸¤ä¸ªç»“æœç›¸ä¹˜ã€‚

    ??? note "å‚è€ƒä»£ç "

        === "çº¿æ®µæ ‘"

            ```cpp
            #include<stdio.h>
            #include<iostream>
            #include<memory.h>
            using namespace std;
            struct Node{
                int l,r;
                long long int num2,num3;
                long long int lazy2,lazy3;
            };
            struct Node nodes[100005<<2];
            void build(int l,int r,int n)
            {
                nodes[n].l=l;
                nodes[n].r=r;
                nodes[n].lazy2=0;
                nodes[n].lazy3=0;
                nodes[n].num2=0;
                nodes[n].num3=0;
                if(l==r) 
                    return;
                int mid=(l+r)>>1;
                build(l,mid,n<<1);
                build(mid+1,r,n<<1|1);
            }
            void pushdown(int n)
            {
                if(nodes[n].lazy2)
                {
                    nodes[n<<1].lazy2+=nodes[n].lazy2;
                    nodes[n<<1|1].lazy2+=nodes[n].lazy2;
                    nodes[n<<1].num2+=nodes[n].lazy2;
                    nodes[n<<1|1].num2+=nodes[n].lazy2;
                    nodes[n].lazy2=0;
                }
                if(nodes[n].lazy3)
                {
                    nodes[n<<1].lazy3+=nodes[n].lazy3;
                    nodes[n<<1|1].lazy3+=nodes[n].lazy3;
                    nodes[n<<1].num3+=nodes[n].lazy3;
                    nodes[n<<1|1].num3+=nodes[n].lazy3;
                    nodes[n].lazy3=0;
                }
            }
            void update(int l,int r,int x,int n)
            {
                if(l<=nodes[n].l&&r>=nodes[n].r)
                {
                    if(x==2)
                    {
                        nodes[n].lazy2++;
                        nodes[n].num2++;
                    }
                    if(x==3)
                    {
                        nodes[n].lazy3++;
                        nodes[n].num3++;
                    }
                    return;
                }
                pushdown(n);
                int mid=(nodes[n].l+nodes[n].r)>>1;
                if(l<=mid) update(l,r,x,n<<1);
                if(r>mid) update(l,r,x,n<<1|1);
                nodes[n].num2=min(nodes[n<<1].num2,nodes[n<<1|1].num2);
                nodes[n].num3=min(nodes[n<<1].num3,nodes[n<<1|1].num3);	
            }
            int main()
            {
                int t;
                scanf("%d",&t);
                while(t--)
                {
                    int n,m;
                    scanf("%d%d",&n,&m);
                    build(1,n,1);
                    for(int i=0;i<m;i++)
                    {
                        int l,r,x;
                        scanf("%d%d%d",&l,&r,&x);
                        update(l,r,x,1);
                    }	
                    long long int ans=1;
                    for(long long int i=0;i<nodes[1].num2;i++)
                        ans=ans*2%998244353;
                    for(long long int i=0;i<nodes[1].num3;i++)
                        ans=ans*3%998244353;
                    printf("%lld\n",ans);
                }	
                return 0;
            }
            ```

        === "å·®åˆ†"

            ```cpp
            #include<iostream>
            #include<algorithm>

            using namespace std;
            #define ll long long
            const int maxn=1e5+10;
            const int mod=998244353;
            ll a[maxn],b[maxn],c[maxn];
            //çŸ©é˜µå¿«é€Ÿå¹‚ 
            ll poww(ll x,ll y)
            {
                ll da=1;
                while(y)
                {
                    if(y&1) da=(da*x)%mod;
                    x=x*x%mod;
                    y>>=1;
                }
                return da;
            }

            int main()
            {
                ios::sync_with_stdio(false);
                int t,m,n;
                ll x,y,z;
                cin>>t;
                while(t--)
                {
                    cin>>n>>m;
                    for(int i=0;i<=n;i++) b[i]=c[i]=0;
                    // æ•°ç»„ b[]è®°å½• 2ï¼›çš„æƒ…å†µ
                    // æ•°ç»„ c[]è®°å½•3ï¼›çš„æƒ…å†µ 
                    while(m--)
                    {
                        cin>>x>>y>>z;
                        // å·®åˆ†çš„å…³é”®ä»£ç 			
                        if(z==2)
                        {
                            b[x]++,b[y+1]--;
                        }
                        else c[x]++,c[y+1]--;
                    }
                    ll sum=0;
                    ll ans,ans2;
                    ans2=ans=10000000;
                    // è®°å½•è¿™ä¸ªæ•°ç»„å†…æœ€å°‘å‡ºç°äº†å¤šå°‘ 2  
                    for(int i=1;i<=n;i++)
                    {
                        sum+=b[i];
                        ans=ans<sum?ans:sum;
                    }
                    // è®°å½•è¿™ä¸ªæ•°ç»„å†…æœ€å°‘å‡ºç°äº†å¤šå°‘ 3 	
                    sum=0;
                    for(int i=1;i<=n;i++)
                    {
                        sum+=c[i];
                        ans2=ans2<sum?ans2:sum;
                    }
                    //åˆ†åˆ«æ±‚ 2 å’Œ 3 çš„å¹‚ç„¶åç›¸ä¹˜		
                    sum=poww(2,ans);
                    ans=sum%mod*(poww(3,ans2))%mod;
                    cout<<ans<<"\n";
                }
                return 0;
            }
            ```

??? note "[Complete the Sequence](https://vjudge.net/problem/HDU-1121)"
    ç»™ä½ ä¸€ä¸ªåºåˆ—ï¼Œè®©ä½ æ‰¾å‡ºè§„å¾‹å¹¶ç»™å‡ºæ¥ä¸‹æ¥å¾—cé¡¹ã€‚

    ??? tip
        ä½¿ç”¨å·®åˆ†ï¼Œä¹Ÿå°±æ˜¯ä¸æ–­åœ°æ±‚ç›¸é‚»ä¸¤é¡¹ä¹‹é—´çš„å·®ï¼Œä¸€ç›´åˆ°å…¶æ‰€æœ‰çš„å·®å€¼éƒ½ç›¸åŒä¸ºæ­¢ï¼Œè¿™ä¸ªæ—¶å€™åœ¨è¿”å›å»å°±ä¼šå¾—åˆ°åŸåºåˆ—ã€‚

        åŸæ•°åˆ—ï¼š1 2 4 7 11 16 22

        ä¸€é˜¶å·®åˆ†ï¼š1 2 3 4  5  6

        äºŒé˜¶å·®åˆ†ï¼š1 1 1 1  1

        æ‰€ä»¥è®¡ç®—å‡ºçš„äºŒç»´å·®åˆ†æ•°ç»„æ˜¯è¿™ä¸ªæ ·å­çš„ï¼š

        ![](./images/prefix-6.png)

        ç„¶åæŠŠn-1é˜¶å·®åˆ†è¡¥å……å®Œæ•´ï¼Œè¾“å‡ºå¤šå°‘å°±è¡¥åˆ°å¤šå°‘ï¼Œ

        ![](./images/prefix-7.png)

        ç„¶åé€†æ¨ä¸Šå»ï¼Œ$a[i][j]=a[i+1][j-1]+a[i][j-1];$

        ![](./images/prefix-8.png)
    
    ??? note "å‚è€ƒä»£ç "

        ```cpp
        #include<stdio.h>
        #include<algorithm>
        using namespace std;
        const int maxn=110;
        int a[maxn][maxn];
        int main()
        {
            int t;
            scanf("%d",&t);
            while(t--)
            {
                int n,m;
                scanf("%d %d",&n,&m);
                for(int i=0; i<n; i++)
                    scanf("%d",&a[0][i]);
                for(int i=1; i<n; i++)
                    for(int j=0; j<n-i; j++)
                        a[i][j]=a[i-1][j+1]-a[i-1][j];
                for(int i=1; i<m+n; i++)
                    a[n-1][i]=a[n-1][0];
                for(int i=n-2; i>=0; i--)
                {
                    for(int j=n-i; j<n+m; j++)
                    {
                        a[i][j]=a[i+1][j-1]+a[i][j-1];
                    }
                }
                for(int i=n;i<n+m;i++)
                    printf("%d ",a[0][i]);
                printf("\n");
            }
        }
        ```

??? note "[æµ·åº•é«˜é“](https://www.luogu.com.cn/problem/P3406)"
    è¯¥é“è·¯ç»è¿‡ $N$ ä¸ªåŸå¸‚ï¼Œæ¯ä¸ªåŸå¸‚éƒ½æœ‰ä¸€ä¸ªç«™ã€‚ä¸è¿‡ï¼Œç”±äºå„ä¸ªåŸå¸‚ä¹‹é—´ä¸èƒ½åè°ƒå¥½ï¼Œäºæ˜¯ä¹˜è½¦æ¯ç»è¿‡ä¸¤ä¸ªç›¸é‚»çš„åŸå¸‚ä¹‹é—´ï¼ˆæ–¹å‘ä¸é™ï¼‰ï¼Œå¿…é¡»å•ç‹¬è´­ä¹°è¿™ä¸€å°æ®µçš„è½¦ç¥¨ã€‚ç¬¬ $i$ æ®µé“è·¯è¿æ¥äº†åŸå¸‚ $i$ å’ŒåŸå¸‚ $i+1(1\leq i<N)$ã€‚å¦‚æœæ­ä¹˜çš„æ¯”è¾ƒè¿œï¼Œéœ€è¦è´­ä¹°å¤šå¼ è½¦ç¥¨ã€‚ç¬¬ $i$ æ®µé“è·¯è´­ä¹°çº¸è´¨å•ç¨‹ç¥¨éœ€è¦ $A_i$ åšè‰¾å…ƒã€‚

    è™½ç„¶ä¸€äº›äº‹æƒ…æ²¡æœ‰åè°ƒå¥½ï¼Œå„æ®µé“è·¯å…¬å¸ä¹Ÿä¸ºäº†æ–¹ä¾¿ä¹˜å®¢ï¼Œæ¨å‡ºäº† IC å¡ã€‚å¯¹äºç¬¬ $i$ æ®µé“è·¯ï¼Œéœ€è¦èŠ± $C_i$ åšè‰¾å…ƒçš„å·¥æœ¬è´¹è´­ä¹°ä¸€å¼  IC å¡ï¼Œç„¶åä¹˜åè¿™æ®µé“è·¯ä¸€æ¬¡å°±åªè¦æ‰£ $B_i(B_i<A_i)$ å…ƒã€‚IC å¡å¯ä»¥æå‰è´­ä¹°ï¼Œæœ‰é’±å°±å¯ä»¥ä»ç½‘ä¸Šä¹°å¾—åˆ°ï¼Œè€Œä¸éœ€è¦äº²è‡ªå»å¯¹åº”çš„åŸå¸‚è´­ä¹°ã€‚å·¥æœ¬è´¹ä¸èƒ½é€€ï¼Œä¹Ÿä¸èƒ½è´­ä¹°è½¦ç¥¨ã€‚æ¯å¼ å¡éƒ½å¯ä»¥å……å€¼ä»»æ„æ•°é¢ã€‚å¯¹äºç¬¬ $i$ æ®µé“è·¯çš„ IC å¡ï¼Œæ— æ³•ä¹˜ååˆ«çš„é“è·¯çš„è½¦ã€‚

    Uim ç°åœ¨éœ€è¦å‡ºå·®ï¼Œè¦å» $M$ ä¸ªåŸå¸‚ï¼Œä»åŸå¸‚ $P_1$ å‡ºå‘åˆ†åˆ«æŒ‰ç…§ $P_1,P_2,P_3,\cdots,P_M$ çš„é¡ºåºè®¿é—®å„ä¸ªåŸå¸‚ï¼Œå¯èƒ½ä¼šå¤šæ¬¡è®¿é—®ä¸€ä¸ªåŸå¸‚ï¼Œä¸”ç›¸é‚»è®¿é—®çš„åŸå¸‚ä½ç½®ä¸ä¸€å®šç›¸é‚»ï¼Œè€Œä¸”ä¸ä¼šæ˜¯åŒä¸€ä¸ªåŸå¸‚ã€‚

    ç°åœ¨ä»–å¸Œæœ›çŸ¥é“ï¼Œå‡ºå·®ç»“æŸåï¼Œè‡³å°‘ä¼šèŠ±æ‰å¤šå°‘çš„é’±ï¼ŒåŒ…æ‹¬è´­ä¹°çº¸è´¨è½¦ç¥¨ã€ä¹°å¡å’Œå……å€¼çš„æ€»è´¹ç”¨ã€‚

    ??? tip
        å¯¹äºå…¶ä¸­ä¸€å°æ®µï¼Œæˆ‘ä»¬è¦ä¹ˆå…¨éƒ¨ä¹°çº¸ç¥¨ï¼Œè¦ä¹ˆå…¨éƒ¨åˆ·å¡ã€‚æ‰€ä»¥æˆ‘ä»¬åªéœ€è¦ç»Ÿè®¡æ¯ä¸€å°æ®µç»è¿‡çš„æ€»æ¬¡æ•°ã€‚ä½¿ç”¨å·®åˆ†æ•°ç»„æ¥è®¡ç®—æ¯æ®µç»è¿‡çš„æ¬¡æ•°ã€‚
    
    ??? note "å‚è€ƒä»£ç "

        ```cpp
        #include<iostream>
        #include<cstdio>
        #include<cmath>
        #include<cstring>
        #define LL unsigned long long
        using namespace std;
        int n,m;
        LL ans=0,x,y;
        long long  a,b,c,p[100001],val[100001];
        inline long long read(){
            long long x=0,f=1;
            char ch;
            ch=getchar();
            while (ch<'0'||ch>'9'){
                if (ch='-')f=-1;
                ch=getchar();
            }
            while (ch>='0'&&ch<='9'){
                x=x*10+ch-'0';
                ch=getchar();
            }
            return x*f;
        }
        inline LL Min(LL x,LL y){
            if (x<y)return x;
            else return y;
        }
        inline LL Max(LL x,LL y){
            if (x>y)return x;
            else return y;
        }
        int main(){
            n=read();
            m=read();
            for (register int i=1;i<=m;++i)p[i]=read();
            memset(val,0,sizeof(val));
            for (register int i=1;i<m;++i){
                x=Max(p[i],p[i+1]);
                y=Min(p[i],p[i+1]);
                val[y]++;
                val[x]--;
            }
            for (register int i=1;i<=n;++i)val[i]+=val[i-1];
            for (register int i=1;i<n;++i){
                a=read();b=read();c=read();
                ans+=Min(a*val[i],b*val[i]+c);
            }
            cout<<ans;
        }
        ```

??? note "[IncDec Sequence](https://www.luogu.com.cn/problem/P4552)"
    ç»™å®šä¸€ä¸ªé•¿åº¦ä¸º $n$ çš„æ•°åˆ— ${a_1,a_2,\cdots,a_n}$ï¼Œæ¯æ¬¡å¯ä»¥é€‰æ‹©ä¸€ä¸ªåŒºé—´$[l,r]$ï¼Œä½¿è¿™ä¸ªåŒºé—´å†…çš„æ•°éƒ½åŠ  $1$ æˆ–è€…éƒ½å‡ $1$ã€‚ 
    
    è¯·é—®è‡³å°‘éœ€è¦å¤šå°‘æ¬¡æ“ä½œæ‰èƒ½ä½¿æ•°åˆ—ä¸­çš„æ‰€æœ‰æ•°éƒ½ä¸€æ ·ï¼Œå¹¶æ±‚å‡ºåœ¨ä¿è¯æœ€å°‘æ¬¡æ•°çš„å‰æä¸‹ï¼Œæœ€ç»ˆå¾—åˆ°çš„æ•°åˆ—æœ‰å¤šå°‘ç§ã€‚

    ??? tip
        æœ¬è´¨æ˜¯å¦‚ä½•æ“ä½œå·®åˆ†æ•°ç»„é™¤ç¬¬ä¸€é¡¹å¤–ä½¿å…¶å…¨éƒ¨æˆ0ã€‚
        
        ç”±äºé¢˜ç›®è¦æ±‚æœ€å°‘çš„æ­¥éª¤ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ï¼Œå¦‚æœå·®åˆ†åºåˆ—é‡Œæœ‰ä¸€ä¸ªæ­£æ•°å’Œä¸€ä¸ªè´Ÿæ•°ï¼ˆå‡ºç°çš„é¡ºåºæ— æ‰€è°“ï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¼˜å…ˆå¯¹è¿™ä¸ªæ­£æ•°å’Œè´Ÿæ•°è¿›è¡Œæ“ä½œï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºæˆ‘ä»¬æœ‰ä»¥ä¸‹ä¸¤ä¸ªå…¬å¼

        å¦‚æœ$a[l,r]+1$ï¼Œåˆ™$b[l]+1ï¼Œb[r+1]-1$

        å¦‚æœ$a[l,r]-1$ï¼Œåˆ™$b[l]-1ï¼Œb[r+1]+1$

        æ­£æ•°-1ï¼Œè´Ÿæ•°+1ï¼Œè¿™æ ·ç›¸å½“äºä¸€æ­¥é‡Œä½œç”¨äº†ä¸¤æ­¥ï¼Œæ¯”è®©æ­£æ•°ä¸€ä¸ªä¸ª-1å’Œè®©è´Ÿæ•°ä¸€ä¸ªä¸ª+1å¿«å¤šäº†

        é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è¿›è¡Œå¤šå°‘ç§è¿™æ ·çš„æ“ä½œå‘¢ï¼Ÿ

        æˆ‘ä»¬å¯ä»¥ä»¤å·®åˆ†åºåˆ—é‡Œæ­£æ•°ç»å¯¹å€¼çš„æ€»å’Œä¸ºpï¼Œè´Ÿæ•°ç»å¯¹å€¼æ€»å’Œä¸ºq

        å¯ä»¥è¿›è¡Œè¿™æ ·ä¸€æ­¥é¡¶ä¸¤æ­¥çš„æ“ä½œå°±æ˜¯minï¼ˆpï¼Œqï¼‰ï¼Œå› ä¸ºè¿™ç§æ“ä½œæ­£æ•°è´Ÿæ•°æ˜¯ä¸€ä¸€é…å¯¹çš„ï¼Œå½“å°‘çš„é‚£ä¸ªå…ˆç”¨å®Œäº†ï¼Œå‰©ä¸‹çš„æ²¡æœ‰å¯ä»¥é…å¯¹çš„äº†ï¼Œåªèƒ½ä¸€æ­¥æ­¥å‡æˆ–ä¸€æ­¥æ­¥åŠ ã€‚

        æ‰€ä»¥æˆ‘ä»¬æ€»å…±è¦è¿›è¡Œçš„æ“ä½œå°±ä¸ºminï¼ˆpï¼Œqï¼‰+ absï¼ˆp-qï¼‰ï¼Œä¹Ÿå°±æ˜¯maxï¼ˆpï¼Œqï¼‰

        ä¿è¯æœ€å°‘æ¬¡æ•°çš„å‰æä¸‹ï¼Œæœ€ç»ˆå¾—åˆ°çš„æ•°åˆ—æœ‰å¤šå°‘ç§ï¼Ÿ

        å¾—åˆ°çš„æ•°åˆ—æœ‰å¤šå°‘ç§ï¼Œå…¶å®å°±æ˜¯é—®çš„b[1]å¯ä»¥æœ‰å¤šå°‘ç§

        æˆ‘ä»¬ä¸Šè¿°æ‰€æœ‰æ“ä½œæ˜¯ä¸b[1]æ— å…³çš„ï¼Œå› ä¸ºæˆ‘ä»¬çš„ç›®æ ‡æ˜¯è®©é™¤äº†b[1]ä»¥å¤–çš„é¡¹å˜0ï¼Œæ‰€

        ä»¥æˆ‘ä»¬ä¸Šè¿°çš„æ“ä½œæ²¡æœ‰è€ƒè™‘åˆ°b[1]ï¼Œb[1]æ€ä¹ˆå˜ï¼Œä¸æˆ‘ä»¬æ±‚å‡ºçš„æœ€å°æ­¥éª¤æ— å…³

        é‚£ä¹ˆï¼Œæˆ‘ä»¬æ€ä¹ˆçŸ¥é“b[1]æœ‰å‡ ç§å‘¢ï¼Ÿå¾ˆç®€å•ï¼Œå…¶å®å°±æ˜¯çœ‹çœ‹æœ‰å‡ ç§ä¸€æ­¥æ­¥å‡æˆ–ä¸€æ­¥æ­¥åŠ çš„æ“ä½œæ•°ï¼Œå› ä¸ºæˆ‘ä»¬ä¸€æ­¥æ­¥åŠ çš„æ—¶å€™ï¼ˆå‡è®¾æˆ‘ä»¬ç°åœ¨çš„æ“ä½œå¯¹è±¡ä¸‹æ ‡ä¸ºiï¼‰ï¼Œå¯ä»¥è¿™æ ·æ“ä½œï¼Œb[1]-1,b[i]+1ï¼Œä¸€æ­¥æ­¥å‡çš„æ—¶å€™å¯ä»¥è¿™æ ·æ“ä½œï¼Œb[1]+1,b[i]-1

        ï¼ˆæ³¨æ„ï¼Œä¸€ä¸ªå·®åˆ†åºåˆ—é‡Œä¸€æ­¥æ­¥æ“ä½œçš„æ—¶å€™åªå¯èƒ½ä¸€æ­¥æ­¥åŠ æˆ–ä¸€æ­¥æ­¥å‡ï¼Œä¸å¯èƒ½ä¸€æ­¥æ­¥åŠ å’Œä¸€æ­¥æ­¥å‡åŒæ—¶å­˜åœ¨ï¼‰

        æ‰€ä»¥è¯´ï¼Œæœ‰å‡ æ­¥ä¸€æ­¥æ­¥çš„æ“ä½œå°±æœ‰å‡ ç§æƒ…å†µ+1ï¼Œä¸ºä»€ä¹ˆ+1å‘¢ï¼Œå› ä¸ºè¿™ä¸ªb[1]æœ¬èº«å°±æœ‰ä¸€ä¸ªå€¼å•Šï¼å°±ç®—ä½ ä¸å¯¹ä»–è¿›è¡Œä»»ä½•æ“ä½œï¼Œå®ƒè‡ªå·±ä¹Ÿæœ‰ä¸€ç§æƒ…å†µã€‚

        ä¸€åŠ ä¸€å‡ï¼ˆä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„ä¸€æ­¥é¡¶ä¸¤æ­¥çš„æ“ä½œï¼‰æ“ä½œæ•°ä¸ºminï¼ˆpï¼Œqï¼‰

        é‚£ä¹ˆä¸€æ­¥æ­¥çš„æ“ä½œæ•°å°±ä¸ºmaxï¼ˆpï¼Œqï¼‰-minï¼ˆpï¼Œqï¼‰= absï¼ˆpï¼Œqï¼‰

    ??? note "å‚è€ƒä»£ç "

        ```cpp
        #include<iostream>
        #include<cstdio>
        #include<algorithm>
        using namespace std;
        typedef long long LL;
        LL n,c,p,q,a[100010];
        int main()
        {
            cin>>n;
            for(int i=1;i<=n;i++)
            {
                scanf("%lld",&a[i]);
            }
            for(int i=2;i<=n;i++)
            {
                c=a[i]-a[i-1];
                if(c>0)
                {
                    p+=c;
                }
                else 
                q-=c;
            }
            LL ans1=max(p,q);
            LL ans2=abs(p-q)+1;
            cout<<ans1<<endl<<ans2;
            return 0;
        }
        ```

??? note "[Tallest Cow](http://poj.org/problem?id=3263)"
    æœ‰nå¤´ç‰›ï¼Œå®ƒä»¬æŒ‰é¡ºåºæ’æˆä¸€åˆ—ã€‚ åªçŸ¥é“å…¶ä¸­æœ€é«˜çš„å¥¶ç‰›çš„åºå·åŠå®ƒçš„é«˜åº¦ï¼Œå…¶ä»–å¥¶ç‰›çš„é«˜åº¦éƒ½æ˜¯æœªçŸ¥çš„ã€‚æ‰‹ä¸Šæœ‰Ræ¡ä¿¡æ¯ï¼Œæ¯æ¡ä¿¡æ¯ä¸Šæœ‰ä¸¤å¤´å¥¶ç‰›çš„åºå·ï¼ˆaå’Œbï¼‰ï¼Œå…¶ä¸­bå¥¶ç‰›çš„é«˜åº¦ä¸€å®šå¤§äºç­‰äºaå¥¶ç‰›çš„é«˜åº¦ï¼Œä¸”aï¼Œbä¹‹é—´çš„æ‰€æœ‰å¥¶ç‰›çš„é«˜åº¦éƒ½æ¯”aå°ã€‚æƒ³è®©ä½ æ ¹æ®è¿™äº›ä¿¡æ¯æ±‚å‡ºæ¯ä¸€å¤´å¥¶ç‰›çš„å¯èƒ½çš„æœ€å¤§çš„é«˜åº¦ã€‚ï¼ˆæ•°æ®ä¿è¯æœ‰è§£ï¼‰

    ??? tip
        è¯»å…¥æ¯ä¸€ç»„æ•°æ®a,bæˆ‘ä»¬å°±å°†å·®åˆ†åºåˆ—$x[a+1]-1$,å°†$x[b]+1$,è¿™æ ·åšçš„è¯æˆ‘ä»¬ç›¸å½“äºè®©åŸåºåˆ—ä¸­çš„a+1åˆ°b-1éƒ½å‡å»1ï¼Œå› ä¸ºæˆ‘ä»¬é¢˜ç›®è¦æ±‚çš„æ˜¯æ¯ä¸€å¤´ç‰›æœ€å¤§çš„é«˜åº¦ï¼Œå¯¹äºä¸¤å¤´ç‰›èƒ½äº’ç›¸çœ‹åˆ°ï¼Œä¸­é—´çš„ç‰›é«˜åº¦è‡³å°‘è¦æ¯”è¿™ä¸¤å¤´ç‰›çš„é«˜åº¦å°1ï¼Œè€Œæˆ‘ä»¬åˆšå¥½è¦æ±‚çš„å°±æ˜¯æœ€å¤§çš„é«˜åº¦ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±å‡è®¾æ¯ä¸€å¤´ä¸­é—´çš„ç‰›é«˜åº¦æ¯”ä¸¤å¤´çš„é«˜åº¦å°‘1ã€‚

    ??? note "å‚è€ƒä»£ç "

        ```cpp
        #include<iostream>
        #include<cstdio>
        #include<map>
        #include<utility>
        using namespace std;

        const int maxn = 10005;
        int n, I, h, r;
        int c[maxn], d[maxn];
        map<pair<int, int>, bool>existed;

        int main()
        {
            cin >> n >> I >> h >> r;
            for (int i = 0; i < r; i++)
            {
                int a, b;
                scanf("%d%d", &a, &b);
                if (a > b)  swap(a, b);
                if (existed[make_pair(a, b)])   continue;
                //mapåˆ¤æ–­ä¸€ä¸‹æ˜¯å¦æ›¾ç»æ“ä½œè¿‡äº†
                d[a + 1]--, d[b]++;
                existed[make_pair(a, b)] = true;
            }

            for (int i = 1; i <= n; i++)
            {
                c[i] = c[i - 1] + d[i];
                printf("%d\n", h + c[i]);
            }
            return 0;
        }
        ```

??? note "[P3397 åœ°æ¯¯](https://www.luogu.com.cn/problem/P3397)"
    åœ¨ $n\times n$ çš„æ ¼å­ä¸Šæœ‰ $m$ ä¸ªåœ°æ¯¯ã€‚ç»™å‡ºè¿™äº›åœ°æ¯¯çš„ä¿¡æ¯ï¼Œé—®æ¯ä¸ªç‚¹è¢«å¤šå°‘ä¸ªåœ°æ¯¯è¦†ç›–ã€‚

    ??? tip
        äºŒç»´å·®åˆ†å‰ç¼€å’Œ
        
        è®¾$b[i][j]=a[i][j]-a[i-1][j]-a[i][j-1]+a[i-1][j-1]$

        è¿™æ ·æ¯æ¬¡ä¿®æ”¹$b[i][j]$ç›¸å½“äºå¯¹ä»»æ„ $i \leq x, j \leq y$å¯¹ $a[x][y]$ åšåŒæ ·çš„ä¿®æ”¹

        ç„¶åæ¯æ¬¡ä¿®æ”¹å°±ç›´æ¥$++b[x1][y1],--b[x2+1][y1],--b[x1][y2+1],++b[x2+1][y2+1]$å³å¯ã€‚

        æœ€åå†ç›´æ¥$a[i][j]=a[i-1][j]+a[i][j-1]-a[i-1][j-1]+b[i][j]$è¿˜åŸå‡ºåŸåºåˆ—å³å¯ã€‚
    
    ??? note "å‚è€ƒä»£ç "

        ```cpp
        #include<bits/stdc++.h>
        using namespace std;

        int a[1024][1024];
        int main(){
            int n,m,xa,ya,xb,yb;
            scanf("%d%d",&n,&m);
            for(int i=1;i<=m;++i){
                scanf("%d%d%d%d",&xa,&ya,&xb,&yb);
                ++a[xa][ya];
                --a[xb+1][ya];
                --a[xa][yb+1];
                ++a[xb+1][yb+1];
            }
            for(int i=1;i<=n;++i)for(int j=1;j<=n;++j)printf("%d%c",a[i][j]+=a[i-1][j]+a[i][j-1]-a[i-1][j-1],j==n?'\n':' ');
            return 0;
        }
        ```

- [æ ‘çŠ¶æ•°ç»„ 3ï¼šåŒºé—´ä¿®æ”¹ï¼ŒåŒºé—´æŸ¥è¯¢](https://loj.ac/problem/132)

* * *

æ ‘ä¸Šå·®åˆ†ï¼š

- [æ´›è°· 3128 æœ€å¤§æµ](https://www.luogu.com.cn/problem/P3128)
- [JLOI2014 æ¾é¼ çš„æ–°å®¶](https://loj.ac/problem/2236)
- [NOIP2015 è¿è¾“è®¡åˆ’](http://uoj.ac/problem/150)
- [NOIP2016 å¤©å¤©çˆ±è·‘æ­¥](http://uoj.ac/problem/261)

* * *

## å‚è€ƒèµ„æ–™ä¸æ³¨é‡Š

[^note1]: å—æµ·åŒºé’å°‘å¹´ä¿¡æ¯å­¦å¥¥æ—åŒ¹å…‹å†…éƒ¨è®­ç»ƒæ•™æ
